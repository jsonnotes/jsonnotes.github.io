(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();const sa="modulepreload",oa=function(e){return"/"+e},cs={},aa=function(t,r,n){if(!r||r.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(r.map(o=>{if(o=oa(o),o in cs)return;cs[o]=!0;const a=o.endsWith(".css"),i=a?'[rel="stylesheet"]':"";if(!!n)for(let l=s.length-1;l>=0;l--){const f=s[l];if(f.href===o&&(!a||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${i}`))return;const u=document.createElement("link");if(u.rel=a?"stylesheet":sa,a||(u.as="script",u.crossOrigin=""),u.href=o,document.head.appendChild(u),a)return new Promise((l,f)=>{u.addEventListener("load",l),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>t())},Cr=(e,t,r="",n)=>{const s=document.createElement(e);return s.innerText=t,n&&Object.entries(n).forEach(([o,a])=>{o==="parent"&&a.appendChild(s),o==="children"?a.forEach(i=>s.appendChild(i)):o==="eventListeners"?Object.entries(a).forEach(([i,c])=>{s.addEventListener(i,c)}):o==="color"||o==="background"?s.style[o]=a:o==="style"?Object.entries(a).forEach(([i,c])=>{i=i.replace(/([A-Z])/g,"-$1").toLowerCase(),s.style.setProperty(i,c)}):o==="class"?s.classList.add(...a.split(".").filter(i=>i)):o.startsWith("data-")?s.setAttribute(o,a):s[o]=a}),s},Ks=(e,...t)=>{let r=[],n={};const s=o=>{if(typeof o=="string")r.push(Cr("span",o));else if(typeof o=="number")r.push(Cr("span",o.toString()));else if(o instanceof Promise){const a=mt();o.then(i=>{a.innerHTML="",a.appendChild(mt(i))}),r.push(a)}else o instanceof HTMLElement?r.push(o):o instanceof Array?o.forEach(s):n={...n,...o}};for(let o of t)s(o);return Cr(e,"","",{...n,children:r})},Te=e=>(...t)=>Ks(e,...t),de=Te("p"),_e=Te("h2"),nn=Te("h3"),X=Te("div"),gr=Te("pre"),be=Te("button"),sn=Te("a"),It=(e,t=null,...r)=>sn(t??e,{href:e,onclick:n=>{n.metaKey||n.ctrlKey||(n.preventDefault(),history.pushState({},"",e),window.dispatchEvent(new PopStateEvent("popstate")))},style:{color:"inherit",textDecoration:"none",border:"1px solid #ccc",padding:"0px 4px",borderRadius:"0.25em"}},...r),mt=Te("span"),ia=Te("table"),ls=Te("tr"),ca=Te("td"),la=Te("th"),te=(...e)=>({style:Object.assign({},...e)}),Bs=(e,t)=>{const r=t.filter(s=>typeof s=="string").join(" "),n=Ks(e,...t);return n.value=r,n},ur=(...e)=>Bs("input",e),Ws=(...e)=>Bs("textarea",e),Re=(...e)=>{const t=X({style:{background:"var(--background-color)",color:"var(--color)",padding:"1em",paddingBottom:"2em",borderRadius:"1em",zIndex:"2000",overflowY:"scroll"}},...e),r=X({style:{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(166, 166, 166, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"2000"}});r.appendChild(t),document.body.appendChild(r);const n=()=>{r.remove(),document.removeEventListener("keydown",s)},s=o=>{o.key==="Escape"&&n()};return r.onclick=n,document.addEventListener("keydown",s),t.onclick=o=>o.stopPropagation(),r};function ua(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Fr={exports:{}},Js={},Ue={},Ze={},zt={},Q={},Vt={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.regexpCode=e.getEsmExportName=e.getProperty=e.safeStringify=e.stringify=e.strConcat=e.addCodeArg=e.str=e._=e.nil=e._Code=e.Name=e.IDENTIFIER=e._CodeOrName=void 0;class t{}e._CodeOrName=t,e.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class r extends t{constructor(y){if(super(),!e.IDENTIFIER.test(y))throw new Error("CodeGen: name must be a valid identifier");this.str=y}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}e.Name=r;class n extends t{constructor(y){super(),this._items=typeof y=="string"?[y]:y}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const y=this._items[0];return y===""||y==='""'}get str(){var y;return(y=this._str)!==null&&y!==void 0?y:this._str=this._items.reduce((S,P)=>`${S}${P}`,"")}get names(){var y;return(y=this._names)!==null&&y!==void 0?y:this._names=this._items.reduce((S,P)=>(P instanceof r&&(S[P.str]=(S[P.str]||0)+1),S),{})}}e._Code=n,e.nil=new n("");function s(h,...y){const S=[h[0]];let P=0;for(;P<y.length;)i(S,y[P]),S.push(h[++P]);return new n(S)}e._=s;const o=new n("+");function a(h,...y){const S=[$(h[0])];let P=0;for(;P<y.length;)S.push(o),i(S,y[P]),S.push(o,$(h[++P]));return c(S),new n(S)}e.str=a;function i(h,y){y instanceof n?h.push(...y._items):y instanceof r?h.push(y):h.push(f(y))}e.addCodeArg=i;function c(h){let y=1;for(;y<h.length-1;){if(h[y]===o){const S=u(h[y-1],h[y+1]);if(S!==void 0){h.splice(y-1,3,S);continue}h[y++]="+"}y++}}function u(h,y){if(y==='""')return h;if(h==='""')return y;if(typeof h=="string")return y instanceof r||h[h.length-1]!=='"'?void 0:typeof y!="string"?`${h.slice(0,-1)}${y}"`:y[0]==='"'?h.slice(0,-1)+y.slice(1):void 0;if(typeof y=="string"&&y[0]==='"'&&!(h instanceof r))return`"${h}${y.slice(1)}`}function l(h,y){return y.emptyStr()?h:h.emptyStr()?y:a`${h}${y}`}e.strConcat=l;function f(h){return typeof h=="number"||typeof h=="boolean"||h===null?h:$(Array.isArray(h)?h.join(","):h)}function w(h){return new n($(h))}e.stringify=w;function $(h){return JSON.stringify(h).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}e.safeStringify=$;function p(h){return typeof h=="string"&&e.IDENTIFIER.test(h)?new n(`.${h}`):s`[${h}]`}e.getProperty=p;function v(h){if(typeof h=="string"&&e.IDENTIFIER.test(h))return new n(`${h}`);throw new Error(`CodeGen: invalid export name: ${h}, use explicit $id name mapping`)}e.getEsmExportName=v;function m(h){return new n(h.toString())}e.regexpCode=m})(Vt);var Ur={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ValueScope=e.ValueScopeName=e.Scope=e.varKinds=e.UsedValueState=void 0;const t=Vt;class r extends Error{constructor(u){super(`CodeGen: "code" for ${u} not defined`),this.value=u.value}}var n;(function(c){c[c.Started=0]="Started",c[c.Completed=1]="Completed"})(n||(e.UsedValueState=n={})),e.varKinds={const:new t.Name("const"),let:new t.Name("let"),var:new t.Name("var")};class s{constructor({prefixes:u,parent:l}={}){this._names={},this._prefixes=u,this._parent=l}toName(u){return u instanceof t.Name?u:this.name(u)}name(u){return new t.Name(this._newName(u))}_newName(u){const l=this._names[u]||this._nameGroup(u);return`${u}${l.index++}`}_nameGroup(u){var l,f;if(((f=(l=this._parent)===null||l===void 0?void 0:l._prefixes)===null||f===void 0?void 0:f.has(u))||this._prefixes&&!this._prefixes.has(u))throw new Error(`CodeGen: prefix "${u}" is not allowed in this scope`);return this._names[u]={prefix:u,index:0}}}e.Scope=s;class o extends t.Name{constructor(u,l){super(l),this.prefix=u}setValue(u,{property:l,itemIndex:f}){this.value=u,this.scopePath=(0,t._)`.${new t.Name(l)}[${f}]`}}e.ValueScopeName=o;const a=(0,t._)`\n`;class i extends s{constructor(u){super(u),this._values={},this._scope=u.scope,this.opts={...u,_n:u.lines?a:t.nil}}get(){return this._scope}name(u){return new o(u,this._newName(u))}value(u,l){var f;if(l.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const w=this.toName(u),{prefix:$}=w,p=(f=l.key)!==null&&f!==void 0?f:l.ref;let v=this._values[$];if(v){const y=v.get(p);if(y)return y}else v=this._values[$]=new Map;v.set(p,w);const m=this._scope[$]||(this._scope[$]=[]),h=m.length;return m[h]=l.ref,w.setValue(l,{property:$,itemIndex:h}),w}getValue(u,l){const f=this._values[u];if(!!f)return f.get(l)}scopeRefs(u,l=this._values){return this._reduceValues(l,f=>{if(f.scopePath===void 0)throw new Error(`CodeGen: name "${f}" has no value`);return(0,t._)`${u}${f.scopePath}`})}scopeCode(u=this._values,l,f){return this._reduceValues(u,w=>{if(w.value===void 0)throw new Error(`CodeGen: name "${w}" has no value`);return w.value.code},l,f)}_reduceValues(u,l,f={},w){let $=t.nil;for(const p in u){const v=u[p];if(!v)continue;const m=f[p]=f[p]||new Map;v.forEach(h=>{if(m.has(h))return;m.set(h,n.Started);let y=l(h);if(y){const S=this.opts.es5?e.varKinds.var:e.varKinds.const;$=(0,t._)`${$}${S} ${h} = ${y};${this.opts._n}`}else if(y=w?.(h))$=(0,t._)`${$}${y}${this.opts._n}`;else throw new r(h);m.set(h,n.Completed)})}return $}}e.ValueScope=i})(Ur);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.or=e.and=e.not=e.CodeGen=e.operators=e.varKinds=e.ValueScopeName=e.ValueScope=e.Scope=e.Name=e.regexpCode=e.stringify=e.getProperty=e.nil=e.strConcat=e.str=e._=void 0;const t=Vt,r=Ur;var n=Vt;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return n._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return n.str}}),Object.defineProperty(e,"strConcat",{enumerable:!0,get:function(){return n.strConcat}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return n.nil}}),Object.defineProperty(e,"getProperty",{enumerable:!0,get:function(){return n.getProperty}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return n.stringify}}),Object.defineProperty(e,"regexpCode",{enumerable:!0,get:function(){return n.regexpCode}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return n.Name}});var s=Ur;Object.defineProperty(e,"Scope",{enumerable:!0,get:function(){return s.Scope}}),Object.defineProperty(e,"ValueScope",{enumerable:!0,get:function(){return s.ValueScope}}),Object.defineProperty(e,"ValueScopeName",{enumerable:!0,get:function(){return s.ValueScopeName}}),Object.defineProperty(e,"varKinds",{enumerable:!0,get:function(){return s.varKinds}}),e.operators={GT:new t._Code(">"),GTE:new t._Code(">="),LT:new t._Code("<"),LTE:new t._Code("<="),EQ:new t._Code("==="),NEQ:new t._Code("!=="),NOT:new t._Code("!"),OR:new t._Code("||"),AND:new t._Code("&&"),ADD:new t._Code("+")};class o{optimizeNodes(){return this}optimizeNames(d,g){return this}}class a extends o{constructor(d,g,O){super(),this.varKind=d,this.name=g,this.rhs=O}render({es5:d,_n:g}){const O=d?r.varKinds.var:this.varKind,C=this.rhs===void 0?"":` = ${this.rhs}`;return`${O} ${this.name}${C};`+g}optimizeNames(d,g){if(!!d[this.name.str])return this.rhs&&(this.rhs=J(this.rhs,d,g)),this}get names(){return this.rhs instanceof t._CodeOrName?this.rhs.names:{}}}class i extends o{constructor(d,g,O){super(),this.lhs=d,this.rhs=g,this.sideEffects=O}render({_n:d}){return`${this.lhs} = ${this.rhs};`+d}optimizeNames(d,g){if(!(this.lhs instanceof t.Name&&!d[this.lhs.str]&&!this.sideEffects))return this.rhs=J(this.rhs,d,g),this}get names(){const d=this.lhs instanceof t.Name?{}:{...this.lhs.names};return Y(d,this.rhs)}}class c extends i{constructor(d,g,O,C){super(d,O,C),this.op=g}render({_n:d}){return`${this.lhs} ${this.op}= ${this.rhs};`+d}}class u extends o{constructor(d){super(),this.label=d,this.names={}}render({_n:d}){return`${this.label}:`+d}}class l extends o{constructor(d){super(),this.label=d,this.names={}}render({_n:d}){return`break${this.label?` ${this.label}`:""};`+d}}class f extends o{constructor(d){super(),this.error=d}render({_n:d}){return`throw ${this.error};`+d}get names(){return this.error.names}}class w extends o{constructor(d){super(),this.code=d}render({_n:d}){return`${this.code};`+d}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(d,g){return this.code=J(this.code,d,g),this}get names(){return this.code instanceof t._CodeOrName?this.code.names:{}}}class $ extends o{constructor(d=[]){super(),this.nodes=d}render(d){return this.nodes.reduce((g,O)=>g+O.render(d),"")}optimizeNodes(){const{nodes:d}=this;let g=d.length;for(;g--;){const O=d[g].optimizeNodes();Array.isArray(O)?d.splice(g,1,...O):O?d[g]=O:d.splice(g,1)}return d.length>0?this:void 0}optimizeNames(d,g){const{nodes:O}=this;let C=O.length;for(;C--;){const D=O[C];D.optimizeNames(d,g)||(pe(d,D.names),O.splice(C,1))}return O.length>0?this:void 0}get names(){return this.nodes.reduce((d,g)=>B(d,g.names),{})}}class p extends ${render(d){return"{"+d._n+super.render(d)+"}"+d._n}}class v extends ${}class m extends p{}m.kind="else";class h extends p{constructor(d,g){super(g),this.condition=d}render(d){let g=`if(${this.condition})`+super.render(d);return this.else&&(g+="else "+this.else.render(d)),g}optimizeNodes(){super.optimizeNodes();const d=this.condition;if(d===!0)return this.nodes;let g=this.else;if(g){const O=g.optimizeNodes();g=this.else=Array.isArray(O)?new m(O):O}if(g)return d===!1?g instanceof h?g:g.nodes:this.nodes.length?this:new h(ce(d),g instanceof h?[g]:g.nodes);if(!(d===!1||!this.nodes.length))return this}optimizeNames(d,g){var O;if(this.else=(O=this.else)===null||O===void 0?void 0:O.optimizeNames(d,g),!!(super.optimizeNames(d,g)||this.else))return this.condition=J(this.condition,d,g),this}get names(){const d=super.names;return Y(d,this.condition),this.else&&B(d,this.else.names),d}}h.kind="if";class y extends p{}y.kind="for";class S extends y{constructor(d){super(),this.iteration=d}render(d){return`for(${this.iteration})`+super.render(d)}optimizeNames(d,g){if(!!super.optimizeNames(d,g))return this.iteration=J(this.iteration,d,g),this}get names(){return B(super.names,this.iteration.names)}}class P extends y{constructor(d,g,O,C){super(),this.varKind=d,this.name=g,this.from=O,this.to=C}render(d){const g=d.es5?r.varKinds.var:this.varKind,{name:O,from:C,to:D}=this;return`for(${g} ${O}=${C}; ${O}<${D}; ${O}++)`+super.render(d)}get names(){const d=Y(super.names,this.from);return Y(d,this.to)}}class N extends y{constructor(d,g,O,C){super(),this.loop=d,this.varKind=g,this.name=O,this.iterable=C}render(d){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(d)}optimizeNames(d,g){if(!!super.optimizeNames(d,g))return this.iterable=J(this.iterable,d,g),this}get names(){return B(super.names,this.iterable.names)}}class j extends p{constructor(d,g,O){super(),this.name=d,this.args=g,this.async=O}render(d){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(d)}}j.kind="func";class A extends ${render(d){return"return "+super.render(d)}}A.kind="return";class V extends p{render(d){let g="try"+super.render(d);return this.catch&&(g+=this.catch.render(d)),this.finally&&(g+=this.finally.render(d)),g}optimizeNodes(){var d,g;return super.optimizeNodes(),(d=this.catch)===null||d===void 0||d.optimizeNodes(),(g=this.finally)===null||g===void 0||g.optimizeNodes(),this}optimizeNames(d,g){var O,C;return super.optimizeNames(d,g),(O=this.catch)===null||O===void 0||O.optimizeNames(d,g),(C=this.finally)===null||C===void 0||C.optimizeNames(d,g),this}get names(){const d=super.names;return this.catch&&B(d,this.catch.names),this.finally&&B(d,this.finally.names),d}}class U extends p{constructor(d){super(),this.error=d}render(d){return`catch(${this.error})`+super.render(d)}}U.kind="catch";class W extends p{render(d){return"finally"+super.render(d)}}W.kind="finally";class Z{constructor(d,g={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...g,_n:g.lines?`
`:""},this._extScope=d,this._scope=new r.Scope({parent:d}),this._nodes=[new v]}toString(){return this._root.render(this.opts)}name(d){return this._scope.name(d)}scopeName(d){return this._extScope.name(d)}scopeValue(d,g){const O=this._extScope.value(d,g);return(this._values[O.prefix]||(this._values[O.prefix]=new Set)).add(O),O}getScopeValue(d,g){return this._extScope.getValue(d,g)}scopeRefs(d){return this._extScope.scopeRefs(d,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(d,g,O,C){const D=this._scope.toName(g);return O!==void 0&&C&&(this._constants[D.str]=O),this._leafNode(new a(d,D,O)),D}const(d,g,O){return this._def(r.varKinds.const,d,g,O)}let(d,g,O){return this._def(r.varKinds.let,d,g,O)}var(d,g,O){return this._def(r.varKinds.var,d,g,O)}assign(d,g,O){return this._leafNode(new i(d,g,O))}add(d,g){return this._leafNode(new c(d,e.operators.ADD,g))}code(d){return typeof d=="function"?d():d!==t.nil&&this._leafNode(new w(d)),this}object(...d){const g=["{"];for(const[O,C]of d)g.length>1&&g.push(","),g.push(O),(O!==C||this.opts.es5)&&(g.push(":"),(0,t.addCodeArg)(g,C));return g.push("}"),new t._Code(g)}if(d,g,O){if(this._blockNode(new h(d)),g&&O)this.code(g).else().code(O).endIf();else if(g)this.code(g).endIf();else if(O)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(d){return this._elseNode(new h(d))}else(){return this._elseNode(new m)}endIf(){return this._endBlockNode(h,m)}_for(d,g){return this._blockNode(d),g&&this.code(g).endFor(),this}for(d,g){return this._for(new S(d),g)}forRange(d,g,O,C,D=this.opts.es5?r.varKinds.var:r.varKinds.let){const z=this._scope.toName(d);return this._for(new P(D,z,g,O),()=>C(z))}forOf(d,g,O,C=r.varKinds.const){const D=this._scope.toName(d);if(this.opts.es5){const z=g instanceof t.Name?g:this.var("_arr",g);return this.forRange("_i",0,(0,t._)`${z}.length`,F=>{this.var(D,(0,t._)`${z}[${F}]`),O(D)})}return this._for(new N("of",C,D,g),()=>O(D))}forIn(d,g,O,C=this.opts.es5?r.varKinds.var:r.varKinds.const){if(this.opts.ownProperties)return this.forOf(d,(0,t._)`Object.keys(${g})`,O);const D=this._scope.toName(d);return this._for(new N("in",C,D,g),()=>O(D))}endFor(){return this._endBlockNode(y)}label(d){return this._leafNode(new u(d))}break(d){return this._leafNode(new l(d))}return(d){const g=new A;if(this._blockNode(g),this.code(d),g.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(A)}try(d,g,O){if(!g&&!O)throw new Error('CodeGen: "try" without "catch" and "finally"');const C=new V;if(this._blockNode(C),this.code(d),g){const D=this.name("e");this._currNode=C.catch=new U(D),g(D)}return O&&(this._currNode=C.finally=new W,this.code(O)),this._endBlockNode(U,W)}throw(d){return this._leafNode(new f(d))}block(d,g){return this._blockStarts.push(this._nodes.length),d&&this.code(d).endBlock(g),this}endBlock(d){const g=this._blockStarts.pop();if(g===void 0)throw new Error("CodeGen: not in self-balancing block");const O=this._nodes.length-g;if(O<0||d!==void 0&&O!==d)throw new Error(`CodeGen: wrong number of nodes: ${O} vs ${d} expected`);return this._nodes.length=g,this}func(d,g=t.nil,O,C){return this._blockNode(new j(d,g,O)),C&&this.code(C).endFunc(),this}endFunc(){return this._endBlockNode(j)}optimize(d=1){for(;d-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(d){return this._currNode.nodes.push(d),this}_blockNode(d){this._currNode.nodes.push(d),this._nodes.push(d)}_endBlockNode(d,g){const O=this._currNode;if(O instanceof d||g&&O instanceof g)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${g?`${d.kind}/${g.kind}`:d.kind}"`)}_elseNode(d){const g=this._currNode;if(!(g instanceof h))throw new Error('CodeGen: "else" without "if"');return this._currNode=g.else=d,this}get _root(){return this._nodes[0]}get _currNode(){const d=this._nodes;return d[d.length-1]}set _currNode(d){const g=this._nodes;g[g.length-1]=d}}e.CodeGen=Z;function B(_,d){for(const g in d)_[g]=(_[g]||0)+(d[g]||0);return _}function Y(_,d){return d instanceof t._CodeOrName?B(_,d.names):_}function J(_,d,g){if(_ instanceof t.Name)return O(_);if(!C(_))return _;return new t._Code(_._items.reduce((D,z)=>(z instanceof t.Name&&(z=O(z)),z instanceof t._Code?D.push(...z._items):D.push(z),D),[]));function O(D){const z=g[D.str];return z===void 0||d[D.str]!==1?D:(delete d[D.str],z)}function C(D){return D instanceof t._Code&&D._items.some(z=>z instanceof t.Name&&d[z.str]===1&&g[z.str]!==void 0)}}function pe(_,d){for(const g in d)_[g]=(_[g]||0)-(d[g]||0)}function ce(_){return typeof _=="boolean"||typeof _=="number"||_===null?!_:(0,t._)`!${I(_)}`}e.not=ce;const fe=E(e.operators.AND);function T(..._){return _.reduce(fe)}e.and=T;const L=E(e.operators.OR);function x(..._){return _.reduce(L)}e.or=x;function E(_){return(d,g)=>d===t.nil?g:g===t.nil?d:(0,t._)`${I(d)} ${_} ${I(g)}`}function I(_){return _ instanceof t.Name?_:(0,t._)`(${_})`}})(Q);var q={};Object.defineProperty(q,"__esModule",{value:!0});q.checkStrictMode=q.getErrorPath=q.Type=q.useFunc=q.setEvaluated=q.evaluatedPropsToName=q.mergeEvaluated=q.eachItem=q.unescapeJsonPointer=q.escapeJsonPointer=q.escapeFragment=q.unescapeFragment=q.schemaRefOrVal=q.schemaHasRulesButRef=q.schemaHasRules=q.checkUnknownRules=q.alwaysValidSchema=q.toHash=void 0;const ne=Q,da=Vt;function fa(e){const t={};for(const r of e)t[r]=!0;return t}q.toHash=fa;function pa(e,t){return typeof t=="boolean"?t:Object.keys(t).length===0?!0:(Gs(e,t),!Xs(t,e.self.RULES.all))}q.alwaysValidSchema=pa;function Gs(e,t=e.schema){const{opts:r,self:n}=e;if(!r.strictSchema||typeof t=="boolean")return;const s=n.RULES.keywords;for(const o in t)s[o]||Zs(e,`unknown keyword: "${o}"`)}q.checkUnknownRules=Gs;function Xs(e,t){if(typeof e=="boolean")return!e;for(const r in e)if(t[r])return!0;return!1}q.schemaHasRules=Xs;function ha(e,t){if(typeof e=="boolean")return!e;for(const r in e)if(r!=="$ref"&&t.all[r])return!0;return!1}q.schemaHasRulesButRef=ha;function ma({topSchemaRef:e,schemaPath:t},r,n,s){if(!s){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,ne._)`${r}`}return(0,ne._)`${e}${t}${(0,ne.getProperty)(n)}`}q.schemaRefOrVal=ma;function ya(e){return Ys(decodeURIComponent(e))}q.unescapeFragment=ya;function ga(e){return encodeURIComponent(on(e))}q.escapeFragment=ga;function on(e){return typeof e=="number"?`${e}`:e.replace(/~/g,"~0").replace(/\//g,"~1")}q.escapeJsonPointer=on;function Ys(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}q.unescapeJsonPointer=Ys;function $a(e,t){if(Array.isArray(e))for(const r of e)t(r);else t(e)}q.eachItem=$a;function us({mergeNames:e,mergeToName:t,mergeValues:r,resultToName:n}){return(s,o,a,i)=>{const c=a===void 0?o:a instanceof ne.Name?(o instanceof ne.Name?e(s,o,a):t(s,o,a),a):o instanceof ne.Name?(t(s,a,o),o):r(o,a);return i===ne.Name&&!(c instanceof ne.Name)?n(s,c):c}}q.mergeEvaluated={props:us({mergeNames:(e,t,r)=>e.if((0,ne._)`${r} !== true && ${t} !== undefined`,()=>{e.if((0,ne._)`${t} === true`,()=>e.assign(r,!0),()=>e.assign(r,(0,ne._)`${r} || {}`).code((0,ne._)`Object.assign(${r}, ${t})`))}),mergeToName:(e,t,r)=>e.if((0,ne._)`${r} !== true`,()=>{t===!0?e.assign(r,!0):(e.assign(r,(0,ne._)`${r} || {}`),an(e,r,t))}),mergeValues:(e,t)=>e===!0?!0:{...e,...t},resultToName:Qs}),items:us({mergeNames:(e,t,r)=>e.if((0,ne._)`${r} !== true && ${t} !== undefined`,()=>e.assign(r,(0,ne._)`${t} === true ? true : ${r} > ${t} ? ${r} : ${t}`)),mergeToName:(e,t,r)=>e.if((0,ne._)`${r} !== true`,()=>e.assign(r,t===!0?!0:(0,ne._)`${r} > ${t} ? ${r} : ${t}`)),mergeValues:(e,t)=>e===!0?!0:Math.max(e,t),resultToName:(e,t)=>e.var("items",t)})};function Qs(e,t){if(t===!0)return e.var("props",!0);const r=e.var("props",(0,ne._)`{}`);return t!==void 0&&an(e,r,t),r}q.evaluatedPropsToName=Qs;function an(e,t,r){Object.keys(r).forEach(n=>e.assign((0,ne._)`${t}${(0,ne.getProperty)(n)}`,!0))}q.setEvaluated=an;const ds={};function va(e,t){return e.scopeValue("func",{ref:t,code:ds[t.code]||(ds[t.code]=new da._Code(t.code))})}q.useFunc=va;var Kr;(function(e){e[e.Num=0]="Num",e[e.Str=1]="Str"})(Kr||(q.Type=Kr={}));function wa(e,t,r){if(e instanceof ne.Name){const n=t===Kr.Num;return r?n?(0,ne._)`"[" + ${e} + "]"`:(0,ne._)`"['" + ${e} + "']"`:n?(0,ne._)`"/" + ${e}`:(0,ne._)`"/" + ${e}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,ne.getProperty)(e).toString():"/"+on(e)}q.getErrorPath=wa;function Zs(e,t,r=e.opts.strictSchema){if(!!r){if(t=`strict mode: ${t}`,r===!0)throw new Error(t);e.self.logger.warn(t)}}q.checkStrictMode=Zs;var Fe={};Object.defineProperty(Fe,"__esModule",{value:!0});const we=Q,_a={data:new we.Name("data"),valCxt:new we.Name("valCxt"),instancePath:new we.Name("instancePath"),parentData:new we.Name("parentData"),parentDataProperty:new we.Name("parentDataProperty"),rootData:new we.Name("rootData"),dynamicAnchors:new we.Name("dynamicAnchors"),vErrors:new we.Name("vErrors"),errors:new we.Name("errors"),this:new we.Name("this"),self:new we.Name("self"),scope:new we.Name("scope"),json:new we.Name("json"),jsonPos:new we.Name("jsonPos"),jsonLen:new we.Name("jsonLen"),jsonPart:new we.Name("jsonPart")};Fe.default=_a;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.extendErrors=e.resetErrorsCount=e.reportExtraError=e.reportError=e.keyword$DataError=e.keywordError=void 0;const t=Q,r=q,n=Fe;e.keywordError={message:({keyword:m})=>(0,t.str)`must pass "${m}" keyword validation`},e.keyword$DataError={message:({keyword:m,schemaType:h})=>h?(0,t.str)`"${m}" keyword must be ${h} ($data)`:(0,t.str)`"${m}" keyword is invalid ($data)`};function s(m,h=e.keywordError,y,S){const{it:P}=m,{gen:N,compositeRule:j,allErrors:A}=P,V=f(m,h,y);S??(j||A)?c(N,V):u(P,(0,t._)`[${V}]`)}e.reportError=s;function o(m,h=e.keywordError,y){const{it:S}=m,{gen:P,compositeRule:N,allErrors:j}=S,A=f(m,h,y);c(P,A),N||j||u(S,n.default.vErrors)}e.reportExtraError=o;function a(m,h){m.assign(n.default.errors,h),m.if((0,t._)`${n.default.vErrors} !== null`,()=>m.if(h,()=>m.assign((0,t._)`${n.default.vErrors}.length`,h),()=>m.assign(n.default.vErrors,null)))}e.resetErrorsCount=a;function i({gen:m,keyword:h,schemaValue:y,data:S,errsCount:P,it:N}){if(P===void 0)throw new Error("ajv implementation error");const j=m.name("err");m.forRange("i",P,n.default.errors,A=>{m.const(j,(0,t._)`${n.default.vErrors}[${A}]`),m.if((0,t._)`${j}.instancePath === undefined`,()=>m.assign((0,t._)`${j}.instancePath`,(0,t.strConcat)(n.default.instancePath,N.errorPath))),m.assign((0,t._)`${j}.schemaPath`,(0,t.str)`${N.errSchemaPath}/${h}`),N.opts.verbose&&(m.assign((0,t._)`${j}.schema`,y),m.assign((0,t._)`${j}.data`,S))})}e.extendErrors=i;function c(m,h){const y=m.const("err",h);m.if((0,t._)`${n.default.vErrors} === null`,()=>m.assign(n.default.vErrors,(0,t._)`[${y}]`),(0,t._)`${n.default.vErrors}.push(${y})`),m.code((0,t._)`${n.default.errors}++`)}function u(m,h){const{gen:y,validateName:S,schemaEnv:P}=m;P.$async?y.throw((0,t._)`new ${m.ValidationError}(${h})`):(y.assign((0,t._)`${S}.errors`,h),y.return(!1))}const l={keyword:new t.Name("keyword"),schemaPath:new t.Name("schemaPath"),params:new t.Name("params"),propertyName:new t.Name("propertyName"),message:new t.Name("message"),schema:new t.Name("schema"),parentSchema:new t.Name("parentSchema")};function f(m,h,y){const{createErrors:S}=m.it;return S===!1?(0,t._)`{}`:w(m,h,y)}function w(m,h,y={}){const{gen:S,it:P}=m,N=[$(P,y),p(m,y)];return v(m,h,N),S.object(...N)}function $({errorPath:m},{instancePath:h}){const y=h?(0,t.str)`${m}${(0,r.getErrorPath)(h,r.Type.Str)}`:m;return[n.default.instancePath,(0,t.strConcat)(n.default.instancePath,y)]}function p({keyword:m,it:{errSchemaPath:h}},{schemaPath:y,parentSchema:S}){let P=S?h:(0,t.str)`${h}/${m}`;return y&&(P=(0,t.str)`${P}${(0,r.getErrorPath)(y,r.Type.Str)}`),[l.schemaPath,P]}function v(m,{params:h,message:y},S){const{keyword:P,data:N,schemaValue:j,it:A}=m,{opts:V,propertyName:U,topSchemaRef:W,schemaPath:Z}=A;S.push([l.keyword,P],[l.params,typeof h=="function"?h(m):h||(0,t._)`{}`]),V.messages&&S.push([l.message,typeof y=="function"?y(m):y]),V.verbose&&S.push([l.schema,j],[l.parentSchema,(0,t._)`${W}${Z}`],[n.default.data,N]),U&&S.push([l.propertyName,U])}})(zt);var fs;function ba(){if(fs)return Ze;fs=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.boolOrEmptySchema=Ze.topBoolOrEmptySchema=void 0;const e=zt,t=Q,r=Fe,n={message:"boolean schema is false"};function s(i){const{gen:c,schema:u,validateName:l}=i;u===!1?a(i,!1):typeof u=="object"&&u.$async===!0?c.return(r.default.data):(c.assign((0,t._)`${l}.errors`,null),c.return(!0))}Ze.topBoolOrEmptySchema=s;function o(i,c){const{gen:u,schema:l}=i;l===!1?(u.var(c,!1),a(i)):u.var(c,!0)}Ze.boolOrEmptySchema=o;function a(i,c){const{gen:u,data:l}=i,f={gen:u,keyword:"false schema",data:l,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:i};(0,e.reportError)(f,n,void 0,c)}return Ze}var le={},st={};Object.defineProperty(st,"__esModule",{value:!0});st.getRules=st.isJSONType=void 0;const Ea=["string","number","integer","boolean","null","object","array"],Sa=new Set(Ea);function ka(e){return typeof e=="string"&&Sa.has(e)}st.isJSONType=ka;function Pa(){const e={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...e,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},e.number,e.string,e.array,e.object],post:{rules:[]},all:{},keywords:{}}}st.getRules=Pa;var Be={};Object.defineProperty(Be,"__esModule",{value:!0});Be.shouldUseRule=Be.shouldUseGroup=Be.schemaHasRulesForType=void 0;function Oa({schema:e,self:t},r){const n=t.RULES.types[r];return n&&n!==!0&&eo(e,n)}Be.schemaHasRulesForType=Oa;function eo(e,t){return t.rules.some(r=>to(e,r))}Be.shouldUseGroup=eo;function to(e,t){var r;return e[t.keyword]!==void 0||((r=t.definition.implements)===null||r===void 0?void 0:r.some(n=>e[n]!==void 0))}Be.shouldUseRule=to;Object.defineProperty(le,"__esModule",{value:!0});le.reportTypeError=le.checkDataTypes=le.checkDataType=le.coerceAndCheckDataType=le.getJSONTypes=le.getSchemaTypes=le.DataType=void 0;const ja=st,Na=Be,xa=zt,G=Q,ro=q;var ft;(function(e){e[e.Correct=0]="Correct",e[e.Wrong=1]="Wrong"})(ft||(le.DataType=ft={}));function Ia(e){const t=no(e.type);if(t.includes("null")){if(e.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!t.length&&e.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');e.nullable===!0&&t.push("null")}return t}le.getSchemaTypes=Ia;function no(e){const t=Array.isArray(e)?e:e?[e]:[];if(t.every(ja.isJSONType))return t;throw new Error("type must be JSONType or JSONType[]: "+t.join(","))}le.getJSONTypes=no;function Ra(e,t){const{gen:r,data:n,opts:s}=e,o=Ta(t,s.coerceTypes),a=t.length>0&&!(o.length===0&&t.length===1&&(0,Na.schemaHasRulesForType)(e,t[0]));if(a){const i=cn(t,n,s.strictNumbers,ft.Wrong);r.if(i,()=>{o.length?Ca(e,t,o):ln(e)})}return a}le.coerceAndCheckDataType=Ra;const so=new Set(["string","number","integer","boolean","null"]);function Ta(e,t){return t?e.filter(r=>so.has(r)||t==="array"&&r==="array"):[]}function Ca(e,t,r){const{gen:n,data:s,opts:o}=e,a=n.let("dataType",(0,G._)`typeof ${s}`),i=n.let("coerced",(0,G._)`undefined`);o.coerceTypes==="array"&&n.if((0,G._)`${a} == 'object' && Array.isArray(${s}) && ${s}.length == 1`,()=>n.assign(s,(0,G._)`${s}[0]`).assign(a,(0,G._)`typeof ${s}`).if(cn(t,s,o.strictNumbers),()=>n.assign(i,s))),n.if((0,G._)`${i} !== undefined`);for(const u of r)(so.has(u)||u==="array"&&o.coerceTypes==="array")&&c(u);n.else(),ln(e),n.endIf(),n.if((0,G._)`${i} !== undefined`,()=>{n.assign(s,i),Aa(e,i)});function c(u){switch(u){case"string":n.elseIf((0,G._)`${a} == "number" || ${a} == "boolean"`).assign(i,(0,G._)`"" + ${s}`).elseIf((0,G._)`${s} === null`).assign(i,(0,G._)`""`);return;case"number":n.elseIf((0,G._)`${a} == "boolean" || ${s} === null
              || (${a} == "string" && ${s} && ${s} == +${s})`).assign(i,(0,G._)`+${s}`);return;case"integer":n.elseIf((0,G._)`${a} === "boolean" || ${s} === null
              || (${a} === "string" && ${s} && ${s} == +${s} && !(${s} % 1))`).assign(i,(0,G._)`+${s}`);return;case"boolean":n.elseIf((0,G._)`${s} === "false" || ${s} === 0 || ${s} === null`).assign(i,!1).elseIf((0,G._)`${s} === "true" || ${s} === 1`).assign(i,!0);return;case"null":n.elseIf((0,G._)`${s} === "" || ${s} === 0 || ${s} === false`),n.assign(i,null);return;case"array":n.elseIf((0,G._)`${a} === "string" || ${a} === "number"
              || ${a} === "boolean" || ${s} === null`).assign(i,(0,G._)`[${s}]`)}}}function Aa({gen:e,parentData:t,parentDataProperty:r},n){e.if((0,G._)`${t} !== undefined`,()=>e.assign((0,G._)`${t}[${r}]`,n))}function Br(e,t,r,n=ft.Correct){const s=n===ft.Correct?G.operators.EQ:G.operators.NEQ;let o;switch(e){case"null":return(0,G._)`${t} ${s} null`;case"array":o=(0,G._)`Array.isArray(${t})`;break;case"object":o=(0,G._)`${t} && typeof ${t} == "object" && !Array.isArray(${t})`;break;case"integer":o=a((0,G._)`!(${t} % 1) && !isNaN(${t})`);break;case"number":o=a();break;default:return(0,G._)`typeof ${t} ${s} ${e}`}return n===ft.Correct?o:(0,G.not)(o);function a(i=G.nil){return(0,G.and)((0,G._)`typeof ${t} == "number"`,i,r?(0,G._)`isFinite(${t})`:G.nil)}}le.checkDataType=Br;function cn(e,t,r,n){if(e.length===1)return Br(e[0],t,r,n);let s;const o=(0,ro.toHash)(e);if(o.array&&o.object){const a=(0,G._)`typeof ${t} != "object"`;s=o.null?a:(0,G._)`!${t} || ${a}`,delete o.null,delete o.array,delete o.object}else s=G.nil;o.number&&delete o.integer;for(const a in o)s=(0,G.and)(s,Br(a,t,r,n));return s}le.checkDataTypes=cn;const Ma={message:({schema:e})=>`must be ${e}`,params:({schema:e,schemaValue:t})=>typeof e=="string"?(0,G._)`{type: ${e}}`:(0,G._)`{type: ${t}}`};function ln(e){const t=Da(e);(0,xa.reportError)(t,Ma)}le.reportTypeError=ln;function Da(e){const{gen:t,data:r,schema:n}=e,s=(0,ro.schemaRefOrVal)(e,n,"type");return{gen:t,keyword:"type",data:r,schema:n.type,schemaCode:s,schemaValue:s,parentSchema:n,params:{},it:e}}var St={},ps;function Va(){if(ps)return St;ps=1,Object.defineProperty(St,"__esModule",{value:!0}),St.assignDefaults=void 0;const e=Q,t=q;function r(s,o){const{properties:a,items:i}=s.schema;if(o==="object"&&a)for(const c in a)n(s,c,a[c].default);else o==="array"&&Array.isArray(i)&&i.forEach((c,u)=>n(s,u,c.default))}St.assignDefaults=r;function n(s,o,a){const{gen:i,compositeRule:c,data:u,opts:l}=s;if(a===void 0)return;const f=(0,e._)`${u}${(0,e.getProperty)(o)}`;if(c){(0,t.checkStrictMode)(s,`default is ignored for: ${f}`);return}let w=(0,e._)`${f} === undefined`;l.useDefaults==="empty"&&(w=(0,e._)`${w} || ${f} === null || ${f} === ""`),i.if(w,(0,e._)`${f} = ${(0,e.stringify)(a)}`)}return St}var Ae={},re={},hs;function qe(){if(hs)return re;hs=1,Object.defineProperty(re,"__esModule",{value:!0}),re.validateUnion=re.validateArray=re.usePattern=re.callValidateCode=re.schemaProperties=re.allSchemaProperties=re.noPropertyInData=re.propertyInData=re.isOwnProperty=re.hasPropFunc=re.reportMissingProp=re.checkMissingProp=re.checkReportMissingProp=void 0;const e=Q,t=q,r=Fe,n=q;function s(y,S){const{gen:P,data:N,it:j}=y;P.if(l(P,N,S,j.opts.ownProperties),()=>{y.setParams({missingProperty:(0,e._)`${S}`},!0),y.error()})}re.checkReportMissingProp=s;function o({gen:y,data:S,it:{opts:P}},N,j){return(0,e.or)(...N.map(A=>(0,e.and)(l(y,S,A,P.ownProperties),(0,e._)`${j} = ${A}`)))}re.checkMissingProp=o;function a(y,S){y.setParams({missingProperty:S},!0),y.error()}re.reportMissingProp=a;function i(y){return y.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,e._)`Object.prototype.hasOwnProperty`})}re.hasPropFunc=i;function c(y,S,P){return(0,e._)`${i(y)}.call(${S}, ${P})`}re.isOwnProperty=c;function u(y,S,P,N){const j=(0,e._)`${S}${(0,e.getProperty)(P)} !== undefined`;return N?(0,e._)`${j} && ${c(y,S,P)}`:j}re.propertyInData=u;function l(y,S,P,N){const j=(0,e._)`${S}${(0,e.getProperty)(P)} === undefined`;return N?(0,e.or)(j,(0,e.not)(c(y,S,P))):j}re.noPropertyInData=l;function f(y){return y?Object.keys(y).filter(S=>S!=="__proto__"):[]}re.allSchemaProperties=f;function w(y,S){return f(S).filter(P=>!(0,t.alwaysValidSchema)(y,S[P]))}re.schemaProperties=w;function $({schemaCode:y,data:S,it:{gen:P,topSchemaRef:N,schemaPath:j,errorPath:A},it:V},U,W,Z){const B=Z?(0,e._)`${y}, ${S}, ${N}${j}`:S,Y=[[r.default.instancePath,(0,e.strConcat)(r.default.instancePath,A)],[r.default.parentData,V.parentData],[r.default.parentDataProperty,V.parentDataProperty],[r.default.rootData,r.default.rootData]];V.opts.dynamicRef&&Y.push([r.default.dynamicAnchors,r.default.dynamicAnchors]);const J=(0,e._)`${B}, ${P.object(...Y)}`;return W!==e.nil?(0,e._)`${U}.call(${W}, ${J})`:(0,e._)`${U}(${J})`}re.callValidateCode=$;const p=(0,e._)`new RegExp`;function v({gen:y,it:{opts:S}},P){const N=S.unicodeRegExp?"u":"",{regExp:j}=S.code,A=j(P,N);return y.scopeValue("pattern",{key:A.toString(),ref:A,code:(0,e._)`${j.code==="new RegExp"?p:(0,n.useFunc)(y,j)}(${P}, ${N})`})}re.usePattern=v;function m(y){const{gen:S,data:P,keyword:N,it:j}=y,A=S.name("valid");if(j.allErrors){const U=S.let("valid",!0);return V(()=>S.assign(U,!1)),U}return S.var(A,!0),V(()=>S.break()),A;function V(U){const W=S.const("len",(0,e._)`${P}.length`);S.forRange("i",0,W,Z=>{y.subschema({keyword:N,dataProp:Z,dataPropType:t.Type.Num},A),S.if((0,e.not)(A),U)})}}re.validateArray=m;function h(y){const{gen:S,schema:P,keyword:N,it:j}=y;if(!Array.isArray(P))throw new Error("ajv implementation error");if(P.some(W=>(0,t.alwaysValidSchema)(j,W))&&!j.opts.unevaluated)return;const V=S.let("valid",!1),U=S.name("_valid");S.block(()=>P.forEach((W,Z)=>{const B=y.subschema({keyword:N,schemaProp:Z,compositeRule:!0},U);S.assign(V,(0,e._)`${V} || ${U}`),y.mergeValidEvaluated(B,U)||S.if((0,e.not)(V))})),y.result(V,()=>y.reset(),()=>y.error(!0))}return re.validateUnion=h,re}var ms;function La(){if(ms)return Ae;ms=1,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.validateKeywordUsage=Ae.validSchemaType=Ae.funcKeywordCode=Ae.macroKeywordCode=void 0;const e=Q,t=Fe,r=qe(),n=zt;function s(w,$){const{gen:p,keyword:v,schema:m,parentSchema:h,it:y}=w,S=$.macro.call(y.self,m,h,y),P=u(p,v,S);y.opts.validateSchema!==!1&&y.self.validateSchema(S,!0);const N=p.name("valid");w.subschema({schema:S,schemaPath:e.nil,errSchemaPath:`${y.errSchemaPath}/${v}`,topSchemaRef:P,compositeRule:!0},N),w.pass(N,()=>w.error(!0))}Ae.macroKeywordCode=s;function o(w,$){var p;const{gen:v,keyword:m,schema:h,parentSchema:y,$data:S,it:P}=w;c(P,$);const N=!S&&$.compile?$.compile.call(P.self,h,y,P):$.validate,j=u(v,m,N),A=v.let("valid");w.block$data(A,V),w.ok((p=$.valid)!==null&&p!==void 0?p:A);function V(){if($.errors===!1)Z(),$.modifying&&a(w),B(()=>w.error());else{const Y=$.async?U():W();$.modifying&&a(w),B(()=>i(w,Y))}}function U(){const Y=v.let("ruleErrs",null);return v.try(()=>Z((0,e._)`await `),J=>v.assign(A,!1).if((0,e._)`${J} instanceof ${P.ValidationError}`,()=>v.assign(Y,(0,e._)`${J}.errors`),()=>v.throw(J))),Y}function W(){const Y=(0,e._)`${j}.errors`;return v.assign(Y,null),Z(e.nil),Y}function Z(Y=$.async?(0,e._)`await `:e.nil){const J=P.opts.passContext?t.default.this:t.default.self,pe=!("compile"in $&&!S||$.schema===!1);v.assign(A,(0,e._)`${Y}${(0,r.callValidateCode)(w,j,J,pe)}`,$.modifying)}function B(Y){var J;v.if((0,e.not)((J=$.valid)!==null&&J!==void 0?J:A),Y)}}Ae.funcKeywordCode=o;function a(w){const{gen:$,data:p,it:v}=w;$.if(v.parentData,()=>$.assign(p,(0,e._)`${v.parentData}[${v.parentDataProperty}]`))}function i(w,$){const{gen:p}=w;p.if((0,e._)`Array.isArray(${$})`,()=>{p.assign(t.default.vErrors,(0,e._)`${t.default.vErrors} === null ? ${$} : ${t.default.vErrors}.concat(${$})`).assign(t.default.errors,(0,e._)`${t.default.vErrors}.length`),(0,n.extendErrors)(w)},()=>w.error())}function c({schemaEnv:w},$){if($.async&&!w.$async)throw new Error("async keyword in sync schema")}function u(w,$,p){if(p===void 0)throw new Error(`keyword "${$}" failed to compile`);return w.scopeValue("keyword",typeof p=="function"?{ref:p}:{ref:p,code:(0,e.stringify)(p)})}function l(w,$,p=!1){return!$.length||$.some(v=>v==="array"?Array.isArray(w):v==="object"?w&&typeof w=="object"&&!Array.isArray(w):typeof w==v||p&&typeof w>"u")}Ae.validSchemaType=l;function f({schema:w,opts:$,self:p,errSchemaPath:v},m,h){if(Array.isArray(m.keyword)?!m.keyword.includes(h):m.keyword!==h)throw new Error("ajv implementation error");const y=m.dependencies;if(y?.some(S=>!Object.prototype.hasOwnProperty.call(w,S)))throw new Error(`parent schema must have dependencies of ${h}: ${y.join(",")}`);if(m.validateSchema&&!m.validateSchema(w[h])){const P=`keyword "${h}" value is invalid at path "${v}": `+p.errorsText(m.validateSchema.errors);if($.validateSchema==="log")p.logger.error(P);else throw new Error(P)}}return Ae.validateKeywordUsage=f,Ae}var Ke={},ys;function qa(){if(ys)return Ke;ys=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.extendSubschemaMode=Ke.extendSubschemaData=Ke.getSubschema=void 0;const e=Q,t=q;function r(o,{keyword:a,schemaProp:i,schema:c,schemaPath:u,errSchemaPath:l,topSchemaRef:f}){if(a!==void 0&&c!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(a!==void 0){const w=o.schema[a];return i===void 0?{schema:w,schemaPath:(0,e._)`${o.schemaPath}${(0,e.getProperty)(a)}`,errSchemaPath:`${o.errSchemaPath}/${a}`}:{schema:w[i],schemaPath:(0,e._)`${o.schemaPath}${(0,e.getProperty)(a)}${(0,e.getProperty)(i)}`,errSchemaPath:`${o.errSchemaPath}/${a}/${(0,t.escapeFragment)(i)}`}}if(c!==void 0){if(u===void 0||l===void 0||f===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:c,schemaPath:u,topSchemaRef:f,errSchemaPath:l}}throw new Error('either "keyword" or "schema" must be passed')}Ke.getSubschema=r;function n(o,a,{dataProp:i,dataPropType:c,data:u,dataTypes:l,propertyName:f}){if(u!==void 0&&i!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:w}=a;if(i!==void 0){const{errorPath:p,dataPathArr:v,opts:m}=a,h=w.let("data",(0,e._)`${a.data}${(0,e.getProperty)(i)}`,!0);$(h),o.errorPath=(0,e.str)`${p}${(0,t.getErrorPath)(i,c,m.jsPropertySyntax)}`,o.parentDataProperty=(0,e._)`${i}`,o.dataPathArr=[...v,o.parentDataProperty]}if(u!==void 0){const p=u instanceof e.Name?u:w.let("data",u,!0);$(p),f!==void 0&&(o.propertyName=f)}l&&(o.dataTypes=l);function $(p){o.data=p,o.dataLevel=a.dataLevel+1,o.dataTypes=[],a.definedProperties=new Set,o.parentData=a.data,o.dataNames=[...a.dataNames,p]}}Ke.extendSubschemaData=n;function s(o,{jtdDiscriminator:a,jtdMetadata:i,compositeRule:c,createErrors:u,allErrors:l}){c!==void 0&&(o.compositeRule=c),u!==void 0&&(o.createErrors=u),l!==void 0&&(o.allErrors=l),o.jtdDiscriminator=a,o.jtdMetadata=i}return Ke.extendSubschemaMode=s,Ke}var ge={},oo=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,s,o;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(s=n;s--!==0;)if(!e(t[s],r[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(o=Object.keys(t),n=o.length,n!==Object.keys(r).length)return!1;for(s=n;s--!==0;)if(!Object.prototype.hasOwnProperty.call(r,o[s]))return!1;for(s=n;s--!==0;){var a=o[s];if(!e(t[a],r[a]))return!1}return!0}return t!==t&&r!==r},ao={exports:{}},Xe=ao.exports=function(e,t,r){typeof t=="function"&&(r=t,t={}),r=t.cb||r;var n=typeof r=="function"?r:r.pre||function(){},s=r.post||function(){};nr(t,n,s,e,"",e)};Xe.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};Xe.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};Xe.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};Xe.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function nr(e,t,r,n,s,o,a,i,c,u){if(n&&typeof n=="object"&&!Array.isArray(n)){t(n,s,o,a,i,c,u);for(var l in n){var f=n[l];if(Array.isArray(f)){if(l in Xe.arrayKeywords)for(var w=0;w<f.length;w++)nr(e,t,r,f[w],s+"/"+l+"/"+w,o,s,l,n,w)}else if(l in Xe.propsKeywords){if(f&&typeof f=="object")for(var $ in f)nr(e,t,r,f[$],s+"/"+l+"/"+Ha($),o,s,l,n,$)}else(l in Xe.keywords||e.allKeys&&!(l in Xe.skipKeywords))&&nr(e,t,r,f,s+"/"+l,o,s,l,n)}r(n,s,o,a,i,c,u)}}function Ha(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(ge,"__esModule",{value:!0});ge.getSchemaRefs=ge.resolveUrl=ge.normalizeId=ge._getFullPath=ge.getFullPath=ge.inlineRef=void 0;const za=q,Fa=oo,Ua=ao.exports,Ka=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function Ba(e,t=!0){return typeof e=="boolean"?!0:t===!0?!Wr(e):t?io(e)<=t:!1}ge.inlineRef=Ba;const Wa=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function Wr(e){for(const t in e){if(Wa.has(t))return!0;const r=e[t];if(Array.isArray(r)&&r.some(Wr)||typeof r=="object"&&Wr(r))return!0}return!1}function io(e){let t=0;for(const r in e){if(r==="$ref")return 1/0;if(t++,!Ka.has(r)&&(typeof e[r]=="object"&&(0,za.eachItem)(e[r],n=>t+=io(n)),t===1/0))return 1/0}return t}function co(e,t="",r){r!==!1&&(t=pt(t));const n=e.parse(t);return lo(e,n)}ge.getFullPath=co;function lo(e,t){return e.serialize(t).split("#")[0]+"#"}ge._getFullPath=lo;const Ja=/#\/?$/;function pt(e){return e?e.replace(Ja,""):""}ge.normalizeId=pt;function Ga(e,t,r){return r=pt(r),e.resolve(t,r)}ge.resolveUrl=Ga;const Xa=/^[a-z_][-a-z0-9._]*$/i;function Ya(e,t){if(typeof e=="boolean")return{};const{schemaId:r,uriResolver:n}=this.opts,s=pt(e[r]||t),o={"":s},a=co(n,s,!1),i={},c=new Set;return Ua(e,{allKeys:!0},(f,w,$,p)=>{if(p===void 0)return;const v=a+w;let m=o[p];typeof f[r]=="string"&&(m=h.call(this,f[r])),y.call(this,f.$anchor),y.call(this,f.$dynamicAnchor),o[w]=m;function h(S){const P=this.opts.uriResolver.resolve;if(S=pt(m?P(m,S):S),c.has(S))throw l(S);c.add(S);let N=this.refs[S];return typeof N=="string"&&(N=this.refs[N]),typeof N=="object"?u(f,N.schema,S):S!==pt(v)&&(S[0]==="#"?(u(f,i[S],S),i[S]=f):this.refs[S]=v),S}function y(S){if(typeof S=="string"){if(!Xa.test(S))throw new Error(`invalid anchor "${S}"`);h.call(this,`#${S}`)}}}),i;function u(f,w,$){if(w!==void 0&&!Fa(f,w))throw l($)}function l(f){return new Error(`reference "${f}" resolves to more than one schema`)}}ge.getSchemaRefs=Ya;var gs;function $r(){if(gs)return Ue;gs=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.getData=Ue.KeywordCxt=Ue.validateFunctionCode=void 0;const e=ba(),t=le,r=Be,n=le,s=Va(),o=La(),a=qa(),i=Q,c=Fe,u=ge,l=q,f=zt;function w(b){if(N(b)&&(A(b),P(b))){m(b);return}$(b,()=>(0,e.topBoolOrEmptySchema)(b))}Ue.validateFunctionCode=w;function $({gen:b,validateName:k,schema:R,schemaEnv:M,opts:H},K){H.code.es5?b.func(k,(0,i._)`${c.default.data}, ${c.default.valCxt}`,M.$async,()=>{b.code((0,i._)`"use strict"; ${y(R,H)}`),v(b,H),b.code(K)}):b.func(k,(0,i._)`${c.default.data}, ${p(H)}`,M.$async,()=>b.code(y(R,H)).code(K))}function p(b){return(0,i._)`{${c.default.instancePath}="", ${c.default.parentData}, ${c.default.parentDataProperty}, ${c.default.rootData}=${c.default.data}${b.dynamicRef?(0,i._)`, ${c.default.dynamicAnchors}={}`:i.nil}}={}`}function v(b,k){b.if(c.default.valCxt,()=>{b.var(c.default.instancePath,(0,i._)`${c.default.valCxt}.${c.default.instancePath}`),b.var(c.default.parentData,(0,i._)`${c.default.valCxt}.${c.default.parentData}`),b.var(c.default.parentDataProperty,(0,i._)`${c.default.valCxt}.${c.default.parentDataProperty}`),b.var(c.default.rootData,(0,i._)`${c.default.valCxt}.${c.default.rootData}`),k.dynamicRef&&b.var(c.default.dynamicAnchors,(0,i._)`${c.default.valCxt}.${c.default.dynamicAnchors}`)},()=>{b.var(c.default.instancePath,(0,i._)`""`),b.var(c.default.parentData,(0,i._)`undefined`),b.var(c.default.parentDataProperty,(0,i._)`undefined`),b.var(c.default.rootData,c.default.data),k.dynamicRef&&b.var(c.default.dynamicAnchors,(0,i._)`{}`)})}function m(b){const{schema:k,opts:R,gen:M}=b;$(b,()=>{R.$comment&&k.$comment&&Y(b),W(b),M.let(c.default.vErrors,null),M.let(c.default.errors,0),R.unevaluated&&h(b),V(b),J(b)})}function h(b){const{gen:k,validateName:R}=b;b.evaluated=k.const("evaluated",(0,i._)`${R}.evaluated`),k.if((0,i._)`${b.evaluated}.dynamicProps`,()=>k.assign((0,i._)`${b.evaluated}.props`,(0,i._)`undefined`)),k.if((0,i._)`${b.evaluated}.dynamicItems`,()=>k.assign((0,i._)`${b.evaluated}.items`,(0,i._)`undefined`))}function y(b,k){const R=typeof b=="object"&&b[k.schemaId];return R&&(k.code.source||k.code.process)?(0,i._)`/*# sourceURL=${R} */`:i.nil}function S(b,k){if(N(b)&&(A(b),P(b))){j(b,k);return}(0,e.boolOrEmptySchema)(b,k)}function P({schema:b,self:k}){if(typeof b=="boolean")return!b;for(const R in b)if(k.RULES.all[R])return!0;return!1}function N(b){return typeof b.schema!="boolean"}function j(b,k){const{schema:R,gen:M,opts:H}=b;H.$comment&&R.$comment&&Y(b),Z(b),B(b);const K=M.const("_errs",c.default.errors);V(b,K),M.var(k,(0,i._)`${K} === ${c.default.errors}`)}function A(b){(0,l.checkUnknownRules)(b),U(b)}function V(b,k){if(b.opts.jtd)return ce(b,[],!1,k);const R=(0,t.getSchemaTypes)(b.schema),M=(0,t.coerceAndCheckDataType)(b,R);ce(b,R,!M,k)}function U(b){const{schema:k,errSchemaPath:R,opts:M,self:H}=b;k.$ref&&M.ignoreKeywordsWithRef&&(0,l.schemaHasRulesButRef)(k,H.RULES)&&H.logger.warn(`$ref: keywords ignored in schema at path "${R}"`)}function W(b){const{schema:k,opts:R}=b;k.default!==void 0&&R.useDefaults&&R.strictSchema&&(0,l.checkStrictMode)(b,"default is ignored in the schema root")}function Z(b){const k=b.schema[b.opts.schemaId];k&&(b.baseId=(0,u.resolveUrl)(b.opts.uriResolver,b.baseId,k))}function B(b){if(b.schema.$async&&!b.schemaEnv.$async)throw new Error("async schema in sync schema")}function Y({gen:b,schemaEnv:k,schema:R,errSchemaPath:M,opts:H}){const K=R.$comment;if(H.$comment===!0)b.code((0,i._)`${c.default.self}.logger.log(${K})`);else if(typeof H.$comment=="function"){const se=(0,i.str)`${M}/$comment`,Ce=b.scopeValue("root",{ref:k.root});b.code((0,i._)`${c.default.self}.opts.$comment(${K}, ${se}, ${Ce}.schema)`)}}function J(b){const{gen:k,schemaEnv:R,validateName:M,ValidationError:H,opts:K}=b;R.$async?k.if((0,i._)`${c.default.errors} === 0`,()=>k.return(c.default.data),()=>k.throw((0,i._)`new ${H}(${c.default.vErrors})`)):(k.assign((0,i._)`${M}.errors`,c.default.vErrors),K.unevaluated&&pe(b),k.return((0,i._)`${c.default.errors} === 0`))}function pe({gen:b,evaluated:k,props:R,items:M}){R instanceof i.Name&&b.assign((0,i._)`${k}.props`,R),M instanceof i.Name&&b.assign((0,i._)`${k}.items`,M)}function ce(b,k,R,M){const{gen:H,schema:K,data:se,allErrors:Ce,opts:ke,self:Pe}=b,{RULES:he}=Pe;if(K.$ref&&(ke.ignoreKeywordsWithRef||!(0,l.schemaHasRulesButRef)(K,he))){H.block(()=>C(b,"$ref",he.all.$ref.definition));return}ke.jtd||T(b,k),H.block(()=>{for(const xe of he.rules)ct(xe);ct(he.post)});function ct(xe){!(0,r.shouldUseGroup)(K,xe)||(xe.type?(H.if((0,n.checkDataType)(xe.type,se,ke.strictNumbers)),fe(b,xe),k.length===1&&k[0]===xe.type&&R&&(H.else(),(0,n.reportTypeError)(b)),H.endIf()):fe(b,xe),Ce||H.if((0,i._)`${c.default.errors} === ${M||0}`))}}function fe(b,k){const{gen:R,schema:M,opts:{useDefaults:H}}=b;H&&(0,s.assignDefaults)(b,k.type),R.block(()=>{for(const K of k.rules)(0,r.shouldUseRule)(M,K)&&C(b,K.keyword,K.definition,k.type)})}function T(b,k){b.schemaEnv.meta||!b.opts.strictTypes||(L(b,k),b.opts.allowUnionTypes||x(b,k),E(b,b.dataTypes))}function L(b,k){if(!!k.length){if(!b.dataTypes.length){b.dataTypes=k;return}k.forEach(R=>{_(b.dataTypes,R)||g(b,`type "${R}" not allowed by context "${b.dataTypes.join(",")}"`)}),d(b,k)}}function x(b,k){k.length>1&&!(k.length===2&&k.includes("null"))&&g(b,"use allowUnionTypes to allow union type keyword")}function E(b,k){const R=b.self.RULES.all;for(const M in R){const H=R[M];if(typeof H=="object"&&(0,r.shouldUseRule)(b.schema,H)){const{type:K}=H.definition;K.length&&!K.some(se=>I(k,se))&&g(b,`missing type "${K.join(",")}" for keyword "${M}"`)}}}function I(b,k){return b.includes(k)||k==="number"&&b.includes("integer")}function _(b,k){return b.includes(k)||k==="integer"&&b.includes("number")}function d(b,k){const R=[];for(const M of b.dataTypes)_(k,M)?R.push(M):k.includes("integer")&&M==="number"&&R.push("integer");b.dataTypes=R}function g(b,k){const R=b.schemaEnv.baseId+b.errSchemaPath;k+=` at "${R}" (strictTypes)`,(0,l.checkStrictMode)(b,k,b.opts.strictTypes)}class O{constructor(k,R,M){if((0,o.validateKeywordUsage)(k,R,M),this.gen=k.gen,this.allErrors=k.allErrors,this.keyword=M,this.data=k.data,this.schema=k.schema[M],this.$data=R.$data&&k.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,l.schemaRefOrVal)(k,this.schema,M,this.$data),this.schemaType=R.schemaType,this.parentSchema=k.schema,this.params={},this.it=k,this.def=R,this.$data)this.schemaCode=k.gen.const("vSchema",F(this.$data,k));else if(this.schemaCode=this.schemaValue,!(0,o.validSchemaType)(this.schema,R.schemaType,R.allowUndefined))throw new Error(`${M} value must be ${JSON.stringify(R.schemaType)}`);("code"in R?R.trackErrors:R.errors!==!1)&&(this.errsCount=k.gen.const("_errs",c.default.errors))}result(k,R,M){this.failResult((0,i.not)(k),R,M)}failResult(k,R,M){this.gen.if(k),M?M():this.error(),R?(this.gen.else(),R(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(k,R){this.failResult((0,i.not)(k),void 0,R)}fail(k){if(k===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(k),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(k){if(!this.$data)return this.fail(k);const{schemaCode:R}=this;this.fail((0,i._)`${R} !== undefined && (${(0,i.or)(this.invalid$data(),k)})`)}error(k,R,M){if(R){this.setParams(R),this._error(k,M),this.setParams({});return}this._error(k,M)}_error(k,R){(k?f.reportExtraError:f.reportError)(this,this.def.error,R)}$dataError(){(0,f.reportError)(this,this.def.$dataError||f.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,f.resetErrorsCount)(this.gen,this.errsCount)}ok(k){this.allErrors||this.gen.if(k)}setParams(k,R){R?Object.assign(this.params,k):this.params=k}block$data(k,R,M=i.nil){this.gen.block(()=>{this.check$data(k,M),R()})}check$data(k=i.nil,R=i.nil){if(!this.$data)return;const{gen:M,schemaCode:H,schemaType:K,def:se}=this;M.if((0,i.or)((0,i._)`${H} === undefined`,R)),k!==i.nil&&M.assign(k,!0),(K.length||se.validateSchema)&&(M.elseIf(this.invalid$data()),this.$dataError(),k!==i.nil&&M.assign(k,!1)),M.else()}invalid$data(){const{gen:k,schemaCode:R,schemaType:M,def:H,it:K}=this;return(0,i.or)(se(),Ce());function se(){if(M.length){if(!(R instanceof i.Name))throw new Error("ajv implementation error");const ke=Array.isArray(M)?M:[M];return(0,i._)`${(0,n.checkDataTypes)(ke,R,K.opts.strictNumbers,n.DataType.Wrong)}`}return i.nil}function Ce(){if(H.validateSchema){const ke=k.scopeValue("validate$data",{ref:H.validateSchema});return(0,i._)`!${ke}(${R})`}return i.nil}}subschema(k,R){const M=(0,a.getSubschema)(this.it,k);(0,a.extendSubschemaData)(M,this.it,k),(0,a.extendSubschemaMode)(M,k);const H={...this.it,...M,items:void 0,props:void 0};return S(H,R),H}mergeEvaluated(k,R){const{it:M,gen:H}=this;!M.opts.unevaluated||(M.props!==!0&&k.props!==void 0&&(M.props=l.mergeEvaluated.props(H,k.props,M.props,R)),M.items!==!0&&k.items!==void 0&&(M.items=l.mergeEvaluated.items(H,k.items,M.items,R)))}mergeValidEvaluated(k,R){const{it:M,gen:H}=this;if(M.opts.unevaluated&&(M.props!==!0||M.items!==!0))return H.if(R,()=>this.mergeEvaluated(k,i.Name)),!0}}Ue.KeywordCxt=O;function C(b,k,R,M){const H=new O(b,R,k);"code"in R?R.code(H,M):H.$data&&R.validate?(0,o.funcKeywordCode)(H,R):"macro"in R?(0,o.macroKeywordCode)(H,R):(R.compile||R.validate)&&(0,o.funcKeywordCode)(H,R)}const D=/^\/(?:[^~]|~0|~1)*$/,z=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function F(b,{dataLevel:k,dataNames:R,dataPathArr:M}){let H,K;if(b==="")return c.default.rootData;if(b[0]==="/"){if(!D.test(b))throw new Error(`Invalid JSON-pointer: ${b}`);H=b,K=c.default.rootData}else{const Pe=z.exec(b);if(!Pe)throw new Error(`Invalid JSON-pointer: ${b}`);const he=+Pe[1];if(H=Pe[2],H==="#"){if(he>=k)throw new Error(ke("property/index",he));return M[k-he]}if(he>k)throw new Error(ke("data",he));if(K=R[k-he],!H)return K}let se=K;const Ce=H.split("/");for(const Pe of Ce)Pe&&(K=(0,i._)`${K}${(0,i.getProperty)((0,l.unescapeJsonPointer)(Pe))}`,se=(0,i._)`${se} && ${K}`);return se;function ke(Pe,he){return`Cannot access ${Pe} ${he} levels up, current level is ${k}`}}return Ue.getData=F,Ue}var Bt={},$s;function un(){if($s)return Bt;$s=1,Object.defineProperty(Bt,"__esModule",{value:!0});class e extends Error{constructor(r){super("validation failed"),this.errors=r,this.ajv=this.validation=!0}}return Bt.default=e,Bt}var $t={};Object.defineProperty($t,"__esModule",{value:!0});const Ar=ge;class Qa extends Error{constructor(t,r,n,s){super(s||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,Ar.resolveUrl)(t,r,n),this.missingSchema=(0,Ar.normalizeId)((0,Ar.getFullPath)(t,this.missingRef))}}$t.default=Qa;var Ne={};Object.defineProperty(Ne,"__esModule",{value:!0});Ne.resolveSchema=Ne.getCompilingSchema=Ne.resolveRef=Ne.compileSchema=Ne.SchemaEnv=void 0;const Me=Q,Za=un(),et=Fe,Ve=ge,vs=q,ei=$r();class vr{constructor(t){var r;this.refs={},this.dynamicAnchors={};let n;typeof t.schema=="object"&&(n=t.schema),this.schema=t.schema,this.schemaId=t.schemaId,this.root=t.root||this,this.baseId=(r=t.baseId)!==null&&r!==void 0?r:(0,Ve.normalizeId)(n?.[t.schemaId||"$id"]),this.schemaPath=t.schemaPath,this.localRefs=t.localRefs,this.meta=t.meta,this.$async=n?.$async,this.refs={}}}Ne.SchemaEnv=vr;function dn(e){const t=uo.call(this,e);if(t)return t;const r=(0,Ve.getFullPath)(this.opts.uriResolver,e.root.baseId),{es5:n,lines:s}=this.opts.code,{ownProperties:o}=this.opts,a=new Me.CodeGen(this.scope,{es5:n,lines:s,ownProperties:o});let i;e.$async&&(i=a.scopeValue("Error",{ref:Za.default,code:(0,Me._)`require("ajv/dist/runtime/validation_error").default`}));const c=a.scopeName("validate");e.validateName=c;const u={gen:a,allErrors:this.opts.allErrors,data:et.default.data,parentData:et.default.parentData,parentDataProperty:et.default.parentDataProperty,dataNames:[et.default.data],dataPathArr:[Me.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:a.scopeValue("schema",this.opts.code.source===!0?{ref:e.schema,code:(0,Me.stringify)(e.schema)}:{ref:e.schema}),validateName:c,ValidationError:i,schema:e.schema,schemaEnv:e,rootId:r,baseId:e.baseId||r,schemaPath:Me.nil,errSchemaPath:e.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,Me._)`""`,opts:this.opts,self:this};let l;try{this._compilations.add(e),(0,ei.validateFunctionCode)(u),a.optimize(this.opts.code.optimize);const f=a.toString();l=`${a.scopeRefs(et.default.scope)}return ${f}`,this.opts.code.process&&(l=this.opts.code.process(l,e));const $=new Function(`${et.default.self}`,`${et.default.scope}`,l)(this,this.scope.get());if(this.scope.value(c,{ref:$}),$.errors=null,$.schema=e.schema,$.schemaEnv=e,e.$async&&($.$async=!0),this.opts.code.source===!0&&($.source={validateName:c,validateCode:f,scopeValues:a._values}),this.opts.unevaluated){const{props:p,items:v}=u;$.evaluated={props:p instanceof Me.Name?void 0:p,items:v instanceof Me.Name?void 0:v,dynamicProps:p instanceof Me.Name,dynamicItems:v instanceof Me.Name},$.source&&($.source.evaluated=(0,Me.stringify)($.evaluated))}return e.validate=$,e}catch(f){throw delete e.validate,delete e.validateName,l&&this.logger.error("Error compiling schema, function code:",l),f}finally{this._compilations.delete(e)}}Ne.compileSchema=dn;function ti(e,t,r){var n;r=(0,Ve.resolveUrl)(this.opts.uriResolver,t,r);const s=e.refs[r];if(s)return s;let o=si.call(this,e,r);if(o===void 0){const a=(n=e.localRefs)===null||n===void 0?void 0:n[r],{schemaId:i}=this.opts;a&&(o=new vr({schema:a,schemaId:i,root:e,baseId:t}))}if(o!==void 0)return e.refs[r]=ri.call(this,o)}Ne.resolveRef=ti;function ri(e){return(0,Ve.inlineRef)(e.schema,this.opts.inlineRefs)?e.schema:e.validate?e:dn.call(this,e)}function uo(e){for(const t of this._compilations)if(ni(t,e))return t}Ne.getCompilingSchema=uo;function ni(e,t){return e.schema===t.schema&&e.root===t.root&&e.baseId===t.baseId}function si(e,t){let r;for(;typeof(r=this.refs[t])=="string";)t=r;return r||this.schemas[t]||wr.call(this,e,t)}function wr(e,t){const r=this.opts.uriResolver.parse(t),n=(0,Ve._getFullPath)(this.opts.uriResolver,r);let s=(0,Ve.getFullPath)(this.opts.uriResolver,e.baseId,void 0);if(Object.keys(e.schema).length>0&&n===s)return Mr.call(this,r,e);const o=(0,Ve.normalizeId)(n),a=this.refs[o]||this.schemas[o];if(typeof a=="string"){const i=wr.call(this,e,a);return typeof i?.schema!="object"?void 0:Mr.call(this,r,i)}if(typeof a?.schema=="object"){if(a.validate||dn.call(this,a),o===(0,Ve.normalizeId)(t)){const{schema:i}=a,{schemaId:c}=this.opts,u=i[c];return u&&(s=(0,Ve.resolveUrl)(this.opts.uriResolver,s,u)),new vr({schema:i,schemaId:c,root:e,baseId:s})}return Mr.call(this,r,a)}}Ne.resolveSchema=wr;const oi=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function Mr(e,{baseId:t,schema:r,root:n}){var s;if(((s=e.fragment)===null||s===void 0?void 0:s[0])!=="/")return;for(const i of e.fragment.slice(1).split("/")){if(typeof r=="boolean")return;const c=r[(0,vs.unescapeFragment)(i)];if(c===void 0)return;r=c;const u=typeof r=="object"&&r[this.opts.schemaId];!oi.has(i)&&u&&(t=(0,Ve.resolveUrl)(this.opts.uriResolver,t,u))}let o;if(typeof r!="boolean"&&r.$ref&&!(0,vs.schemaHasRulesButRef)(r,this.RULES)){const i=(0,Ve.resolveUrl)(this.opts.uriResolver,t,r.$ref);o=wr.call(this,n,i)}const{schemaId:a}=this.opts;if(o=o||new vr({schema:r,schemaId:a,root:n,baseId:t}),o.schema!==o.root.schema)return o}const ai="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",ii="Meta-schema for $data reference (JSON AnySchema extension proposal)",ci="object",li=["$data"],ui={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},di=!1,fi={$id:ai,description:ii,type:ci,required:li,properties:ui,additionalProperties:di};var fn={},_r={exports:{}};const pi=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),fo=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function pn(e){let t="",r=0,n=0;for(n=0;n<e.length;n++)if(r=e[n].charCodeAt(0),r!==48){if(!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";t+=e[n];break}for(n+=1;n<e.length;n++){if(r=e[n].charCodeAt(0),!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";t+=e[n]}return t}const hi=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function ws(e){return e.length=0,!0}function mi(e,t,r){if(e.length){const n=pn(e);if(n!=="")t.push(n);else return r.error=!0,!1;e.length=0}return!0}function yi(e){let t=0;const r={error:!1,address:"",zone:""},n=[],s=[];let o=!1,a=!1,i=mi;for(let c=0;c<e.length;c++){const u=e[c];if(!(u==="["||u==="]"))if(u===":"){if(o===!0&&(a=!0),!i(s,n,r))break;if(++t>7){r.error=!0;break}c>0&&e[c-1]===":"&&(o=!0),n.push(":");continue}else if(u==="%"){if(!i(s,n,r))break;i=ws}else{s.push(u);continue}}return s.length&&(i===ws?r.zone=s.join(""):a?n.push(s.join("")):n.push(pn(s))),r.address=n.join(""),r}function po(e){if(gi(e,":")<2)return{host:e,isIPV6:!1};const t=yi(e);if(t.error)return{host:e,isIPV6:!1};{let r=t.address,n=t.address;return t.zone&&(r+="%"+t.zone,n+="%25"+t.zone),{host:r,isIPV6:!0,escapedHost:n}}}function gi(e,t){let r=0;for(let n=0;n<e.length;n++)e[n]===t&&r++;return r}function $i(e){let t=e;const r=[];let n=-1,s=0;for(;s=t.length;){if(s===1){if(t===".")break;if(t==="/"){r.push("/");break}else{r.push(t);break}}else if(s===2){if(t[0]==="."){if(t[1]===".")break;if(t[1]==="/"){t=t.slice(2);continue}}else if(t[0]==="/"&&(t[1]==="."||t[1]==="/")){r.push("/");break}}else if(s===3&&t==="/.."){r.length!==0&&r.pop(),r.push("/");break}if(t[0]==="."){if(t[1]==="."){if(t[2]==="/"){t=t.slice(3);continue}}else if(t[1]==="/"){t=t.slice(2);continue}}else if(t[0]==="/"&&t[1]==="."){if(t[2]==="/"){t=t.slice(2);continue}else if(t[2]==="."&&t[3]==="/"){t=t.slice(3),r.length!==0&&r.pop();continue}}if((n=t.indexOf("/",1))===-1){r.push(t);break}else r.push(t.slice(0,n)),t=t.slice(n)}return r.join("")}function vi(e,t){const r=t!==!0?escape:unescape;return e.scheme!==void 0&&(e.scheme=r(e.scheme)),e.userinfo!==void 0&&(e.userinfo=r(e.userinfo)),e.host!==void 0&&(e.host=r(e.host)),e.path!==void 0&&(e.path=r(e.path)),e.query!==void 0&&(e.query=r(e.query)),e.fragment!==void 0&&(e.fragment=r(e.fragment)),e}function wi(e){const t=[];if(e.userinfo!==void 0&&(t.push(e.userinfo),t.push("@")),e.host!==void 0){let r=unescape(e.host);if(!fo(r)){const n=po(r);n.isIPV6===!0?r=`[${n.escapedHost}]`:r=e.host}t.push(r)}return(typeof e.port=="number"||typeof e.port=="string")&&(t.push(":"),t.push(String(e.port))),t.length?t.join(""):void 0}var ho={nonSimpleDomain:hi,recomposeAuthority:wi,normalizeComponentEncoding:vi,removeDotSegments:$i,isIPv4:fo,isUUID:pi,normalizeIPv6:po,stringArrayToHexStripped:pn};const{isUUID:_i}=ho,bi=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,Ei=["http","https","ws","wss","urn","urn:uuid"];function Si(e){return Ei.indexOf(e)!==-1}function hn(e){return e.secure===!0?!0:e.secure===!1?!1:e.scheme?e.scheme.length===3&&(e.scheme[0]==="w"||e.scheme[0]==="W")&&(e.scheme[1]==="s"||e.scheme[1]==="S")&&(e.scheme[2]==="s"||e.scheme[2]==="S"):!1}function mo(e){return e.host||(e.error=e.error||"HTTP URIs must have a host."),e}function yo(e){const t=String(e.scheme).toLowerCase()==="https";return(e.port===(t?443:80)||e.port==="")&&(e.port=void 0),e.path||(e.path="/"),e}function ki(e){return e.secure=hn(e),e.resourceName=(e.path||"/")+(e.query?"?"+e.query:""),e.path=void 0,e.query=void 0,e}function Pi(e){if((e.port===(hn(e)?443:80)||e.port==="")&&(e.port=void 0),typeof e.secure=="boolean"&&(e.scheme=e.secure?"wss":"ws",e.secure=void 0),e.resourceName){const[t,r]=e.resourceName.split("?");e.path=t&&t!=="/"?t:void 0,e.query=r,e.resourceName=void 0}return e.fragment=void 0,e}function Oi(e,t){if(!e.path)return e.error="URN can not be parsed",e;const r=e.path.match(bi);if(r){const n=t.scheme||e.scheme||"urn";e.nid=r[1].toLowerCase(),e.nss=r[2];const s=`${n}:${t.nid||e.nid}`,o=mn(s);e.path=void 0,o&&(e=o.parse(e,t))}else e.error=e.error||"URN can not be parsed.";return e}function ji(e,t){if(e.nid===void 0)throw new Error("URN without nid cannot be serialized");const r=t.scheme||e.scheme||"urn",n=e.nid.toLowerCase(),s=`${r}:${t.nid||n}`,o=mn(s);o&&(e=o.serialize(e,t));const a=e,i=e.nss;return a.path=`${n||t.nid}:${i}`,t.skipEscape=!0,a}function Ni(e,t){const r=e;return r.uuid=r.nss,r.nss=void 0,!t.tolerant&&(!r.uuid||!_i(r.uuid))&&(r.error=r.error||"UUID is not valid."),r}function xi(e){const t=e;return t.nss=(e.uuid||"").toLowerCase(),t}const go={scheme:"http",domainHost:!0,parse:mo,serialize:yo},Ii={scheme:"https",domainHost:go.domainHost,parse:mo,serialize:yo},sr={scheme:"ws",domainHost:!0,parse:ki,serialize:Pi},Ri={scheme:"wss",domainHost:sr.domainHost,parse:sr.parse,serialize:sr.serialize},Ti={scheme:"urn",parse:Oi,serialize:ji,skipNormalize:!0},Ci={scheme:"urn:uuid",parse:Ni,serialize:xi,skipNormalize:!0},dr={http:go,https:Ii,ws:sr,wss:Ri,urn:Ti,"urn:uuid":Ci};Object.setPrototypeOf(dr,null);function mn(e){return e&&(dr[e]||dr[e.toLowerCase()])||void 0}var Ai={wsIsSecure:hn,SCHEMES:dr,isValidSchemeName:Si,getSchemeHandler:mn};const{normalizeIPv6:Mi,removeDotSegments:Ot,recomposeAuthority:Di,normalizeComponentEncoding:Wt,isIPv4:Vi,nonSimpleDomain:Li}=ho,{SCHEMES:qi,getSchemeHandler:$o}=Ai;function Hi(e,t){return typeof e=="string"?e=ze(We(e,t),t):typeof e=="object"&&(e=We(ze(e,t),t)),e}function zi(e,t,r){const n=r?Object.assign({scheme:"null"},r):{scheme:"null"},s=vo(We(e,n),We(t,n),n,!0);return n.skipEscape=!0,ze(s,n)}function vo(e,t,r,n){const s={};return n||(e=We(ze(e,r),r),t=We(ze(t,r),r)),r=r||{},!r.tolerant&&t.scheme?(s.scheme=t.scheme,s.userinfo=t.userinfo,s.host=t.host,s.port=t.port,s.path=Ot(t.path||""),s.query=t.query):(t.userinfo!==void 0||t.host!==void 0||t.port!==void 0?(s.userinfo=t.userinfo,s.host=t.host,s.port=t.port,s.path=Ot(t.path||""),s.query=t.query):(t.path?(t.path[0]==="/"?s.path=Ot(t.path):((e.userinfo!==void 0||e.host!==void 0||e.port!==void 0)&&!e.path?s.path="/"+t.path:e.path?s.path=e.path.slice(0,e.path.lastIndexOf("/")+1)+t.path:s.path=t.path,s.path=Ot(s.path)),s.query=t.query):(s.path=e.path,t.query!==void 0?s.query=t.query:s.query=e.query),s.userinfo=e.userinfo,s.host=e.host,s.port=e.port),s.scheme=e.scheme),s.fragment=t.fragment,s}function Fi(e,t,r){return typeof e=="string"?(e=unescape(e),e=ze(Wt(We(e,r),!0),{...r,skipEscape:!0})):typeof e=="object"&&(e=ze(Wt(e,!0),{...r,skipEscape:!0})),typeof t=="string"?(t=unescape(t),t=ze(Wt(We(t,r),!0),{...r,skipEscape:!0})):typeof t=="object"&&(t=ze(Wt(t,!0),{...r,skipEscape:!0})),e.toLowerCase()===t.toLowerCase()}function ze(e,t){const r={host:e.host,scheme:e.scheme,userinfo:e.userinfo,port:e.port,path:e.path,query:e.query,nid:e.nid,nss:e.nss,uuid:e.uuid,fragment:e.fragment,reference:e.reference,resourceName:e.resourceName,secure:e.secure,error:""},n=Object.assign({},t),s=[],o=$o(n.scheme||r.scheme);o&&o.serialize&&o.serialize(r,n),r.path!==void 0&&(n.skipEscape?r.path=unescape(r.path):(r.path=escape(r.path),r.scheme!==void 0&&(r.path=r.path.split("%3A").join(":")))),n.reference!=="suffix"&&r.scheme&&s.push(r.scheme,":");const a=Di(r);if(a!==void 0&&(n.reference!=="suffix"&&s.push("//"),s.push(a),r.path&&r.path[0]!=="/"&&s.push("/")),r.path!==void 0){let i=r.path;!n.absolutePath&&(!o||!o.absolutePath)&&(i=Ot(i)),a===void 0&&i[0]==="/"&&i[1]==="/"&&(i="/%2F"+i.slice(2)),s.push(i)}return r.query!==void 0&&s.push("?",r.query),r.fragment!==void 0&&s.push("#",r.fragment),s.join("")}const Ui=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function We(e,t){const r=Object.assign({},t),n={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0};let s=!1;r.reference==="suffix"&&(r.scheme?e=r.scheme+":"+e:e="//"+e);const o=e.match(Ui);if(o){if(n.scheme=o[1],n.userinfo=o[3],n.host=o[4],n.port=parseInt(o[5],10),n.path=o[6]||"",n.query=o[7],n.fragment=o[8],isNaN(n.port)&&(n.port=o[5]),n.host)if(Vi(n.host)===!1){const c=Mi(n.host);n.host=c.host.toLowerCase(),s=c.isIPV6}else s=!0;n.scheme===void 0&&n.userinfo===void 0&&n.host===void 0&&n.port===void 0&&n.query===void 0&&!n.path?n.reference="same-document":n.scheme===void 0?n.reference="relative":n.fragment===void 0?n.reference="absolute":n.reference="uri",r.reference&&r.reference!=="suffix"&&r.reference!==n.reference&&(n.error=n.error||"URI is not a "+r.reference+" reference.");const a=$o(r.scheme||n.scheme);if(!r.unicodeSupport&&(!a||!a.unicodeSupport)&&n.host&&(r.domainHost||a&&a.domainHost)&&s===!1&&Li(n.host))try{n.host=URL.domainToASCII(n.host.toLowerCase())}catch(i){n.error=n.error||"Host's domain name can not be converted to ASCII: "+i}(!a||a&&!a.skipNormalize)&&(e.indexOf("%")!==-1&&(n.scheme!==void 0&&(n.scheme=unescape(n.scheme)),n.host!==void 0&&(n.host=unescape(n.host))),n.path&&(n.path=escape(unescape(n.path))),n.fragment&&(n.fragment=encodeURI(decodeURIComponent(n.fragment)))),a&&a.parse&&a.parse(n,r)}else n.error=n.error||"URI can not be parsed.";return n}const yn={SCHEMES:qi,normalize:Hi,resolve:zi,resolveComponent:vo,equal:Fi,serialize:ze,parse:We};_r.exports=yn;_r.exports.default=yn;_r.exports.fastUri=yn;Object.defineProperty(fn,"__esModule",{value:!0});const wo=_r.exports;wo.code='require("ajv/dist/runtime/uri").default';fn.default=wo;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=void 0;var t=$r();Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return t.KeywordCxt}});var r=Q;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return r._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return r.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return r.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return r.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return r.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return r.CodeGen}});const n=un(),s=$t,o=st,a=Ne,i=Q,c=ge,u=le,l=q,f=fi,w=fn,$=(x,E)=>new RegExp(x,E);$.code="new RegExp";const p=["removeAdditional","useDefaults","coerceTypes"],v=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),m={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},h={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},y=200;function S(x){var E,I,_,d,g,O,C,D,z,F,b,k,R,M,H,K,se,Ce,ke,Pe,he,ct,xe,Ir,Rr;const Et=x.strict,Tr=(E=x.code)===null||E===void 0?void 0:E.optimize,as=Tr===!0||Tr===void 0?1:Tr||0,is=(_=(I=x.code)===null||I===void 0?void 0:I.regExp)!==null&&_!==void 0?_:$,na=(d=x.uriResolver)!==null&&d!==void 0?d:w.default;return{strictSchema:(O=(g=x.strictSchema)!==null&&g!==void 0?g:Et)!==null&&O!==void 0?O:!0,strictNumbers:(D=(C=x.strictNumbers)!==null&&C!==void 0?C:Et)!==null&&D!==void 0?D:!0,strictTypes:(F=(z=x.strictTypes)!==null&&z!==void 0?z:Et)!==null&&F!==void 0?F:"log",strictTuples:(k=(b=x.strictTuples)!==null&&b!==void 0?b:Et)!==null&&k!==void 0?k:"log",strictRequired:(M=(R=x.strictRequired)!==null&&R!==void 0?R:Et)!==null&&M!==void 0?M:!1,code:x.code?{...x.code,optimize:as,regExp:is}:{optimize:as,regExp:is},loopRequired:(H=x.loopRequired)!==null&&H!==void 0?H:y,loopEnum:(K=x.loopEnum)!==null&&K!==void 0?K:y,meta:(se=x.meta)!==null&&se!==void 0?se:!0,messages:(Ce=x.messages)!==null&&Ce!==void 0?Ce:!0,inlineRefs:(ke=x.inlineRefs)!==null&&ke!==void 0?ke:!0,schemaId:(Pe=x.schemaId)!==null&&Pe!==void 0?Pe:"$id",addUsedSchema:(he=x.addUsedSchema)!==null&&he!==void 0?he:!0,validateSchema:(ct=x.validateSchema)!==null&&ct!==void 0?ct:!0,validateFormats:(xe=x.validateFormats)!==null&&xe!==void 0?xe:!0,unicodeRegExp:(Ir=x.unicodeRegExp)!==null&&Ir!==void 0?Ir:!0,int32range:(Rr=x.int32range)!==null&&Rr!==void 0?Rr:!0,uriResolver:na}}class P{constructor(E={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,E=this.opts={...E,...S(E)};const{es5:I,lines:_}=this.opts.code;this.scope=new i.ValueScope({scope:{},prefixes:v,es5:I,lines:_}),this.logger=B(E.logger);const d=E.validateFormats;E.validateFormats=!1,this.RULES=(0,o.getRules)(),N.call(this,m,E,"NOT SUPPORTED"),N.call(this,h,E,"DEPRECATED","warn"),this._metaOpts=W.call(this),E.formats&&V.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),E.keywords&&U.call(this,E.keywords),typeof E.meta=="object"&&this.addMetaSchema(E.meta),A.call(this),E.validateFormats=d}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:E,meta:I,schemaId:_}=this.opts;let d=f;_==="id"&&(d={...f},d.id=d.$id,delete d.$id),I&&E&&this.addMetaSchema(d,d[_],!1)}defaultMeta(){const{meta:E,schemaId:I}=this.opts;return this.opts.defaultMeta=typeof E=="object"?E[I]||E:void 0}validate(E,I){let _;if(typeof E=="string"){if(_=this.getSchema(E),!_)throw new Error(`no schema with key or ref "${E}"`)}else _=this.compile(E);const d=_(I);return"$async"in _||(this.errors=_.errors),d}compile(E,I){const _=this._addSchema(E,I);return _.validate||this._compileSchemaEnv(_)}compileAsync(E,I){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:_}=this.opts;return d.call(this,E,I);async function d(F,b){await g.call(this,F.$schema);const k=this._addSchema(F,b);return k.validate||O.call(this,k)}async function g(F){F&&!this.getSchema(F)&&await d.call(this,{$ref:F},!0)}async function O(F){try{return this._compileSchemaEnv(F)}catch(b){if(!(b instanceof s.default))throw b;return C.call(this,b),await D.call(this,b.missingSchema),O.call(this,F)}}function C({missingSchema:F,missingRef:b}){if(this.refs[F])throw new Error(`AnySchema ${F} is loaded but ${b} cannot be resolved`)}async function D(F){const b=await z.call(this,F);this.refs[F]||await g.call(this,b.$schema),this.refs[F]||this.addSchema(b,F,I)}async function z(F){const b=this._loading[F];if(b)return b;try{return await(this._loading[F]=_(F))}finally{delete this._loading[F]}}}addSchema(E,I,_,d=this.opts.validateSchema){if(Array.isArray(E)){for(const O of E)this.addSchema(O,void 0,_,d);return this}let g;if(typeof E=="object"){const{schemaId:O}=this.opts;if(g=E[O],g!==void 0&&typeof g!="string")throw new Error(`schema ${O} must be string`)}return I=(0,c.normalizeId)(I||g),this._checkUnique(I),this.schemas[I]=this._addSchema(E,_,I,d,!0),this}addMetaSchema(E,I,_=this.opts.validateSchema){return this.addSchema(E,I,!0,_),this}validateSchema(E,I){if(typeof E=="boolean")return!0;let _;if(_=E.$schema,_!==void 0&&typeof _!="string")throw new Error("$schema must be a string");if(_=_||this.opts.defaultMeta||this.defaultMeta(),!_)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const d=this.validate(_,E);if(!d&&I){const g="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(g);else throw new Error(g)}return d}getSchema(E){let I;for(;typeof(I=j.call(this,E))=="string";)E=I;if(I===void 0){const{schemaId:_}=this.opts,d=new a.SchemaEnv({schema:{},schemaId:_});if(I=a.resolveSchema.call(this,d,E),!I)return;this.refs[E]=I}return I.validate||this._compileSchemaEnv(I)}removeSchema(E){if(E instanceof RegExp)return this._removeAllSchemas(this.schemas,E),this._removeAllSchemas(this.refs,E),this;switch(typeof E){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const I=j.call(this,E);return typeof I=="object"&&this._cache.delete(I.schema),delete this.schemas[E],delete this.refs[E],this}case"object":{const I=E;this._cache.delete(I);let _=E[this.opts.schemaId];return _&&(_=(0,c.normalizeId)(_),delete this.schemas[_],delete this.refs[_]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(E){for(const I of E)this.addKeyword(I);return this}addKeyword(E,I){let _;if(typeof E=="string")_=E,typeof I=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),I.keyword=_);else if(typeof E=="object"&&I===void 0){if(I=E,_=I.keyword,Array.isArray(_)&&!_.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(J.call(this,_,I),!I)return(0,l.eachItem)(_,g=>pe.call(this,g)),this;fe.call(this,I);const d={...I,type:(0,u.getJSONTypes)(I.type),schemaType:(0,u.getJSONTypes)(I.schemaType)};return(0,l.eachItem)(_,d.type.length===0?g=>pe.call(this,g,d):g=>d.type.forEach(O=>pe.call(this,g,d,O))),this}getKeyword(E){const I=this.RULES.all[E];return typeof I=="object"?I.definition:!!I}removeKeyword(E){const{RULES:I}=this;delete I.keywords[E],delete I.all[E];for(const _ of I.rules){const d=_.rules.findIndex(g=>g.keyword===E);d>=0&&_.rules.splice(d,1)}return this}addFormat(E,I){return typeof I=="string"&&(I=new RegExp(I)),this.formats[E]=I,this}errorsText(E=this.errors,{separator:I=", ",dataVar:_="data"}={}){return!E||E.length===0?"No errors":E.map(d=>`${_}${d.instancePath} ${d.message}`).reduce((d,g)=>d+I+g)}$dataMetaSchema(E,I){const _=this.RULES.all;E=JSON.parse(JSON.stringify(E));for(const d of I){const g=d.split("/").slice(1);let O=E;for(const C of g)O=O[C];for(const C in _){const D=_[C];if(typeof D!="object")continue;const{$data:z}=D.definition,F=O[C];z&&F&&(O[C]=L(F))}}return E}_removeAllSchemas(E,I){for(const _ in E){const d=E[_];(!I||I.test(_))&&(typeof d=="string"?delete E[_]:d&&!d.meta&&(this._cache.delete(d.schema),delete E[_]))}}_addSchema(E,I,_,d=this.opts.validateSchema,g=this.opts.addUsedSchema){let O;const{schemaId:C}=this.opts;if(typeof E=="object")O=E[C];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof E!="boolean")throw new Error("schema must be object or boolean")}let D=this._cache.get(E);if(D!==void 0)return D;_=(0,c.normalizeId)(O||_);const z=c.getSchemaRefs.call(this,E,_);return D=new a.SchemaEnv({schema:E,schemaId:C,meta:I,baseId:_,localRefs:z}),this._cache.set(D.schema,D),g&&!_.startsWith("#")&&(_&&this._checkUnique(_),this.refs[_]=D),d&&this.validateSchema(E,!0),D}_checkUnique(E){if(this.schemas[E]||this.refs[E])throw new Error(`schema with key or id "${E}" already exists`)}_compileSchemaEnv(E){if(E.meta?this._compileMetaSchema(E):a.compileSchema.call(this,E),!E.validate)throw new Error("ajv implementation error");return E.validate}_compileMetaSchema(E){const I=this.opts;this.opts=this._metaOpts;try{a.compileSchema.call(this,E)}finally{this.opts=I}}}P.ValidationError=n.default,P.MissingRefError=s.default,e.default=P;function N(x,E,I,_="error"){for(const d in x){const g=d;g in E&&this.logger[_](`${I}: option ${d}. ${x[g]}`)}}function j(x){return x=(0,c.normalizeId)(x),this.schemas[x]||this.refs[x]}function A(){const x=this.opts.schemas;if(!!x)if(Array.isArray(x))this.addSchema(x);else for(const E in x)this.addSchema(x[E],E)}function V(){for(const x in this.opts.formats){const E=this.opts.formats[x];E&&this.addFormat(x,E)}}function U(x){if(Array.isArray(x)){this.addVocabulary(x);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const E in x){const I=x[E];I.keyword||(I.keyword=E),this.addKeyword(I)}}function W(){const x={...this.opts};for(const E of p)delete x[E];return x}const Z={log(){},warn(){},error(){}};function B(x){if(x===!1)return Z;if(x===void 0)return console;if(x.log&&x.warn&&x.error)return x;throw new Error("logger must implement log, warn and error methods")}const Y=/^[a-z_$][a-z0-9_$:-]*$/i;function J(x,E){const{RULES:I}=this;if((0,l.eachItem)(x,_=>{if(I.keywords[_])throw new Error(`Keyword ${_} is already defined`);if(!Y.test(_))throw new Error(`Keyword ${_} has invalid name`)}),!!E&&E.$data&&!("code"in E||"validate"in E))throw new Error('$data keyword must have "code" or "validate" function')}function pe(x,E,I){var _;const d=E?.post;if(I&&d)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:g}=this;let O=d?g.post:g.rules.find(({type:D})=>D===I);if(O||(O={type:I,rules:[]},g.rules.push(O)),g.keywords[x]=!0,!E)return;const C={keyword:x,definition:{...E,type:(0,u.getJSONTypes)(E.type),schemaType:(0,u.getJSONTypes)(E.schemaType)}};E.before?ce.call(this,O,C,E.before):O.rules.push(C),g.all[x]=C,(_=E.implements)===null||_===void 0||_.forEach(D=>this.addKeyword(D))}function ce(x,E,I){const _=x.rules.findIndex(d=>d.keyword===I);_>=0?x.rules.splice(_,0,E):(x.rules.push(E),this.logger.warn(`rule ${I} is not defined`))}function fe(x){let{metaSchema:E}=x;E!==void 0&&(x.$data&&this.opts.$data&&(E=L(E)),x.validateSchema=this.compile(E,!0))}const T={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function L(x){return{anyOf:[x,T]}}})(Js);var gn={},$n={},vn={};Object.defineProperty(vn,"__esModule",{value:!0});const Ki={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};vn.default=Ki;var ot={};Object.defineProperty(ot,"__esModule",{value:!0});ot.callRef=ot.getValidate=void 0;const Bi=$t,_s=qe(),je=Q,lt=Fe,bs=Ne,Jt=q,Wi={keyword:"$ref",schemaType:"string",code(e){const{gen:t,schema:r,it:n}=e,{baseId:s,schemaEnv:o,validateName:a,opts:i,self:c}=n,{root:u}=o;if((r==="#"||r==="#/")&&s===u.baseId)return f();const l=bs.resolveRef.call(c,u,s,r);if(l===void 0)throw new Bi.default(n.opts.uriResolver,s,r);if(l instanceof bs.SchemaEnv)return w(l);return $(l);function f(){if(o===u)return or(e,a,o,o.$async);const p=t.scopeValue("root",{ref:u});return or(e,(0,je._)`${p}.validate`,u,u.$async)}function w(p){const v=_o(e,p);or(e,v,p,p.$async)}function $(p){const v=t.scopeValue("schema",i.code.source===!0?{ref:p,code:(0,je.stringify)(p)}:{ref:p}),m=t.name("valid"),h=e.subschema({schema:p,dataTypes:[],schemaPath:je.nil,topSchemaRef:v,errSchemaPath:r},m);e.mergeEvaluated(h),e.ok(m)}}};function _o(e,t){const{gen:r}=e;return t.validate?r.scopeValue("validate",{ref:t.validate}):(0,je._)`${r.scopeValue("wrapper",{ref:t})}.validate`}ot.getValidate=_o;function or(e,t,r,n){const{gen:s,it:o}=e,{allErrors:a,schemaEnv:i,opts:c}=o,u=c.passContext?lt.default.this:je.nil;n?l():f();function l(){if(!i.$async)throw new Error("async schema referenced by sync schema");const p=s.let("valid");s.try(()=>{s.code((0,je._)`await ${(0,_s.callValidateCode)(e,t,u)}`),$(t),a||s.assign(p,!0)},v=>{s.if((0,je._)`!(${v} instanceof ${o.ValidationError})`,()=>s.throw(v)),w(v),a||s.assign(p,!1)}),e.ok(p)}function f(){e.result((0,_s.callValidateCode)(e,t,u),()=>$(t),()=>w(t))}function w(p){const v=(0,je._)`${p}.errors`;s.assign(lt.default.vErrors,(0,je._)`${lt.default.vErrors} === null ? ${v} : ${lt.default.vErrors}.concat(${v})`),s.assign(lt.default.errors,(0,je._)`${lt.default.vErrors}.length`)}function $(p){var v;if(!o.opts.unevaluated)return;const m=(v=r?.validate)===null||v===void 0?void 0:v.evaluated;if(o.props!==!0)if(m&&!m.dynamicProps)m.props!==void 0&&(o.props=Jt.mergeEvaluated.props(s,m.props,o.props));else{const h=s.var("props",(0,je._)`${p}.evaluated.props`);o.props=Jt.mergeEvaluated.props(s,h,o.props,je.Name)}if(o.items!==!0)if(m&&!m.dynamicItems)m.items!==void 0&&(o.items=Jt.mergeEvaluated.items(s,m.items,o.items));else{const h=s.var("items",(0,je._)`${p}.evaluated.items`);o.items=Jt.mergeEvaluated.items(s,h,o.items,je.Name)}}}ot.callRef=or;ot.default=Wi;Object.defineProperty($n,"__esModule",{value:!0});const Ji=vn,Gi=ot,Xi=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",Ji.default,Gi.default];$n.default=Xi;var wn={},_n={};Object.defineProperty(_n,"__esModule",{value:!0});const fr=Q,Je=fr.operators,pr={maximum:{okStr:"<=",ok:Je.LTE,fail:Je.GT},minimum:{okStr:">=",ok:Je.GTE,fail:Je.LT},exclusiveMaximum:{okStr:"<",ok:Je.LT,fail:Je.GTE},exclusiveMinimum:{okStr:">",ok:Je.GT,fail:Je.LTE}},Yi={message:({keyword:e,schemaCode:t})=>(0,fr.str)`must be ${pr[e].okStr} ${t}`,params:({keyword:e,schemaCode:t})=>(0,fr._)`{comparison: ${pr[e].okStr}, limit: ${t}}`},Qi={keyword:Object.keys(pr),type:"number",schemaType:"number",$data:!0,error:Yi,code(e){const{keyword:t,data:r,schemaCode:n}=e;e.fail$data((0,fr._)`${r} ${pr[t].fail} ${n} || isNaN(${r})`)}};_n.default=Qi;var bn={};Object.defineProperty(bn,"__esModule",{value:!0});const Rt=Q,Zi={message:({schemaCode:e})=>(0,Rt.str)`must be multiple of ${e}`,params:({schemaCode:e})=>(0,Rt._)`{multipleOf: ${e}}`},ec={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:Zi,code(e){const{gen:t,data:r,schemaCode:n,it:s}=e,o=s.opts.multipleOfPrecision,a=t.let("res"),i=o?(0,Rt._)`Math.abs(Math.round(${a}) - ${a}) > 1e-${o}`:(0,Rt._)`${a} !== parseInt(${a})`;e.fail$data((0,Rt._)`(${n} === 0 || (${a} = ${r}/${n}, ${i}))`)}};bn.default=ec;var En={},Sn={};Object.defineProperty(Sn,"__esModule",{value:!0});function bo(e){const t=e.length;let r=0,n=0,s;for(;n<t;)r++,s=e.charCodeAt(n++),s>=55296&&s<=56319&&n<t&&(s=e.charCodeAt(n),(s&64512)===56320&&n++);return r}Sn.default=bo;bo.code='require("ajv/dist/runtime/ucs2length").default';Object.defineProperty(En,"__esModule",{value:!0});const tt=Q,tc=q,rc=Sn,nc={message({keyword:e,schemaCode:t}){const r=e==="maxLength"?"more":"fewer";return(0,tt.str)`must NOT have ${r} than ${t} characters`},params:({schemaCode:e})=>(0,tt._)`{limit: ${e}}`},sc={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:nc,code(e){const{keyword:t,data:r,schemaCode:n,it:s}=e,o=t==="maxLength"?tt.operators.GT:tt.operators.LT,a=s.opts.unicode===!1?(0,tt._)`${r}.length`:(0,tt._)`${(0,tc.useFunc)(e.gen,rc.default)}(${r})`;e.fail$data((0,tt._)`${a} ${o} ${n}`)}};En.default=sc;var kn={};Object.defineProperty(kn,"__esModule",{value:!0});const oc=qe(),hr=Q,ac={message:({schemaCode:e})=>(0,hr.str)`must match pattern "${e}"`,params:({schemaCode:e})=>(0,hr._)`{pattern: ${e}}`},ic={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:ac,code(e){const{data:t,$data:r,schema:n,schemaCode:s,it:o}=e,a=o.opts.unicodeRegExp?"u":"",i=r?(0,hr._)`(new RegExp(${s}, ${a}))`:(0,oc.usePattern)(e,n);e.fail$data((0,hr._)`!${i}.test(${t})`)}};kn.default=ic;var Pn={};Object.defineProperty(Pn,"__esModule",{value:!0});const Tt=Q,cc={message({keyword:e,schemaCode:t}){const r=e==="maxProperties"?"more":"fewer";return(0,Tt.str)`must NOT have ${r} than ${t} properties`},params:({schemaCode:e})=>(0,Tt._)`{limit: ${e}}`},lc={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:cc,code(e){const{keyword:t,data:r,schemaCode:n}=e,s=t==="maxProperties"?Tt.operators.GT:Tt.operators.LT;e.fail$data((0,Tt._)`Object.keys(${r}).length ${s} ${n}`)}};Pn.default=lc;var On={};Object.defineProperty(On,"__esModule",{value:!0});const kt=qe(),Ct=Q,uc=q,dc={message:({params:{missingProperty:e}})=>(0,Ct.str)`must have required property '${e}'`,params:({params:{missingProperty:e}})=>(0,Ct._)`{missingProperty: ${e}}`},fc={keyword:"required",type:"object",schemaType:"array",$data:!0,error:dc,code(e){const{gen:t,schema:r,schemaCode:n,data:s,$data:o,it:a}=e,{opts:i}=a;if(!o&&r.length===0)return;const c=r.length>=i.loopRequired;if(a.allErrors?u():l(),i.strictRequired){const $=e.parentSchema.properties,{definedProperties:p}=e.it;for(const v of r)if($?.[v]===void 0&&!p.has(v)){const m=a.schemaEnv.baseId+a.errSchemaPath,h=`required property "${v}" is not defined at "${m}" (strictRequired)`;(0,uc.checkStrictMode)(a,h,a.opts.strictRequired)}}function u(){if(c||o)e.block$data(Ct.nil,f);else for(const $ of r)(0,kt.checkReportMissingProp)(e,$)}function l(){const $=t.let("missing");if(c||o){const p=t.let("valid",!0);e.block$data(p,()=>w($,p)),e.ok(p)}else t.if((0,kt.checkMissingProp)(e,r,$)),(0,kt.reportMissingProp)(e,$),t.else()}function f(){t.forOf("prop",n,$=>{e.setParams({missingProperty:$}),t.if((0,kt.noPropertyInData)(t,s,$,i.ownProperties),()=>e.error())})}function w($,p){e.setParams({missingProperty:$}),t.forOf($,n,()=>{t.assign(p,(0,kt.propertyInData)(t,s,$,i.ownProperties)),t.if((0,Ct.not)(p),()=>{e.error(),t.break()})},Ct.nil)}}};On.default=fc;var jn={};Object.defineProperty(jn,"__esModule",{value:!0});const At=Q,pc={message({keyword:e,schemaCode:t}){const r=e==="maxItems"?"more":"fewer";return(0,At.str)`must NOT have ${r} than ${t} items`},params:({schemaCode:e})=>(0,At._)`{limit: ${e}}`},hc={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:pc,code(e){const{keyword:t,data:r,schemaCode:n}=e,s=t==="maxItems"?At.operators.GT:At.operators.LT;e.fail$data((0,At._)`${r}.length ${s} ${n}`)}};jn.default=hc;var Nn={},Ft={};Object.defineProperty(Ft,"__esModule",{value:!0});const Eo=oo;Eo.code='require("ajv/dist/runtime/equal").default';Ft.default=Eo;Object.defineProperty(Nn,"__esModule",{value:!0});const Dr=le,me=Q,mc=q,yc=Ft,gc={message:({params:{i:e,j:t}})=>(0,me.str)`must NOT have duplicate items (items ## ${t} and ${e} are identical)`,params:({params:{i:e,j:t}})=>(0,me._)`{i: ${e}, j: ${t}}`},$c={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:gc,code(e){const{gen:t,data:r,$data:n,schema:s,parentSchema:o,schemaCode:a,it:i}=e;if(!n&&!s)return;const c=t.let("valid"),u=o.items?(0,Dr.getSchemaTypes)(o.items):[];e.block$data(c,l,(0,me._)`${a} === false`),e.ok(c);function l(){const p=t.let("i",(0,me._)`${r}.length`),v=t.let("j");e.setParams({i:p,j:v}),t.assign(c,!0),t.if((0,me._)`${p} > 1`,()=>(f()?w:$)(p,v))}function f(){return u.length>0&&!u.some(p=>p==="object"||p==="array")}function w(p,v){const m=t.name("item"),h=(0,Dr.checkDataTypes)(u,m,i.opts.strictNumbers,Dr.DataType.Wrong),y=t.const("indices",(0,me._)`{}`);t.for((0,me._)`;${p}--;`,()=>{t.let(m,(0,me._)`${r}[${p}]`),t.if(h,(0,me._)`continue`),u.length>1&&t.if((0,me._)`typeof ${m} == "string"`,(0,me._)`${m} += "_"`),t.if((0,me._)`typeof ${y}[${m}] == "number"`,()=>{t.assign(v,(0,me._)`${y}[${m}]`),e.error(),t.assign(c,!1).break()}).code((0,me._)`${y}[${m}] = ${p}`)})}function $(p,v){const m=(0,mc.useFunc)(t,yc.default),h=t.name("outer");t.label(h).for((0,me._)`;${p}--;`,()=>t.for((0,me._)`${v} = ${p}; ${v}--;`,()=>t.if((0,me._)`${m}(${r}[${p}], ${r}[${v}])`,()=>{e.error(),t.assign(c,!1).break(h)})))}}};Nn.default=$c;var xn={};Object.defineProperty(xn,"__esModule",{value:!0});const Jr=Q,vc=q,wc=Ft,_c={message:"must be equal to constant",params:({schemaCode:e})=>(0,Jr._)`{allowedValue: ${e}}`},bc={keyword:"const",$data:!0,error:_c,code(e){const{gen:t,data:r,$data:n,schemaCode:s,schema:o}=e;n||o&&typeof o=="object"?e.fail$data((0,Jr._)`!${(0,vc.useFunc)(t,wc.default)}(${r}, ${s})`):e.fail((0,Jr._)`${o} !== ${r}`)}};xn.default=bc;var In={};Object.defineProperty(In,"__esModule",{value:!0});const jt=Q,Ec=q,Sc=Ft,kc={message:"must be equal to one of the allowed values",params:({schemaCode:e})=>(0,jt._)`{allowedValues: ${e}}`},Pc={keyword:"enum",schemaType:"array",$data:!0,error:kc,code(e){const{gen:t,data:r,$data:n,schema:s,schemaCode:o,it:a}=e;if(!n&&s.length===0)throw new Error("enum must have non-empty array");const i=s.length>=a.opts.loopEnum;let c;const u=()=>c??(c=(0,Ec.useFunc)(t,Sc.default));let l;if(i||n)l=t.let("valid"),e.block$data(l,f);else{if(!Array.isArray(s))throw new Error("ajv implementation error");const $=t.const("vSchema",o);l=(0,jt.or)(...s.map((p,v)=>w($,v)))}e.pass(l);function f(){t.assign(l,!1),t.forOf("v",o,$=>t.if((0,jt._)`${u()}(${r}, ${$})`,()=>t.assign(l,!0).break()))}function w($,p){const v=s[p];return typeof v=="object"&&v!==null?(0,jt._)`${u()}(${r}, ${$}[${p}])`:(0,jt._)`${r} === ${v}`}}};In.default=Pc;Object.defineProperty(wn,"__esModule",{value:!0});const Oc=_n,jc=bn,Nc=En,xc=kn,Ic=Pn,Rc=On,Tc=jn,Cc=Nn,Ac=xn,Mc=In,Dc=[Oc.default,jc.default,Nc.default,xc.default,Ic.default,Rc.default,Tc.default,Cc.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},Ac.default,Mc.default];wn.default=Dc;var Rn={},vt={};Object.defineProperty(vt,"__esModule",{value:!0});vt.validateAdditionalItems=void 0;const rt=Q,Gr=q,Vc={message:({params:{len:e}})=>(0,rt.str)`must NOT have more than ${e} items`,params:({params:{len:e}})=>(0,rt._)`{limit: ${e}}`},Lc={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:Vc,code(e){const{parentSchema:t,it:r}=e,{items:n}=t;if(!Array.isArray(n)){(0,Gr.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}So(e,n)}};function So(e,t){const{gen:r,schema:n,data:s,keyword:o,it:a}=e;a.items=!0;const i=r.const("len",(0,rt._)`${s}.length`);if(n===!1)e.setParams({len:t.length}),e.pass((0,rt._)`${i} <= ${t.length}`);else if(typeof n=="object"&&!(0,Gr.alwaysValidSchema)(a,n)){const u=r.var("valid",(0,rt._)`${i} <= ${t.length}`);r.if((0,rt.not)(u),()=>c(u)),e.ok(u)}function c(u){r.forRange("i",t.length,i,l=>{e.subschema({keyword:o,dataProp:l,dataPropType:Gr.Type.Num},u),a.allErrors||r.if((0,rt.not)(u),()=>r.break())})}}vt.validateAdditionalItems=So;vt.default=Lc;var Tn={},wt={};Object.defineProperty(wt,"__esModule",{value:!0});wt.validateTuple=void 0;const Es=Q,ar=q,qc=qe(),Hc={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(e){const{schema:t,it:r}=e;if(Array.isArray(t))return ko(e,"additionalItems",t);r.items=!0,!(0,ar.alwaysValidSchema)(r,t)&&e.ok((0,qc.validateArray)(e))}};function ko(e,t,r=e.schema){const{gen:n,parentSchema:s,data:o,keyword:a,it:i}=e;l(s),i.opts.unevaluated&&r.length&&i.items!==!0&&(i.items=ar.mergeEvaluated.items(n,r.length,i.items));const c=n.name("valid"),u=n.const("len",(0,Es._)`${o}.length`);r.forEach((f,w)=>{(0,ar.alwaysValidSchema)(i,f)||(n.if((0,Es._)`${u} > ${w}`,()=>e.subschema({keyword:a,schemaProp:w,dataProp:w},c)),e.ok(c))});function l(f){const{opts:w,errSchemaPath:$}=i,p=r.length,v=p===f.minItems&&(p===f.maxItems||f[t]===!1);if(w.strictTuples&&!v){const m=`"${a}" is ${p}-tuple, but minItems or maxItems/${t} are not specified or different at path "${$}"`;(0,ar.checkStrictMode)(i,m,w.strictTuples)}}}wt.validateTuple=ko;wt.default=Hc;Object.defineProperty(Tn,"__esModule",{value:!0});const zc=wt,Fc={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:e=>(0,zc.validateTuple)(e,"items")};Tn.default=Fc;var Cn={};Object.defineProperty(Cn,"__esModule",{value:!0});const Ss=Q,Uc=q,Kc=qe(),Bc=vt,Wc={message:({params:{len:e}})=>(0,Ss.str)`must NOT have more than ${e} items`,params:({params:{len:e}})=>(0,Ss._)`{limit: ${e}}`},Jc={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:Wc,code(e){const{schema:t,parentSchema:r,it:n}=e,{prefixItems:s}=r;n.items=!0,!(0,Uc.alwaysValidSchema)(n,t)&&(s?(0,Bc.validateAdditionalItems)(e,s):e.ok((0,Kc.validateArray)(e)))}};Cn.default=Jc;var An={};Object.defineProperty(An,"__esModule",{value:!0});const Ie=Q,Gt=q,Gc={message:({params:{min:e,max:t}})=>t===void 0?(0,Ie.str)`must contain at least ${e} valid item(s)`:(0,Ie.str)`must contain at least ${e} and no more than ${t} valid item(s)`,params:({params:{min:e,max:t}})=>t===void 0?(0,Ie._)`{minContains: ${e}}`:(0,Ie._)`{minContains: ${e}, maxContains: ${t}}`},Xc={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:Gc,code(e){const{gen:t,schema:r,parentSchema:n,data:s,it:o}=e;let a,i;const{minContains:c,maxContains:u}=n;o.opts.next?(a=c===void 0?1:c,i=u):a=1;const l=t.const("len",(0,Ie._)`${s}.length`);if(e.setParams({min:a,max:i}),i===void 0&&a===0){(0,Gt.checkStrictMode)(o,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(i!==void 0&&a>i){(0,Gt.checkStrictMode)(o,'"minContains" > "maxContains" is always invalid'),e.fail();return}if((0,Gt.alwaysValidSchema)(o,r)){let v=(0,Ie._)`${l} >= ${a}`;i!==void 0&&(v=(0,Ie._)`${v} && ${l} <= ${i}`),e.pass(v);return}o.items=!0;const f=t.name("valid");i===void 0&&a===1?$(f,()=>t.if(f,()=>t.break())):a===0?(t.let(f,!0),i!==void 0&&t.if((0,Ie._)`${s}.length > 0`,w)):(t.let(f,!1),w()),e.result(f,()=>e.reset());function w(){const v=t.name("_valid"),m=t.let("count",0);$(v,()=>t.if(v,()=>p(m)))}function $(v,m){t.forRange("i",0,l,h=>{e.subschema({keyword:"contains",dataProp:h,dataPropType:Gt.Type.Num,compositeRule:!0},v),m()})}function p(v){t.code((0,Ie._)`${v}++`),i===void 0?t.if((0,Ie._)`${v} >= ${a}`,()=>t.assign(f,!0).break()):(t.if((0,Ie._)`${v} > ${i}`,()=>t.assign(f,!1).break()),a===1?t.assign(f,!0):t.if((0,Ie._)`${v} >= ${a}`,()=>t.assign(f,!0)))}}};An.default=Xc;var Po={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validateSchemaDeps=e.validatePropertyDeps=e.error=void 0;const t=Q,r=q,n=qe();e.error={message:({params:{property:c,depsCount:u,deps:l}})=>{const f=u===1?"property":"properties";return(0,t.str)`must have ${f} ${l} when property ${c} is present`},params:({params:{property:c,depsCount:u,deps:l,missingProperty:f}})=>(0,t._)`{property: ${c},
    missingProperty: ${f},
    depsCount: ${u},
    deps: ${l}}`};const s={keyword:"dependencies",type:"object",schemaType:"object",error:e.error,code(c){const[u,l]=o(c);a(c,u),i(c,l)}};function o({schema:c}){const u={},l={};for(const f in c){if(f==="__proto__")continue;const w=Array.isArray(c[f])?u:l;w[f]=c[f]}return[u,l]}function a(c,u=c.schema){const{gen:l,data:f,it:w}=c;if(Object.keys(u).length===0)return;const $=l.let("missing");for(const p in u){const v=u[p];if(v.length===0)continue;const m=(0,n.propertyInData)(l,f,p,w.opts.ownProperties);c.setParams({property:p,depsCount:v.length,deps:v.join(", ")}),w.allErrors?l.if(m,()=>{for(const h of v)(0,n.checkReportMissingProp)(c,h)}):(l.if((0,t._)`${m} && (${(0,n.checkMissingProp)(c,v,$)})`),(0,n.reportMissingProp)(c,$),l.else())}}e.validatePropertyDeps=a;function i(c,u=c.schema){const{gen:l,data:f,keyword:w,it:$}=c,p=l.name("valid");for(const v in u)(0,r.alwaysValidSchema)($,u[v])||(l.if((0,n.propertyInData)(l,f,v,$.opts.ownProperties),()=>{const m=c.subschema({keyword:w,schemaProp:v},p);c.mergeValidEvaluated(m,p)},()=>l.var(p,!0)),c.ok(p))}e.validateSchemaDeps=i,e.default=s})(Po);var Mn={};Object.defineProperty(Mn,"__esModule",{value:!0});const Oo=Q,Yc=q,Qc={message:"property name must be valid",params:({params:e})=>(0,Oo._)`{propertyName: ${e.propertyName}}`},Zc={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:Qc,code(e){const{gen:t,schema:r,data:n,it:s}=e;if((0,Yc.alwaysValidSchema)(s,r))return;const o=t.name("valid");t.forIn("key",n,a=>{e.setParams({propertyName:a}),e.subschema({keyword:"propertyNames",data:a,dataTypes:["string"],propertyName:a,compositeRule:!0},o),t.if((0,Oo.not)(o),()=>{e.error(!0),s.allErrors||t.break()})}),e.ok(o)}};Mn.default=Zc;var br={};Object.defineProperty(br,"__esModule",{value:!0});const Xt=qe(),De=Q,el=Fe,Yt=q,tl={message:"must NOT have additional properties",params:({params:e})=>(0,De._)`{additionalProperty: ${e.additionalProperty}}`},rl={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:tl,code(e){const{gen:t,schema:r,parentSchema:n,data:s,errsCount:o,it:a}=e;if(!o)throw new Error("ajv implementation error");const{allErrors:i,opts:c}=a;if(a.props=!0,c.removeAdditional!=="all"&&(0,Yt.alwaysValidSchema)(a,r))return;const u=(0,Xt.allSchemaProperties)(n.properties),l=(0,Xt.allSchemaProperties)(n.patternProperties);f(),e.ok((0,De._)`${o} === ${el.default.errors}`);function f(){t.forIn("key",s,m=>{!u.length&&!l.length?p(m):t.if(w(m),()=>p(m))})}function w(m){let h;if(u.length>8){const y=(0,Yt.schemaRefOrVal)(a,n.properties,"properties");h=(0,Xt.isOwnProperty)(t,y,m)}else u.length?h=(0,De.or)(...u.map(y=>(0,De._)`${m} === ${y}`)):h=De.nil;return l.length&&(h=(0,De.or)(h,...l.map(y=>(0,De._)`${(0,Xt.usePattern)(e,y)}.test(${m})`))),(0,De.not)(h)}function $(m){t.code((0,De._)`delete ${s}[${m}]`)}function p(m){if(c.removeAdditional==="all"||c.removeAdditional&&r===!1){$(m);return}if(r===!1){e.setParams({additionalProperty:m}),e.error(),i||t.break();return}if(typeof r=="object"&&!(0,Yt.alwaysValidSchema)(a,r)){const h=t.name("valid");c.removeAdditional==="failing"?(v(m,h,!1),t.if((0,De.not)(h),()=>{e.reset(),$(m)})):(v(m,h),i||t.if((0,De.not)(h),()=>t.break()))}}function v(m,h,y){const S={keyword:"additionalProperties",dataProp:m,dataPropType:Yt.Type.Str};y===!1&&Object.assign(S,{compositeRule:!0,createErrors:!1,allErrors:!1}),e.subschema(S,h)}}};br.default=rl;var Dn={};Object.defineProperty(Dn,"__esModule",{value:!0});const nl=$r(),ks=qe(),Vr=q,Ps=br,sl={keyword:"properties",type:"object",schemaType:"object",code(e){const{gen:t,schema:r,parentSchema:n,data:s,it:o}=e;o.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&Ps.default.code(new nl.KeywordCxt(o,Ps.default,"additionalProperties"));const a=(0,ks.allSchemaProperties)(r);for(const f of a)o.definedProperties.add(f);o.opts.unevaluated&&a.length&&o.props!==!0&&(o.props=Vr.mergeEvaluated.props(t,(0,Vr.toHash)(a),o.props));const i=a.filter(f=>!(0,Vr.alwaysValidSchema)(o,r[f]));if(i.length===0)return;const c=t.name("valid");for(const f of i)u(f)?l(f):(t.if((0,ks.propertyInData)(t,s,f,o.opts.ownProperties)),l(f),o.allErrors||t.else().var(c,!0),t.endIf()),e.it.definedProperties.add(f),e.ok(c);function u(f){return o.opts.useDefaults&&!o.compositeRule&&r[f].default!==void 0}function l(f){e.subschema({keyword:"properties",schemaProp:f,dataProp:f},c)}}};Dn.default=sl;var Vn={};Object.defineProperty(Vn,"__esModule",{value:!0});const Os=qe(),Qt=Q,js=q,Ns=q,ol={keyword:"patternProperties",type:"object",schemaType:"object",code(e){const{gen:t,schema:r,data:n,parentSchema:s,it:o}=e,{opts:a}=o,i=(0,Os.allSchemaProperties)(r),c=i.filter(v=>(0,js.alwaysValidSchema)(o,r[v]));if(i.length===0||c.length===i.length&&(!o.opts.unevaluated||o.props===!0))return;const u=a.strictSchema&&!a.allowMatchingProperties&&s.properties,l=t.name("valid");o.props!==!0&&!(o.props instanceof Qt.Name)&&(o.props=(0,Ns.evaluatedPropsToName)(t,o.props));const{props:f}=o;w();function w(){for(const v of i)u&&$(v),o.allErrors?p(v):(t.var(l,!0),p(v),t.if(l))}function $(v){for(const m in u)new RegExp(v).test(m)&&(0,js.checkStrictMode)(o,`property ${m} matches pattern ${v} (use allowMatchingProperties)`)}function p(v){t.forIn("key",n,m=>{t.if((0,Qt._)`${(0,Os.usePattern)(e,v)}.test(${m})`,()=>{const h=c.includes(v);h||e.subschema({keyword:"patternProperties",schemaProp:v,dataProp:m,dataPropType:Ns.Type.Str},l),o.opts.unevaluated&&f!==!0?t.assign((0,Qt._)`${f}[${m}]`,!0):!h&&!o.allErrors&&t.if((0,Qt.not)(l),()=>t.break())})})}}};Vn.default=ol;var Ln={};Object.defineProperty(Ln,"__esModule",{value:!0});const al=q,il={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(e){const{gen:t,schema:r,it:n}=e;if((0,al.alwaysValidSchema)(n,r)){e.fail();return}const s=t.name("valid");e.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},s),e.failResult(s,()=>e.reset(),()=>e.error())},error:{message:"must NOT be valid"}};Ln.default=il;var qn={};Object.defineProperty(qn,"__esModule",{value:!0});const cl=qe(),ll={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:cl.validateUnion,error:{message:"must match a schema in anyOf"}};qn.default=ll;var Hn={};Object.defineProperty(Hn,"__esModule",{value:!0});const ir=Q,ul=q,dl={message:"must match exactly one schema in oneOf",params:({params:e})=>(0,ir._)`{passingSchemas: ${e.passing}}`},fl={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:dl,code(e){const{gen:t,schema:r,parentSchema:n,it:s}=e;if(!Array.isArray(r))throw new Error("ajv implementation error");if(s.opts.discriminator&&n.discriminator)return;const o=r,a=t.let("valid",!1),i=t.let("passing",null),c=t.name("_valid");e.setParams({passing:i}),t.block(u),e.result(a,()=>e.reset(),()=>e.error(!0));function u(){o.forEach((l,f)=>{let w;(0,ul.alwaysValidSchema)(s,l)?t.var(c,!0):w=e.subschema({keyword:"oneOf",schemaProp:f,compositeRule:!0},c),f>0&&t.if((0,ir._)`${c} && ${a}`).assign(a,!1).assign(i,(0,ir._)`[${i}, ${f}]`).else(),t.if(c,()=>{t.assign(a,!0),t.assign(i,f),w&&e.mergeEvaluated(w,ir.Name)})})}}};Hn.default=fl;var zn={};Object.defineProperty(zn,"__esModule",{value:!0});const pl=q,hl={keyword:"allOf",schemaType:"array",code(e){const{gen:t,schema:r,it:n}=e;if(!Array.isArray(r))throw new Error("ajv implementation error");const s=t.name("valid");r.forEach((o,a)=>{if((0,pl.alwaysValidSchema)(n,o))return;const i=e.subschema({keyword:"allOf",schemaProp:a},s);e.ok(s),e.mergeEvaluated(i)})}};zn.default=hl;var Fn={};Object.defineProperty(Fn,"__esModule",{value:!0});const mr=Q,jo=q,ml={message:({params:e})=>(0,mr.str)`must match "${e.ifClause}" schema`,params:({params:e})=>(0,mr._)`{failingKeyword: ${e.ifClause}}`},yl={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:ml,code(e){const{gen:t,parentSchema:r,it:n}=e;r.then===void 0&&r.else===void 0&&(0,jo.checkStrictMode)(n,'"if" without "then" and "else" is ignored');const s=xs(n,"then"),o=xs(n,"else");if(!s&&!o)return;const a=t.let("valid",!0),i=t.name("_valid");if(c(),e.reset(),s&&o){const l=t.let("ifClause");e.setParams({ifClause:l}),t.if(i,u("then",l),u("else",l))}else s?t.if(i,u("then")):t.if((0,mr.not)(i),u("else"));e.pass(a,()=>e.error(!0));function c(){const l=e.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},i);e.mergeEvaluated(l)}function u(l,f){return()=>{const w=e.subschema({keyword:l},i);t.assign(a,i),e.mergeValidEvaluated(w,a),f?t.assign(f,(0,mr._)`${l}`):e.setParams({ifClause:l})}}}};function xs(e,t){const r=e.schema[t];return r!==void 0&&!(0,jo.alwaysValidSchema)(e,r)}Fn.default=yl;var Un={};Object.defineProperty(Un,"__esModule",{value:!0});const gl=q,$l={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:e,parentSchema:t,it:r}){t.if===void 0&&(0,gl.checkStrictMode)(r,`"${e}" without "if" is ignored`)}};Un.default=$l;Object.defineProperty(Rn,"__esModule",{value:!0});const vl=vt,wl=Tn,_l=wt,bl=Cn,El=An,Sl=Po,kl=Mn,Pl=br,Ol=Dn,jl=Vn,Nl=Ln,xl=qn,Il=Hn,Rl=zn,Tl=Fn,Cl=Un;function Al(e=!1){const t=[Nl.default,xl.default,Il.default,Rl.default,Tl.default,Cl.default,kl.default,Pl.default,Sl.default,Ol.default,jl.default];return e?t.push(wl.default,bl.default):t.push(vl.default,_l.default),t.push(El.default),t}Rn.default=Al;var Kn={},Bn={};Object.defineProperty(Bn,"__esModule",{value:!0});const oe=Q,Ml={message:({schemaCode:e})=>(0,oe.str)`must match format "${e}"`,params:({schemaCode:e})=>(0,oe._)`{format: ${e}}`},Dl={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:Ml,code(e,t){const{gen:r,data:n,$data:s,schema:o,schemaCode:a,it:i}=e,{opts:c,errSchemaPath:u,schemaEnv:l,self:f}=i;if(!c.validateFormats)return;s?w():$();function w(){const p=r.scopeValue("formats",{ref:f.formats,code:c.code.formats}),v=r.const("fDef",(0,oe._)`${p}[${a}]`),m=r.let("fType"),h=r.let("format");r.if((0,oe._)`typeof ${v} == "object" && !(${v} instanceof RegExp)`,()=>r.assign(m,(0,oe._)`${v}.type || "string"`).assign(h,(0,oe._)`${v}.validate`),()=>r.assign(m,(0,oe._)`"string"`).assign(h,v)),e.fail$data((0,oe.or)(y(),S()));function y(){return c.strictSchema===!1?oe.nil:(0,oe._)`${a} && !${h}`}function S(){const P=l.$async?(0,oe._)`(${v}.async ? await ${h}(${n}) : ${h}(${n}))`:(0,oe._)`${h}(${n})`,N=(0,oe._)`(typeof ${h} == "function" ? ${P} : ${h}.test(${n}))`;return(0,oe._)`${h} && ${h} !== true && ${m} === ${t} && !${N}`}}function $(){const p=f.formats[o];if(!p){y();return}if(p===!0)return;const[v,m,h]=S(p);v===t&&e.pass(P());function y(){if(c.strictSchema===!1){f.logger.warn(N());return}throw new Error(N());function N(){return`unknown format "${o}" ignored in schema at path "${u}"`}}function S(N){const j=N instanceof RegExp?(0,oe.regexpCode)(N):c.code.formats?(0,oe._)`${c.code.formats}${(0,oe.getProperty)(o)}`:void 0,A=r.scopeValue("formats",{key:o,ref:N,code:j});return typeof N=="object"&&!(N instanceof RegExp)?[N.type||"string",N.validate,(0,oe._)`${A}.validate`]:["string",N,A]}function P(){if(typeof p=="object"&&!(p instanceof RegExp)&&p.async){if(!l.$async)throw new Error("async format in sync schema");return(0,oe._)`await ${h}(${n})`}return typeof m=="function"?(0,oe._)`${h}(${n})`:(0,oe._)`${h}.test(${n})`}}}};Bn.default=Dl;Object.defineProperty(Kn,"__esModule",{value:!0});const Vl=Bn,Ll=[Vl.default];Kn.default=Ll;var yt={};Object.defineProperty(yt,"__esModule",{value:!0});yt.contentVocabulary=yt.metadataVocabulary=void 0;yt.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];yt.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"];Object.defineProperty(gn,"__esModule",{value:!0});const ql=$n,Hl=wn,zl=Rn,Fl=Kn,Is=yt,Ul=[ql.default,Hl.default,(0,zl.default)(),Fl.default,Is.metadataVocabulary,Is.contentVocabulary];gn.default=Ul;var Wn={},Er={};Object.defineProperty(Er,"__esModule",{value:!0});Er.DiscrError=void 0;var Rs;(function(e){e.Tag="tag",e.Mapping="mapping"})(Rs||(Er.DiscrError=Rs={}));Object.defineProperty(Wn,"__esModule",{value:!0});const dt=Q,Xr=Er,Ts=Ne,Kl=$t,Bl=q,Wl={message:({params:{discrError:e,tagName:t}})=>e===Xr.DiscrError.Tag?`tag "${t}" must be string`:`value of tag "${t}" must be in oneOf`,params:({params:{discrError:e,tag:t,tagName:r}})=>(0,dt._)`{error: ${e}, tag: ${r}, tagValue: ${t}}`},Jl={keyword:"discriminator",type:"object",schemaType:"object",error:Wl,code(e){const{gen:t,data:r,schema:n,parentSchema:s,it:o}=e,{oneOf:a}=s;if(!o.opts.discriminator)throw new Error("discriminator: requires discriminator option");const i=n.propertyName;if(typeof i!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!a)throw new Error("discriminator: requires oneOf keyword");const c=t.let("valid",!1),u=t.const("tag",(0,dt._)`${r}${(0,dt.getProperty)(i)}`);t.if((0,dt._)`typeof ${u} == "string"`,()=>l(),()=>e.error(!1,{discrError:Xr.DiscrError.Tag,tag:u,tagName:i})),e.ok(c);function l(){const $=w();t.if(!1);for(const p in $)t.elseIf((0,dt._)`${u} === ${p}`),t.assign(c,f($[p]));t.else(),e.error(!1,{discrError:Xr.DiscrError.Mapping,tag:u,tagName:i}),t.endIf()}function f($){const p=t.name("valid"),v=e.subschema({keyword:"oneOf",schemaProp:$},p);return e.mergeEvaluated(v,dt.Name),p}function w(){var $;const p={},v=h(s);let m=!0;for(let P=0;P<a.length;P++){let N=a[P];if(N?.$ref&&!(0,Bl.schemaHasRulesButRef)(N,o.self.RULES)){const A=N.$ref;if(N=Ts.resolveRef.call(o.self,o.schemaEnv.root,o.baseId,A),N instanceof Ts.SchemaEnv&&(N=N.schema),N===void 0)throw new Kl.default(o.opts.uriResolver,o.baseId,A)}const j=($=N?.properties)===null||$===void 0?void 0:$[i];if(typeof j!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${i}"`);m=m&&(v||h(N)),y(j,P)}if(!m)throw new Error(`discriminator: "${i}" must be required`);return p;function h({required:P}){return Array.isArray(P)&&P.includes(i)}function y(P,N){if(P.const)S(P.const,N);else if(P.enum)for(const j of P.enum)S(j,N);else throw new Error(`discriminator: "properties/${i}" must have "const" or "enum"`)}function S(P,N){if(typeof P!="string"||P in p)throw new Error(`discriminator: "${i}" values must be unique strings`);p[P]=N}}}};Wn.default=Jl;const Gl="http://json-schema.org/draft-07/schema#",Xl="http://json-schema.org/draft-07/schema#",Yl="Core schema meta-schema",Ql={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},Zl=["object","boolean"],eu={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},tu={$schema:Gl,$id:Xl,title:Yl,definitions:Ql,type:Zl,properties:eu,default:!0};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRefError=t.ValidationError=t.CodeGen=t.Name=t.nil=t.stringify=t.str=t._=t.KeywordCxt=t.Ajv=void 0;const r=Js,n=gn,s=Wn,o=tu,a=["/properties"],i="http://json-schema.org/draft-07/schema";class c extends r.default{_addVocabularies(){super._addVocabularies(),n.default.forEach(p=>this.addVocabulary(p)),this.opts.discriminator&&this.addKeyword(s.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const p=this.opts.$data?this.$dataMetaSchema(o,a):o;this.addMetaSchema(p,i,!1),this.refs["http://json-schema.org/schema"]=i}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(i)?i:void 0)}}t.Ajv=c,e.exports=t=c,e.exports.Ajv=c,Object.defineProperty(t,"__esModule",{value:!0}),t.default=c;var u=$r();Object.defineProperty(t,"KeywordCxt",{enumerable:!0,get:function(){return u.KeywordCxt}});var l=Q;Object.defineProperty(t,"_",{enumerable:!0,get:function(){return l._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return l.str}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return l.stringify}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return l.nil}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return l.Name}}),Object.defineProperty(t,"CodeGen",{enumerable:!0,get:function(){return l.CodeGen}});var f=un();Object.defineProperty(t,"ValidationError",{enumerable:!0,get:function(){return f.default}});var w=$t;Object.defineProperty(t,"MissingRefError",{enumerable:!0,get:function(){return w.default}})})(Fr,Fr.exports);const ru=ua(Fr.exports),nu=0xcbf29ce484222325n,su=0x84222325cbf29ce4n,ou=0x100000001b3n,au=(1n<<64n)-1n,Cs=(e,t)=>{let r=t;for(let n=0;n<e.length;n+=1)r^=BigInt(e.charCodeAt(n)),r=r*ou&au;return r},As=e=>e.toString(16).padStart(16,"0"),Le=(...e)=>{const t=JSON.stringify(e),r=Cs(t,nu),n=Cs(t,su);return`${As(r)}${As(n)}`},Qe={type:"string"},iu={type:"number"},gt=(e,t={})=>({type:"object",properties:e,required:Object.keys(e),...t}),ue=e=>JSON.stringify(e,null,2),at=e=>JSON.parse(e);function Sr(e,t){const r=new ru().compile(t);if(r(e))return!0;throw new Error(r.errors?.map(n=>n.message).join(", ")||"Invalid data")}function ve({schemaHash:e,data:t}){if(e==="0"&&ue(t)!="{}")throw new Error("schema hash is 0 but data is not empty :"+ue(t));return Le(e,t)}function Se(e,t,r){return t==null&&(r=e,e="",t=Ee),r==null&&(r=t,t=Ee),{schemaHash:ve(t),data:{...e?{title:e}:{},...r}}}const Ee={schemaHash:"0",data:{}},Jn=Se("script_schema",Ee,gt({title:Qe,code:Qe})),cu=Se("script_result_schema",Ee,gt({title:Qe,script:"#"+ve(Jn),content:{}},{title:"script_result_schema"})),No=Se("titled_schema",Ee,gt({title:Qe})),Gn=Se("has_titled_child",Ee,gt({child:gt({title:Qe})})),Xn=Se("a titled",No,{title:"im child"}),lu=Se("titled1",Gn,{child:Xn.data}),uu=Se("titled2",Gn,{child:`#${ve(Xn)}`}),Ut=Se("function schema",Ee,gt({title:Qe,args:{type:"object",additionalProperties:{}},code:Qe,returnSchema:{}},{required:["args","code","returnSchema"]})),du=Se("example function",Ut,{title:"example function",args:{a:{},b:{}},code:"return a + b",returnSchema:{}});Se("string",Ee,Qe),Se("number",Ee,iu);const Nt=e=>typeof e=="string"&&/^#([a-f0-9]{32})$/.exec(e),Mt=async(e,t)=>{if(typeof e=="string"){const r=Nt(e);if(!r)return e;const n=r[1];return Mt(await t(n),t)}return Array.isArray(e)?Promise.all(e.map(r=>Mt(r,t))):e&&typeof e=="object"?Object.fromEntries(await Promise.all(Object.entries(e).map(async([r,n])=>[r,await Mt(n,t)]))):e},fu=/^[A-Za-z_$][A-Za-z0-9_$]*$/,pu=new Set(["eval","arguments","this","globalThis","window","document","self","top","parent","frames","process","require","module","exports","__dirname","__filename","importScripts"]),_t=e=>{if(!fu.test(e))throw new Error(`unsafe identifier in codegen: ${JSON.stringify(e)}`);if(pu.has(e))throw new Error(`forbidden identifier in codegen: ${e}`)},Yn=e=>e===null?"null":typeof e=="string"?JSON.stringify(e):String(e),ee=e=>{switch(e.type){case"Identifier":return _t(e.name),e.name;case"SpreadElement":return`...${ee(e.argument)}`;case"Literal":return Yn(e.value);case"ArrayExpression":return`[${e.elements.map(ee).join(", ")}]`;case"ObjectExpression":return`{${e.properties.map(t=>t.type==="SpreadElement"?`...${ee(t.argument)}`:hu(t)).join(", ")}}`;case"AwaitExpression":return`(await ${ee(e.argument)})`;case"CallExpression":{const t=ee(e.callee),r=e.callee.type==="ArrowFunctionExpression";return`${r?"(":""}${t}${r?")":""}(${e.arguments.map(ee).join(", ")})`}case"MemberExpression":return e.computed?`${ee(e.object)}[${ee(e.property)}]`:`${ee(e.object)}.${ee(e.property)}`;case"AssignmentExpression":return`${ee(e.left)} ${e.operator} ${ee(e.right)}`;case"UpdateExpression":return e.prefix?`${e.operator}${ee(e.argument)}`:`${ee(e.argument)}${e.operator}`;case"BinaryExpression":case"LogicalExpression":return`(${ee(e.left)} ${e.operator} ${ee(e.right)})`;case"UnaryExpression":return e.operator==="typeof"?`(${e.operator} ${ee(e.argument)})`:`(${e.operator}${ee(e.argument)})`;case"ConditionalExpression":return`(${ee(e.test)} ? ${ee(e.consequent)} : ${ee(e.alternate)})`;case"ArrowFunctionExpression":return mu(e)}},hu=e=>{const t=e.key.type==="Identifier"?e.key.name:Yn(e.key.value);return e.shorthand&&e.value.type==="Identifier"&&e.value.name===t?(_t(t),t):`${t}: ${ee(e.value)}`},mu=e=>{const t=`(${e.params.map(ht).join(", ")})`,r=e.async?"async ":"";return e.body.type==="BlockStatement"?`${r}${t} => ${Ge(e.body,!0)}`:`${r}${t} => { __burn(); return ${ee(e.body)}; }`},Ge=(e,t=!1)=>{const r=t?"__burn();":"",n=s=>s.type==="BlockStatement"?`{__burn();${s.body.map(a=>Ge(a,t)).join("")}}`:`{__burn();${Ge(s,t)}}`;switch(e.type){case"BlockStatement":return`{${e.body.map(s=>Ge(s,t)).join("")}}`;case"ExpressionStatement":return`${r}${ee(e.expression)};`;case"IfStatement":{const s=o=>o.type==="BlockStatement"?Ge(o,t):`{${Ge(o,t)}}`;return`${r}if (${ee(e.test)}) ${s(e.consequent)}${e.alternate?` else ${s(e.alternate)}`:""}`}case"ReturnStatement":return`${r}return${e.argument?` ${ee(e.argument)}`:""};`;case"VariableDeclaration":return`${r}${e.kind} ${e.declarations.map(Zt).join(", ")};`;case"BreakStatement":return`${r}break;`;case"ContinueStatement":return`${r}continue;`;case"WhileStatement":return`${r}while (${ee(e.test)}) ${n(e.body)}`;case"ForStatement":{const s=e.init==null?"":Array.isArray(e.init)?`${e.initKind} ${e.init.map(Zt).join(", ")}`:ee(e.init),o=e.test?ee(e.test):"",a=e.update?ee(e.update):"";return`${r}for (${s}; ${o}; ${a}) ${n(e.body)}`}case"ForInStatement":{const s=Array.isArray(e.left)?`${e.leftKind} ${e.left.map(Zt).join(", ")}`:ee(e.left);return`${r}for (${s} in ${ee(e.right)}) ${n(e.body)}`}case"ForOfStatement":{const s=Array.isArray(e.left)?`${e.leftKind} ${e.left.map(Zt).join(", ")}`:ee(e.left);return`${r}for (${s} of ${ee(e.right)}) ${n(e.body)}`}}},Zt=e=>`${ht(e.id)}${e.init?` = ${ee(e.init)}`:""}`,ht=e=>e.type==="Identifier"?(_t(e.name),e.name):e.type==="RestElement"?`...${ht(e.argument)}`:e.type==="ArrayPattern"?`[${e.elements.map(ht).join(", ")}]`:`{${e.properties.map(t=>t.type==="RestElement"?`...${ht(t.argument)}`:yu(t)).join(", ")}}`,yu=e=>{const t=e.key.type==="Identifier"?e.key.name:Yn(e.key.value);return e.shorthand&&e.key.type==="Identifier"&&e.value.type==="Identifier"&&e.value.name===e.key.name?(_t(t),t):`${t}: ${ht(e.value)}`},gu=(e,t="__fuel")=>{_t(t);const r=`const __burn = () => { if (--${t}.value < 0) throw new Error("fuel exhausted"); };`,n=e.body.map(s=>Ge(s,!0)).join("");return`${r}const __run = () => {${n}}; try { const ok = __run(); return { ok, fuel: ${t}.value }; } catch (err) { return { err: String(err), fuel: ${t}.value }; }`},$u=(e,t="__fuel")=>{_t(t);const r=`const __burn = () => { if (--${t}.value < 0) throw new Error("fuel exhausted"); };`,n=e.body.map(s=>Ge(s,!0)).join("");return`${r}const __run = async () => {${n}}; return __run().then(ok => ({ ok, fuel: ${t}.value })).catch(err => ({ err: String(err), fuel: ${t}.value }));`},vu=(()=>{const e=Object.create(null);return e.keys=t=>Object.keys(t),e.values=t=>Object.values(t),e.entries=t=>Object.entries(t),Object.freeze(e)})(),xo=e=>{if(e.some(a=>typeof a!="string"))throw new Error("Function arguments must be strings");const t=e,r=t.length?t[t.length-1]:"",n=t.slice(0,-1),s=[];for(const a of n)for(const i of a.split(",")){const c=i.trim();if(!c)continue;const u=c.startsWith("..."),l=u?c.slice(3):c;if(!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(l))throw new Error(`Invalid function parameter: ${c}`);s.push({name:l,rest:u})}const o=s.filter(a=>a.rest).length;if(o>1||o===1&&!s[s.length-1].rest)throw new Error("Rest parameter must be the last parameter");return{params:s,body:r}},Io=(e,t)=>{const r={};let n=0;for(const s of e)s.rest?(r[s.name]=t.slice(n),n=t.length):r[s.name]=t[n++];return r},wu=(e,t)=>(...r)=>{const{params:n,body:s}=xo(r);return(...o)=>{const a={...t,...Io(n,o)},i=bu(s,e,a);if("err"in i)throw new Error(i.err);return i.ok}},_u=(e,t)=>(...r)=>{const{params:n,body:s}=xo(r);return async(...o)=>{const a={...t,...Io(n,o)},i=await Co(s,e,a);if("err"in i)throw new Error(i.err);return i.ok}},Ro=(e,t,r)=>{const n={...e,Object:vu,Promise};return{...n,Function:r==="async"?_u(t,n):wu(t,n)}},To=e=>{if(e instanceof Error){const t=e.stack||"",r=`${e.name}: ${e.message}`,n=t.replace(/^[^\n]*\n?/,"").replace(/spacetimedb_module:(\d+):(\d+)/g,"<bundled:$1:$2>");return n?`${r}
${n}`:r}if(typeof e=="object"&&e!==null)try{return JSON.stringify(e)}catch{return String(e)}return String(e)},bu=(e,t,r={},n="__fuel")=>{try{const s=Ro(r,t,"sync"),o=Vo(e);if(Do(o).length)return{err:"prototype access",fuel:t.value};const i=Mo(o,[...Object.keys(s),n]);if(i.length)return{err:i.join(", "),fuel:t.value};const c=gu(o,n),u={...s,[n]:t};return new Function(...Object.keys(u),c)(...Object.values(u))}catch(s){return{err:To(s),fuel:t.value}}},Co=async(e,t,r={},n="__fuel")=>{try{const s=Ro(r,t,"async"),o=Vo(e);if(Do(o).length)return{err:"prototype access",fuel:t.value};const i=Mo(o,[...Object.keys(s),n]);if(i.length)return{err:i.join(", "),fuel:t.value};const c=$u(o,n),u={...s,[n]:t};return await new Function(...Object.keys(u),c)(...Object.values(u))}catch(s){return{err:To(s),fuel:t.value}}},Ao=async(e,t=1e4,r={})=>Co(e,{value:t},r),Eu=new Set(["if","else","return","await","typeof","let","const","for","while","in","of","break","continue","true","false","null"]),Su=e=>/[A-Za-z_$]/.test(e),ku=e=>/[A-Za-z0-9_$]/.test(e),Lr=e=>/[0-9]/.test(e),Pu=e=>{const t=[];let r=0;const n=(a,i,c)=>t.push({type:a,value:i,pos:c}),s=()=>e[r],o=()=>e[r++];for(;r<e.length;){const a=s();if(a===" "||a===`
`||a==="\r"||a==="	"){r++;continue}if(a==="/"&&e[r+1]==="/"){for(r+=2;r<e.length&&e[r]!==`
`;)r++;continue}if(a==="/"&&e[r+1]==="*"){for(r+=2;r<e.length&&!(e[r]==="*"&&e[r+1]==="/");)r++;r+=2;continue}if(a==="'"||a==='"'){const l=o();let f="";const w=r-1;for(;r<e.length;){const $=o();if($==="\\"){const p=o();f+=p}else{if($===l)break;f+=$}}n("string",f,w);continue}if(Lr(a)){const l=r;let f="";for(;r<e.length&&Lr(s());)f+=o();if(s()===".")for(f+=o();r<e.length&&Lr(s());)f+=o();n("number",f,l);continue}if(Su(a)){const l=r;let f="";for(;r<e.length&&ku(s());)f+=o();Eu.has(f)?n("keyword",f,l):n("identifier",f,l);continue}const i=r,c=e.slice(r,r+2),u=e.slice(r,r+3);if(u==="==="||u==="!=="||u==="..."){r+=3,n("operator",u,i);continue}if(c==="&&"||c==="||"||c==="=="||c==="!="||c==="<="||c===">="||c==="=>"||c==="+="||c==="-="||c==="*="||c==="/="||c==="%="||c==="++"||c==="--"){r+=2,n("operator",c,i);continue}if("+-*/%<>=!.,;:?(){}[]".includes(a)){r++;const l=".;,(){}[]".includes(a)?"punct":"operator";n(l,a,i);continue}throw new Error(`Unexpected character '${a}' at ${r}`)}return t.push({type:"eof",value:"",pos:r}),t},Mo=(e,t=[])=>{const r=[],n=new Set(t),s=[new Set],o=p=>s[s.length-1].add(p),a=p=>s.some(v=>v.has(p))||n.has(p),i=()=>s.push(new Set),c=()=>{s.pop()},u=p=>{a(p)||r.push(`undeclared: ${p}`)},l=p=>{p.type==="Identifier"?o(p.name):p.type==="RestElement"?l(p.argument):p.type==="ArrayPattern"?p.elements.forEach(l):p.properties.forEach(v=>{v.type==="RestElement"?l(v.argument):l(v.value)})},f=p=>{switch(p.type){case"Identifier":u(p.name);return;case"Literal":return;case"SpreadElement":f(p.argument);return;case"ArrayExpression":p.elements.forEach(v=>f(v));return;case"ObjectExpression":p.properties.forEach(v=>{v.type==="SpreadElement"?f(v.argument):f(v.value)});return;case"AwaitExpression":f(p.argument);return;case"CallExpression":f(p.callee),p.arguments.forEach(v=>f(v));return;case"MemberExpression":f(p.object),p.computed&&f(p.property);return;case"AssignmentExpression":f(p.left),f(p.right);return;case"UpdateExpression":f(p.argument);return;case"BinaryExpression":case"LogicalExpression":f(p.left),f(p.right);return;case"UnaryExpression":f(p.argument);return;case"ConditionalExpression":f(p.test),f(p.consequent),f(p.alternate);return;case"ArrowFunctionExpression":i(),p.params.forEach(l),p.body.type==="BlockStatement"?$(p.body):f(p.body),c();return}},w=p=>{l(p.id),p.init&&f(p.init)},$=p=>{switch(p.type){case"BlockStatement":i(),p.body.forEach($),c();return;case"ExpressionStatement":f(p.expression);return;case"IfStatement":f(p.test),$(p.consequent),p.alternate&&$(p.alternate);return;case"ReturnStatement":p.argument&&f(p.argument);return;case"VariableDeclaration":p.declarations.forEach(w);return;case"WhileStatement":f(p.test),$(p.body);return;case"ForStatement":{i(),Array.isArray(p.init)?p.init.forEach(w):p.init&&f(p.init),p.test&&f(p.test),p.update&&f(p.update),$(p.body),c();return}case"ForInStatement":case"ForOfStatement":{i(),Array.isArray(p.left)?p.left.forEach(w):f(p.left),f(p.right),$(p.body),c();return}case"BreakStatement":case"ContinueStatement":return}};return e.body.forEach($),r},Do=e=>{const t=[],r=new Set(["prototype","constructor","__proto__"]),n=o=>{switch(o.type){case"MemberExpression":!o.computed&&o.property.type==="Identifier"&&r.has(o.property.name)&&t.push("prototype access"),o.computed&&!(o.property.type==="Literal"&&typeof o.property.value=="number")&&t.push("only numeric literal indexing allowed"),n(o.object),o.computed&&n(o.property);return;case"SpreadElement":n(o.argument);return;case"CallExpression":n(o.callee),o.arguments.forEach(a=>n(a));return;case"AwaitExpression":n(o.argument);return;case"ArrayExpression":o.elements.forEach(a=>n(a));return;case"ObjectExpression":o.properties.forEach(a=>{a.type==="SpreadElement"?n(a.argument):n(a.value)});return;case"AssignmentExpression":n(o.left),n(o.right);return;case"UpdateExpression":n(o.argument);return;case"BinaryExpression":case"LogicalExpression":n(o.left),n(o.right);return;case"UnaryExpression":n(o.argument);return;case"ConditionalExpression":n(o.test),n(o.consequent),n(o.alternate);return;case"ArrowFunctionExpression":o.body.type==="BlockStatement"?s(o.body):n(o.body);return;case"Identifier":case"Literal":return}},s=o=>{switch(o.type){case"BlockStatement":o.body.forEach(s);return;case"ExpressionStatement":n(o.expression);return;case"IfStatement":n(o.test),s(o.consequent),o.alternate&&s(o.alternate);return;case"ReturnStatement":o.argument&&n(o.argument);return;case"VariableDeclaration":o.declarations.forEach(a=>a.init&&n(a.init));return;case"WhileStatement":n(o.test),s(o.body);return;case"ForStatement":Array.isArray(o.init)?o.init.forEach(a=>a.init&&n(a.init)):o.init&&n(o.init),o.test&&n(o.test),o.update&&n(o.update),s(o.body);return;case"ForInStatement":case"ForOfStatement":Array.isArray(o.left)?o.left.forEach(a=>a.init&&n(a.init)):n(o.left),n(o.right),s(o.body);return;case"BreakStatement":case"ContinueStatement":return}};return e.body.forEach(s),t},Vo=e=>{const t=Pu(e);let r=0;const n=()=>t[r],s=()=>t[r++],o=(T,L)=>{const x=n();if(x.type!==T||L!==void 0&&x.value!==L)throw new Error(`Expected ${L??T} at ${x.pos}`);return s()},a=(T,L)=>{const x=n();return x.type===T&&(L===void 0||x.value===L)},i=()=>{const T=[];for(;!a("eof");)T.push(c());return{type:"Program",body:T}},c=()=>{if(a("punct","{"))return u();if(a("keyword","if"))return l();if(a("keyword","while"))return p();if(a("keyword","for"))return v();if(a("keyword","break"))return s(),a("punct",";")&&s(),{type:"BreakStatement"};if(a("keyword","continue"))return s(),a("punct",";")&&s(),{type:"ContinueStatement"};if(a("keyword","return"))return f();if(a("keyword","let")||a("keyword","const"))return $();const T=m();return a("punct",";")&&s(),{type:"ExpressionStatement",expression:T}},u=()=>{o("punct","{");const T=[];for(;!a("punct","}");)T.push(c());return o("punct","}"),{type:"BlockStatement",body:T}},l=()=>{o("keyword","if"),o("punct","(");const T=m();o("punct",")");const L=c(),x=a("keyword","else")?(s(),c()):null;return{type:"IfStatement",test:T,consequent:L,alternate:x}},f=()=>{if(o("keyword","return"),a("punct",";"))return s(),{type:"ReturnStatement",argument:null};const T=a("punct","}")?null:m();return a("punct",";")&&s(),{type:"ReturnStatement",argument:T}},w=T=>{const L=s().value,x=[];do{const E=fe(),I=a("operator","=")?(s(),m()):null;if(x.push({type:"VariableDeclarator",id:E,init:I}),!a("punct",","))break;s()}while(!0);return T&&a("punct",";")&&s(),{kind:L,declarations:x}},$=()=>{const{kind:T,declarations:L}=w(!0);return{type:"VariableDeclaration",kind:T,declarations:L}},p=()=>{o("keyword","while"),o("punct","(");const T=m();o("punct",")");const L=c();return{type:"WhileStatement",test:T,body:L}},v=()=>{o("keyword","for"),o("punct","(");let T=null,L=null;if(!a("punct",";"))if(a("keyword","let")||a("keyword","const")){const _=w(!1);T=_.declarations,L=_.kind}else T=m();if(a("keyword","in")||a("keyword","of")){const _=s().value,d=m();o("punct",")");const g=c();if(!T)throw new Error(`Expected initializer before ${_} at ${n().pos}`);return _==="in"?{type:"ForInStatement",left:T,leftKind:L,right:d,body:g}:{type:"ForOfStatement",left:T,leftKind:L,right:d,body:g}}o("punct",";");const x=a("punct",";")?null:m();o("punct",";");const E=a("punct",")")?null:m();o("punct",")");const I=c();return{type:"ForStatement",init:T,initKind:L,test:x,update:E,body:I}},m=()=>h(),h=()=>{const T=y();if(a("operator","=")||a("operator","+=")||a("operator","-=")||a("operator","*=")||a("operator","/=")||a("operator","%=")){const L=s().value,x=h();return{type:"AssignmentExpression",operator:L,left:T,right:x}}return T},y=()=>{let T=S();if(a("operator","?")){s();const L=m();o("operator",":");const x=m();return{type:"ConditionalExpression",test:T,consequent:L,alternate:x}}return T},S=()=>{let T=P();for(;a("operator","||");){const L=s().value,x=P();T={type:"LogicalExpression",operator:L,left:T,right:x}}return T},P=()=>{let T=N();for(;a("operator","&&");){const L=s().value,x=N();T={type:"LogicalExpression",operator:L,left:T,right:x}}return T},N=()=>{let T=j();for(;a("operator","==")||a("operator","!=")||a("operator","===")||a("operator","!==");){const L=s().value,x=j();T={type:"BinaryExpression",operator:L,left:T,right:x}}return T},j=()=>{let T=A();for(;a("operator","<")||a("operator","<=")||a("operator",">")||a("operator",">=");){const L=s().value,x=A();T={type:"BinaryExpression",operator:L,left:T,right:x}}return T},A=()=>{let T=V();for(;a("operator","+")||a("operator","-");){const L=s().value,x=V();T={type:"BinaryExpression",operator:L,left:T,right:x}}return T},V=()=>{let T=U();for(;a("operator","*")||a("operator","/")||a("operator","%");){const L=s().value,x=U();T={type:"BinaryExpression",operator:L,left:T,right:x}}return T},U=()=>a("keyword","await")?(s(),{type:"AwaitExpression",argument:U()}):a("operator","++")||a("operator","--")?{type:"UpdateExpression",operator:s().value,argument:U(),prefix:!0}:a("keyword","typeof")?(s(),{type:"UnaryExpression",operator:"typeof",argument:U()}):a("operator","!")||a("operator","-")||a("operator","+")?{type:"UnaryExpression",operator:s().value,argument:U()}:W(),W=()=>{let T=Z();for(;;){if(a("operator","++")||a("operator","--")){T={type:"UpdateExpression",operator:s().value,argument:T,prefix:!1};continue}if(a("punct","(")){const L=pe();T={type:"CallExpression",callee:T,arguments:L};continue}if(a("punct",".")){s();const L=ce();T={type:"MemberExpression",object:T,property:L,computed:!1};continue}if(a("punct","[")){s();const L=m();o("punct","]"),T={type:"MemberExpression",object:T,property:L,computed:!0};continue}break}return T},Z=()=>{if(a("identifier","async")){const T=r;if(s(),a("identifier")){const L=ce();if(a("operator","=>")){s();const x=a("punct","{")?u():m();return{type:"ArrowFunctionExpression",params:[L],body:x,async:!0}}}else if(a("punct","(")){s();const L=[];let x=!0;try{if(!a("punct",")"))do{if(L.push(fe()),!a("punct",","))break;s()}while(!0)}catch{x=!1}if(x&&a("punct",")")&&(s(),a("operator","=>"))){s();const E=a("punct","{")?u():m();return{type:"ArrowFunctionExpression",params:L,body:E,async:!0}}}r=T}if(a("identifier")){const T=ce();if(a("operator","=>")){s();const L=a("punct","{")?u():m();return{type:"ArrowFunctionExpression",params:[T],body:L,async:!1}}return T}if(a("punct","(")){const T=r;s();const L=[];let x=!0;try{if(!a("punct",")"))do{if(L.push(fe()),!a("punct",","))break;s()}while(!0)}catch{x=!1}if(x&&a("punct",")")&&(s(),a("operator","=>"))){s();const I=a("punct","{")?u():m();return{type:"ArrowFunctionExpression",params:L,body:I,async:!1}}r=T,o("punct","(");const E=m();return o("punct",")"),E}return B()},B=()=>{if(a("number"))return{type:"Literal",value:Number(s().value)};if(a("string"))return{type:"Literal",value:s().value};if(a("keyword","true"))return s(),{type:"Literal",value:!0};if(a("keyword","false"))return s(),{type:"Literal",value:!1};if(a("keyword","null"))return s(),{type:"Literal",value:null};if(a("punct","["))return Y();if(a("punct","{"))return J();if(a("identifier"))return ce();throw new Error(`Unexpected token ${n().type} ${n().value} at ${n().pos}`)},Y=()=>{o("punct","[");const T=[];if(!a("punct","]"))do{if(a("operator","...")?(s(),T.push({type:"SpreadElement",argument:m()})):T.push(m()),!a("punct",","))break;s()}while(!0);return o("punct","]"),{type:"ArrayExpression",elements:T}},J=()=>{o("punct","{");const T=[];if(!a("punct","}"))do{if(a("operator","...")){if(s(),T.push({type:"SpreadElement",argument:m()}),!a("punct",","))break;s();continue}let L,x=!1;if(a("identifier"))L=ce();else if(a("string"))L={type:"Literal",value:s().value};else if(a("number"))L={type:"Literal",value:Number(s().value)};else throw new Error(`Expected object key at ${n().pos}`);let E;if(a("operator",":"))s(),E=m();else{if(L.type!=="Identifier")throw new Error(`Expected ':' after key at ${n().pos}`);E=L,x=!0}if(T.push({type:"Property",key:L,value:E,shorthand:x}),!a("punct",","))break;s()}while(!0);return o("punct","}"),{type:"ObjectExpression",properties:T}},pe=()=>{o("punct","(");const T=[];if(!a("punct",")"))do{if(a("operator","...")?(s(),T.push({type:"SpreadElement",argument:m()})):T.push(m()),!a("punct",","))break;s()}while(!0);return o("punct",")"),T},ce=()=>({type:"Identifier",name:o("identifier").value}),fe=()=>{if(a("operator","..."))return s(),{type:"RestElement",argument:fe()};if(a("punct","[")){o("punct","[");const T=[];if(!a("punct","]"))do{if(T.push(fe()),!a("punct",","))break;s()}while(!0);return o("punct","]"),{type:"ArrayPattern",elements:T}}if(a("punct","{")){o("punct","{");const T=[];if(!a("punct","}"))do{if(a("operator","...")){if(s(),T.push({type:"RestElement",argument:fe()}),!a("punct",","))break;s();continue}let L,x=!1;if(a("identifier"))L=ce();else if(a("string"))L={type:"Literal",value:s().value};else if(a("number"))L={type:"Literal",value:Number(s().value)};else throw new Error(`Expected object pattern key at ${n().pos}`);let E;if(a("operator",":"))s(),E=fe();else{if(L.type!=="Identifier")throw new Error(`Expected ':' after key at ${n().pos}`);E=L,x=!0}if(T.push({type:"Property",key:L,value:E,shorthand:x}),!a("punct",","))break;s()}while(!0);return o("punct","}"),{type:"ObjectPattern",properties:T}}return ce()};return i()};function Ou(e){const t=new Map,r=Le(e.toString()+it.get()),n=typeof localStorage<"u"?localStorage:null;return{has:s=>t.has(ue(s))||!!n?.getItem("funcache:"+Le(r,ue(s))),set:(s,o)=>(n?.setItem("funcache:"+Le(r,ue(s)),ue(o)),t.set(ue(s),o),o),get:s=>{const o=ue([s,it.get()]);if(t.has(o))return t.get(o);const a="funcache:"+Le(r,o),i=n?.getItem(a)??null;if(i!=null){let l=at(i);return t.set(o,l),l}let c=l=>(n?.setItem(a,ue(l)),t.set(o,l),l),u=e(s);return u instanceof Promise?u.then(c):c(u)}}}const kr=e=>{let t="",r=(n,s)=>{let o="  ".repeat(s);if(typeof n=="string")if(n.length>60||n.includes(`
`)){const i=n.split(`
`);t+=`
`+o+"`",i.forEach((c,u)=>{t+=(u===0?"":`
`+o)+c}),t+="`"}else t+=" "+n;else typeof n=="number"?t+=" "+n:typeof n=="object"&&Object.entries(n).forEach(([a,i])=>{t+=`
`+o+a+":",r(i,s+1)})};return r(e,0),t},ju=(e,t)=>e.slice(Math.max(0,e.length-t)).reverse(),Qn="jsonview",Lo={local:"http://localhost:3000",maincloud:"https://maincloud.spacetimedb.com"},yr=typeof localStorage<"u"?localStorage:null,it={value:yr?.getItem("db_preset")==="local"?"local":"maincloud",get:()=>it.value,set:async e=>(it.value=e,yr?.setItem("db_preset",e),qo=Lo[e],await Ho(),console.log("changed server to",e),e)};console.log("server: ",it.get());let nt,qo=Lo[it.get()];const Pr=async(e,t,r=null)=>fetch(`${qo}${e}`,{method:t,headers:{"Content-Type":"application/json",...nt?{Authorization:`Bearer ${nt}`}:{}},body:r}),Ho=async()=>{const e=`access_token:${it.get()}`;nt=yr?.getItem(e)??null,nt||(nt=(await(await Pr("/v1/identity","POST")).json())?.token||null,nt&&yr?.setItem(e,nt))};typeof fetch<"u"&&Ho();const zo=async(e,t)=>{const r=await Pr(`/v1/database/${Qn}/call/${e}`,"POST",JSON.stringify(t));if(!r.ok)throw new Error(await r.text());return r.text()},Nu=async e=>{const t=await zo("search_note",{query:e});return at(t).map(([r,n,s])=>({title:r,count:n,hash:s}))},Or=async e=>{const t=await(await Pr(`/v1/database/${Qn}/sql`,"POST",e)).text(),r=JSON.parse(t);r.length>1&&console.warn("multiple result sets returned");const{schema:n,rows:s}=r[0];return{names:n.elements.map(o=>o.name.some),rows:s}},{get:xu,set:Iu}=Ou(async e=>{const t=await Or(`select * from note where hash = '${e}'`),r=t.rows[0];if(!r)throw new Error("note note found");const n=Object.fromEntries(t.names.map((s,o)=>[s,r[o]]));return{schemaHash:n.schemaHash,data:at(n.data)}}),ie=e=>Promise.resolve(xu(e)),Ru=(e,t)=>t!==void 0?{schemaHash:e,data:t}:e;async function Ye(e,t=void 0){const r=Ru(e,t),n=ve(r),s=await Pr(`/v1/database/${Qn}/call/add_note`,"POST",JSON.stringify({schemaHash:r.schemaHash,data:ue(r.data)}));if(!s.ok)throw new Error(await s.text());return Iu(n,r),n}const Fo=async(e,t)=>at(at(await zo("call_note",{fn:e,arg:t!==void 0?ue(t):"null"}))),Zn=async(e,t,r={})=>{const n=await ie(e);if(n.schemaHash!==ve(Ut))throw new Error("can only call Function schema notes");const s=n.data,o=s.inputs?.length?s.inputs:Object.keys(s.args||{}),a={getNote:c=>ie(c.slice(1)),addNote:Ye,hash:Le,call:(c,u)=>Zn(c.slice(1),u,r),...r};o.forEach(c=>a[c]=t[c]);const i=await Ao(s.code,1e4,a);if("err"in i)throw new Error(i.err);return i.ok},es=e=>{const t=[],r=/#([a-f0-9]{32})/g;let n=0,s;for(;s=r.exec(e);){const o=s.index;o>n&&t.push({type:"text",value:e.slice(n,o)}),t.push({type:"ref",value:s[1]}),n=o+s[0].length}return n<e.length&&t.push({type:"text",value:e.slice(n)}),t},Tu="https://openrouter.ai/api/v1/chat/completions",Cu="openai/gpt-4o-mini",Au=async({apiKey:e,prompt:t,schema:r,model:n=Cu,endpoint:s=Tu,fetchImpl:o=fetch})=>{if(!e)throw new Error("openrouter apiKey is required");const a={model:n,messages:[{role:"user",content:t}],response_format:{type:"json_schema",json_schema:{name:"response",schema:r}}},i=await o(s,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok){const l=await i.text();throw new Error(`openrouter request failed: ${i.status} ${i.statusText} ${l}`)}const c=await i.json(),u=c?.choices?.[0]?.message?.content;if(typeof u!="string")return c;try{const l=JSON.parse(u);return Sr(l,r),l}catch{return c}},Mu=["click","mousemove","mouseup","mousedown","drag","wheel"],Du=["keydown","keyup"],Uo="http://www.w3.org/2000/svg",Vu=new Set(["svg","path","g","line","polyline","polygon","circle","ellipse","rect","text"]),Lu=new Set(["viewBox","width","height","xmlns","d","fill","stroke","stroke-width","stroke-linecap","stroke-linejoin","stroke-dasharray","stroke-dashoffset","x","y","x1","y1","x2","y2","cx","cy","r","rx","ry","points","transform","opacity","font-size","font-family","font-weight","text-anchor","dominant-baseline","dx","dy"]);let Pt=new WeakMap,ut=new WeakMap;const Lt=e=>{const t=r=>{const n=Vu.has(r.tag)?document.createElementNS(Uo,r.tag):document.createElement(r.tag);return n.textContent=r.textContent,(n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement)&&r.value&&(n.value=r.value),ut.set(r,n),Pt.set(n,r),n.append(...r.children.map(s=>t(s))),Object.entries(r.attrs).forEach(([s,o])=>{Lu.has(s)&&n.setAttribute(s,o)}),Object.entries(r.style).forEach(s=>n.style.setProperty(...s)),Mu.forEach(s=>n.addEventListener(s,o=>{const a=o;r.onEvent!=null&&r.onEvent({type:s,target:Pt.get(o.target),clientX:a.clientX,clientY:a.clientY,deltaY:s==="wheel"?a.deltaY:void 0,currentTarget:n,preventDefault:()=>o.preventDefault()})})),Du.forEach(s=>n.addEventListener(s,o=>{let{key:a,metaKey:i,shiftKey:c}=o;["INPUT","TEXTAREA"].includes(o.target.tagName)&&(r.value=o.target.value),r.onEvent!=null&&r.onEvent({type:s,key:a,metaKey:i,shiftKey:c,target:Pt.get(o.target)})})),n};return t(e({add:(r,...n)=>{ut.get(r)?.append(...n.map(s=>t(s)))},del:r=>{Pt.delete(ut.get(r)),ut.get(r)?.remove(),ut.delete(r)},update:r=>{let n=ut.get(r);n.replaceWith(t(r)),Pt.delete(n)}}))},ye=e=>(...t)=>{let r=new Map,n={tag:e,style:{},attrs:{},textContent:"",id:"",children:[],onEvent:o=>{let a=r.get(o.type);if(a)return a(o)}},s=o=>{if(o instanceof Array)o.forEach(s);else if(typeof o=="string")n.textContent=o;else if(o instanceof Object){if("tag"in o)return n.children.push(o);"id"in o&&(n.id=o.id),"value"in o&&(n.value=o.value),"attrs"in o&&Object.entries(o.attrs).forEach(([a,i])=>n.attrs[a]=i),"style"in o&&Object.entries(o.style).forEach(a=>n.style[a[0].replace(/([A-Z])/g,"-$1")]=a[1]),Object.entries(o).forEach(([a,i])=>{a.startsWith("on")&&r.set(a.slice(2),i)})}};return s(t),n};let Yr=ye("div"),qu=ye("svg"),Hu=ye("path"),zu=ye("text");const Fu=(...e)=>{const t=Yr({style:{background:"var(--background-color)",color:"var(--color)",padding:"1em",paddingBottom:"2em",borderRadius:"1em",zIndex:"2000",overflowY:"scroll"}},...e);return Yr({style:{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(166, 166, 166, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"2000"}},t)},Uu={div:Yr,span:ye("span"),p:ye("p"),h1:ye("h1"),h2:ye("h2"),h3:ye("h3"),h4:ye("h4"),h5:ye("h5"),h6:ye("h6"),a:ye("a"),button:ye("button"),input:ye("input"),textarea:ye("textarea"),pre:ye("pre"),svgPath:(e,t={},...r)=>{const n=e instanceof Array?e:[e],{viewBox:s="0 0 24 24",width:o="1em",height:a="1em",fill:i="currentColor",stroke:c,strokeWidth:u}=t,l={fill:i};return c&&(l.stroke=c),u&&(l["stroke-width"]=u),qu({attrs:{viewBox:s,width:o,height:a,xmlns:Uo}},...n.map(f=>Hu({attrs:{...l,d:f}})),...r)},svgText:(e,t={})=>{const r={};return t.x&&(r.x=t.x),t.y&&(r.y=t.y),t.fill&&(r.fill=t.fill),t.background&&(r.background=t.background),t.fontSize&&(r["font-size"]=t.fontSize),t.fontFamily&&(r["font-family"]=t.fontFamily),t.fontWeight&&(r["font-weight"]=t.fontWeight),t.textAnchor&&(r["text-anchor"]=t.textAnchor),t.dominantBaseline&&(r["dominant-baseline"]=t.dominantBaseline),t.dx&&(r.dx=t.dx),t.dy&&(r.dy=t.dy),zu({attrs:r},e)},popup:Fu},qr=(e,t,...r)=>({tag:e,attrs:t,style:{},textContent:"",id:"",children:r}),Ku=(e,t)=>({tag:"text",attrs:t,style:{},textContent:e,id:"",children:[]}),Bu=e=>{const{nodes:t,edges:r,boxW:n=36,boxH:s=10}=e,o=new Map;for(const j of t)o.set(j.id,{id:j.id,children:[],parents:[]});for(const[j,A]of r)o.get(A)?.children.push(j),o.get(j)?.parents.push(A);const a=new Map,i=j=>{if(a.has(j))return a.get(j);const A=o.get(j),V=A.children.length?1+Math.max(...A.children.map(i)):0;return a.set(j,V),V};o.forEach((j,A)=>i(A));const c=Math.max(0,...a.values());let u=0;for(const j of[...o.values()]){const A=a.get(j.id);j.children=j.children.flatMap(V=>{const U=a.get(V);if(A-U<=1)return[V];let W=V;for(let Z=U+1;Z<A;Z++){const B=`__dummy_${u++}`;o.set(B,{id:B,children:[W],parents:[],dummy:!0}),o.get(W).parents=o.get(W).parents.filter(Y=>Y!==j.id),o.get(W).parents.push(B),a.set(B,Z),W=B}return o.get(W).parents.push(j.id),[W]})}const l=Array.from({length:c+1},()=>[]);o.forEach((j,A)=>l[a.get(A)].push(A));const f=new Map;l.forEach(j=>j.forEach((A,V)=>f.set(A,V)));const w=(j,A)=>{const V=o.get(j)[A];return V.length?V.reduce((U,W)=>U+f.get(W),0)/V.length:f.get(j)};for(let j=c-1;j>=0;j--)l[j].sort((A,V)=>w(A,"children")-w(V,"children")),l[j].forEach((A,V)=>f.set(A,V));for(let j=1;j<=c;j++)l[j].sort((A,V)=>w(A,"parents")-w(V,"parents")),l[j].forEach((A,V)=>f.set(A,V));const $=n+5,p=s+10,m=Math.max(...l.map(j=>j.length))*$+20,h=(c+1)*p+20,y=new Map;for(const[j,A]of l.entries()){const V=A.length*$,U=(m-V)/2+$/2;for(const[W,Z]of A.entries())y.set(Z,{x:U+W*$,y:10+j*p+s/2})}const S=[];o.forEach(j=>{j.dummy||j.children.forEach(A=>{const V=[y.get(j.id)];let U=A;for(;o.get(U)?.dummy;)V.push(y.get(U)),U=o.get(U).children[0];V.push(y.get(U)),V.reverse(),S.push({points:V,sourceId:U,targetId:j.id})})});const P=new Map;return S.forEach((j,A)=>{for(const V of[j.sourceId,j.targetId])P.has(V)||P.set(V,[]),P.get(V).push(A)}),{boxes:[...y.entries()].filter(([j])=>!o.get(j)?.dummy),chains:S,nodeEdges:P,viewBox:`0 0 ${m} ${h}`,boxW:n,boxH:s}},Wu=(e,t,...r)=>({tag:e,attrs:{},style:t,textContent:"",id:"",children:r}),Hr=200,Ms=110,Ju=70,Gu=1.8,Qr=e=>{const{onClickBox:t,onHighlightBox:r}=e,{boxes:n,chains:s,nodeEdges:o,viewBox:a,boxW:i,boxH:c}=Bu(e),[,,u,l]=a.split(" ").map(Number),f=new Map;for(const _ of e.nodes)f.set(_.id,_);const w=Hr/Ms,$=Math.max(Hr,u*Gu);let p=Hr,v=Ms,m=(u-p)/2,h=(l-v)/2,y=!1,S=!1,P=0,N=0,j=0,A=0,V=null,U=null,W=null,Z=null,B=null;const Y=(_,d,g,O)=>{const C=(d-g)/2,D=Math.min(C-O,-O),z=Math.max(C+O,d-g+O);return Math.max(D,Math.min(_,z))},J=()=>{const _=p*.45,d=v*.25;m=Y(m,u,p,_),h=Y(h,l,v,d)};J();const pe=(_,d)=>{const g=_[0],O=_[_.length-1],C=g.x,D=g.y+c/2,z=O.x,F=O.y-c/2;let b;if(_.length===2){const R=Math.abs(F-D)*.4;b=`M${C} ${D} C${C} ${D+R} ${z} ${F-R} ${z} ${F}`}else{b=`M${C} ${D}`;const R=[{x:C,y:D},..._.slice(1,-1).map(M=>({x:M.x,y:M.y})),{x:z,y:F}];for(let M=0;M<R.length-1;M++){const H=R[M],K=R[M+1],se=Math.abs(K.y-H.y)*.4;b+=` C${H.x} ${H.y+se} ${K.x} ${K.y-se} ${K.x} ${K.y}`}}const k=2;return b+=` M${z-k/2} ${F-k} L${z} ${F} L${z+k/2} ${F-k}`,qr("path",{d:b,fill:"none",stroke:d?"#f90":"var(--color)","stroke-width":d?"0.8":"0.5",opacity:d?"1":"0.6"})},ce=_=>(_.dom?.textContent||"").trim()||_.id,fe=(_,d,g,O)=>{const C=f.get(_),D=qr("g",{},qr("rect",{x:`${d.x-i/2}`,y:`${d.y-c/2}`,width:`${i}`,height:`${c}`,fill:"var(--background-color)",stroke:g?"#f90":"var(--color)","stroke-width":g?"0.6":"0.3"}),Ku(C?ce(C):_,{x:`${d.x}`,y:`${d.y}`,"text-anchor":"middle","dominant-baseline":"central",fill:"var(--color)","font-size":"2.6"}));return O&&(D.onEvent=O),D.style.cursor="pointer",D},T=()=>{if(!r)return;const _=V&&f.get(V)||null;r(V,_)},L=_=>{if(!_)return;const d=f.get(_);!d||(t&&t(_,d,!0),d.dom.onEvent&&d.dom.onEvent({type:"click",target:d.dom}))},x=()=>{!W||!Z||!B||(B(),W.update(Z))},E={setSelected:(_,d=!0,g=!1)=>{const O=d&&V===_?null:_;O!==V&&(V=O,T(),x(),g&&L(V))},setHighlight:_=>{U!==_&&(U=_,x())}};return{render:_=>{W=_;const d={tag:"svg",textContent:"",id:"",style:{cursor:"grab"},attrs:{viewBox:`${m} ${h} ${p} ${v}`,width:"100%",xmlns:"http://www.w3.org/2000/svg"},children:[],onEvent:C=>{if(C.type==="mousedown"&&C.clientX!=null)y=!0,S=!1,P=C.clientX,N=C.clientY,j=m,A=h;else if(C.type==="mousemove"&&y&&C.clientX!=null){const D=C.currentTarget?.getBoundingClientRect?.();if(!D)return;const z=C.clientX-P,F=C.clientY-N;if(!S&&Math.abs(z)<3&&Math.abs(F)<3)return;S=!0,m=j-z*(p/D.width),h=A-F*(v/D.height),J(),x()}else if(C.type==="mouseup"){const D=y&&S;y=!1,D&&x()}else if(C.type==="wheel"){C.preventDefault?.();const D=C.currentTarget?.getBoundingClientRect?.();if(!D)return;const z=(C.deltaY||0)>0?1.1:.9,F=p,b=v,k=Math.max(Ju,Math.min($,F*z)),R=k/w,M=C.clientX!=null?Math.max(0,Math.min(1,(C.clientX-D.left)/D.width)):.5,H=C.clientY!=null?Math.max(0,Math.min(1,(C.clientY-D.top)/D.height)):.5,K=m+M*F,se=h+H*b;p=k,v=R,m=K-M*p,h=se-H*v,J(),x()}}},g=Wu("div",{width:"100%"},d);Z=g;const O=()=>{d.attrs.viewBox=`${m} ${h} ${p} ${v}`,d.style.cursor=y?"grabbing":"grab";const C=new Set([V,U].filter(z=>!!z)),D=new Set;C.forEach(z=>(o.get(z)||[]).forEach(F=>D.add(F))),d.children=[...s.map((z,F)=>pe(z.points,D.has(F))),...n.map(([z,F])=>fe(z,F,C.has(z),b=>{b.type!=="click"||S||E.setSelected(z,!0,!0)}))]};return B=O,O(),g},controls:E}},Ad=async e=>{const t=async n=>(await ie(n)).data,r=await t(e.schemaHash);return Sr(await Mt(e.data,t),await Mt(r,t))},Ko=async e=>{const t=e.startsWith("#")?e.slice(1):e,r=/^[a-f0-9]+$/i.test(t);if(r&&t.length===32)try{return[{title:(await ie(t)).data?.title??"",hash:t,count:1}]}catch{return[]}let n=await Nu(r?"":t);return r&&t&&(n=n.filter(s=>s.hash.includes(t.toLowerCase())||s.title.toLowerCase().includes(t.toLowerCase()))),n},jr={type:"string"},Xu=(e,t={})=>({type:"object",properties:e,required:Object.keys(e),...t}),Yu=e=>({type:"array",items:e}),ts={$id:"graph",oneOf:[{$:{const:"input"},outputSchema:{}},{$:{const:"logic"},inputs:{type:"object",additionalProperties:{$ref:"graph"}},code:jr,outputSchema:{}},{$:{const:"llm_call"},prompt:{$ref:"graph"},outputSchema:{}},{$:{const:"loop"},input:{$ref:"graph"},condition:{$ref:"graph"},body:{$ref:"graph"},outputSchema:{}}].map(Xu)},bt=Se("graph_schema",ts),Bo=Se("",bt,{$:"input",outputSchema:jr}),Qu=(e,t,r)=>Se("",bt,{$:"logic",code:r,inputs:e,outputSchema:t}),Zu=(e,t)=>Se("",bt,{$:"llm_call",prompt:e,outputSchema:t}),ed=Qu({data:Bo.data},jr,"return `extract a list of important names from this text: ${data}`"),Wo=Zu(ed.data,Yu(jr));Sr(Bo.data,ts);Sr(Wo.data,ts);const td=e=>JSON.stringify(e,null,2),Nr=e=>{const t=X(de("loading...")),r=a=>{t.innerHTML="";const i=X(te({display:"flex",flexDirection:"column",gap:"0.5em"}));a.slice(0,10).forEach(c=>{const u=c.count!==void 0?` (${c.count})`:"",l=c.hash.slice(0,8),f=X(te({display:"flex",gap:"0.5em",alignItems:"center"}),be(`#${l}${c.title?` : ${c.title}`:""}${u}`,{style:{textAlign:"left",width:"100%"},onclick:()=>{e(c),o.remove()}}),be("preview",{onclick:()=>window.open(`/${c.hash}`,"_blank","noopener"),style:{fontSize:"0.85em",padding:"0.2em 0.4em"}}));i.appendChild(f)}),t.appendChild(i)},n=a=>{Ko(a).then(r).catch(()=>r([]))};n("");const s=ur("",{placeholder:"search hash, title"});s.oninput=()=>n(s.value.trim());let o=Re(X(te({display:"flex",flexDirection:"column",gap:"0.5em"}),s,t))},rd=(e,t="change schema")=>be(t,{onclick:()=>Nr(e)}),er=(e,t,r)=>{let{type:n,properties:s,items:o}=e;if(!n){let i=er({type:"string"},()=>{try{let l=i.getData(),f=at(l);u.innerHTML="",c.onclick=()=>i.setData(ue(f))}catch(l){u.innerHTML=String(l)}}),c=be("format"),u=mt("hello",te({color:"red",margin:"0.5em"}));return{element:X(i.element,X(c,u)),getData:()=>at(i.getData()),setData:l=>i.setData(ue(l))}}const a=i=>{let c="";const u=mt();u.style.display="none",u.style.cursor=r?"pointer":"default",u.style.textDecoration=r?"underline":"none",u.onclick=$=>{if(r&&Nt(c)){$.preventDefault(),r(c.slice(1));return}c="",u.style.display="none",i.element.style.display="",t()};const l=$=>{c=$,Nt(c)?(u.innerText=c,u.style.display="",i.element.style.display="none"):(u.style.display="none",i.element.style.display=""),t()},w=be("\u{1F517}",{onclick:()=>Nr($=>l(`#${$.hash}`)),style:{background:"transparent",border:"none",padding:"0 0.1em",cursor:"pointer"}});return{element:X(te({display:"inline-flex",alignItems:"center",gap:"0.25em"}),w,u,i.element),getData:()=>Nt(c)?c:i.getData(),setData:$=>{typeof $=="string"&&Nt($)?l($):(l(""),i.setData($))}}};if(n=="string"){let i=Ws();i.rows=1,i.style.resize="none",i.style.overflow="hidden",i.style.verticalAlign="middle",i.style.boxSizing="content-box";const c=50,u=X(te({display:"none",position:"absolute",border:"1px solid #ccc",padding:"0.5em",borderRadius:"0.5em",background:"var(--background-color)",zIndex:"1000",maxHeight:"200px",overflowY:"auto"})),l=()=>{const $=i.selectionStart??0,p=i.value,v=p.lastIndexOf("#",$-1);if(v<0){u.style.display="none";return}const m=p.slice(v+1,$);if(!/^[A-Za-z0-9]*$/.test(m)){u.style.display="none";return}Ko(m).then(h=>{if(u.innerHTML="",!h.length){u.style.display="none";return}h.slice(0,8).forEach(y=>{const S=y.hash.slice(0,8);u.appendChild(be(`#${S}${y.title?`: ${y.title}`:""} (${y.count})`,{onclick:()=>{const P=p.slice(0,v),N=p.slice($);i.value=`${P}#${y.hash}${N}`;const j=v+1+y.hash.length;i.setSelectionRange(j,j),u.style.display="none",f()}}))}),u.style.display="block"})},f=()=>{i.style.height="0px",i.style.height=`${i.scrollHeight}px`;const $=i.value.split(`
`).reduce((p,v)=>Math.max(p,v.length),0);i.style.width=`${Math.max(c,$+1)}ch`,t()};i.oninput=()=>{f(),l()},i.onkeydown=$=>{$.key==="#"&&l()},requestAnimationFrame(f);const w=X(te({position:"relative",display:"inline-block"}),i,u);return a({element:w,getData:()=>i.value,setData:$=>{i.value=$,f()}})}if(n=="number"){let i=ur();return i.type="number",i.oninput=t,a({element:i,getData:()=>Number(i.value),setData:c=>{i.value=String(c)}})}if(n=="array"){let i=[],c=X();const u=f=>{const w=X(te({display:"flex",alignItems:"center",gap:"0.25em"}),be("-",{onclick:()=>{i=i.filter($=>$!==f),w.remove(),t()}}),f.element);return w};let l=X(te({paddingLeft:"0.5em"}),c,be("+",{onclick:()=>{let f=er(o,t);i.push(f),c.append(u(f)),t()}}));return a({element:l,getData:()=>i.map(f=>f.getData()),setData:f=>{i=f.map(w=>{let $=er(o,t);return $.setData(w),c.append(u($)),$})}})}if(n=="object"){const i=new Set(e.required||[]);let c=Object.entries(s).map(([u,l])=>({key:u,field:er(l,t),box:ur()}));return a({element:X(c.map(({key:u,field:l,box:f})=>(f.type="checkbox",i.has(u)&&(f.checked=!0,f.disabled=!0),f.oninput=()=>t(),f.onchange=()=>{const w=f.checked||i.has(u);l.element.style.display=w?"":"none",t()},i.has(u)||(l.element.style.display="none"),de(f,u,":",l.element)))),getData:()=>Object.fromEntries(c.filter(({key:u,field:l})=>i.has(u)||l.element.style.display!=="none").map(({key:u,field:l})=>[u,l.getData()])),setData:u=>{c.forEach(({key:l,field:f,box:w})=>{i.has(l)?f.element.style.display="":(w.checked=!1,f.element.style.display="none")}),Object.entries(u).forEach(([l,f])=>{const w=c.find($=>$.key===l);w&&(w.field.setData(f),i.has(l)||(w.box.checked=!0,w.field.element.style.display=""))})}})}},Zr=e=>ie(e).then(t=>{const r=t.data;if(r?.title)return String(r.title);const n=(typeof r=="string"?r:JSON.stringify(r)).replace(/\n/g," ");return typeof r=="string"||typeof r=="number"?n.slice(0,20):`#${e.slice(0,8)}`}),rs=(e,t,r={})=>{const n=mt(t??`#${e}`);return t===void 0&&Zr(e).then(s=>n.innerHTML=s),It(`/${e}`,n,r)},Jo="$"+Le("openrouter");let tr=localStorage.getItem(Jo)||"";const nd=async(e,t,r="openai/gpt-4o")=>(tr===""&&await new Promise((n,s)=>{let o=ur(),a=Re(de("Please enter your OpenRouter API key to use the LLM feature"),o);o.addEventListener("keydown",i=>{i.key=="Enter"&&(tr=o.value,localStorage.setItem(Jo,tr),n(),a.remove())})}),Au({apiKey:tr,prompt:e,schema:t,model:r})),sd=()=>async(e,t)=>(typeof t=="string"&&t.startsWith("#")&&(t=(await ie(t.slice(1))).data),nd(e,t)),od=e=>({getItem:t=>localStorage.getItem(`${e}:${t}`),setItem:(t,r)=>localStorage.setItem(`${e}:${t}`,r)}),ns=(e,t)=>{let r=null;const n=Lt(s=>(r=s,e(s)));return t(n),r},ad=e=>t=>e?.view?e.view(t):ns(t,r=>{Re(_e("view"),r)}),Go=(e,t)=>({remote:Fo,openrouter:sd(),storage:od(e),view:ad(t),HTML:Uu}),Xo=async(e,t,r)=>Zn(e,t,Go(e,r)),id=e=>{if(!e||typeof e!="object")return!1;const t=e;return typeof t.tag=="string"&&typeof t.textContent=="string"&&typeof t.id=="string"&&typeof t.style=="object"&&Array.isArray(t.children)},Ds=(e,t)=>{const r=Object.keys(e.args||{}),n=String(e.code||"").includes("args");if(!r.length&&!n)return{canceled:!1,parsed:{}};const s=r.length?JSON.stringify(Object.fromEntries(r.map(i=>[i,null])),null,2):"{}",o=prompt("args as JSON object (use {} for none)",localStorage.getItem(t)??s);if(o==null)return{canceled:!0,parsed:void 0};const a=o.trim();if(!a)return Re(_e("ERROR"),de("Args cannot be empty. Use {} for no arguments.")),{canceled:!0,parsed:void 0};try{const i=JSON.parse(a);return localStorage.setItem(t,a),{canceled:!1,parsed:i}}catch(i){return Re(_e("ERROR"),de("Invalid JSON: "+i.message)),{canceled:!0,parsed:void 0}}},Vs=e=>{e!==void 0&&(id(e)?Re(_e("result"),Lt(()=>e)):Re(_e("result"),gr(typeof e=="string"?e:JSON.stringify(e,null,2))))},Md=async(e,t,r)=>{const n=Go("draft",r),s={getNote:a=>ie(a.slice(1)),addNote:Ye,hash:Le,call:(a,i)=>Zn(a.slice(1),i,n),...n};Object.keys(e.args||{}).forEach(a=>s[a]=t[a]);const o=await Ao(e.code,1e4,s);if("err"in o)throw new Error(String(o.err));return o.ok},Ls=e=>{const t=mt(te({margin:"0.5em"}));return es(e).forEach(r=>{r.type==="text"?t.append(document.createTextNode(r.value)):t.append(rs(r.value))}),t},cd=(e,t)=>{const r=X(te({display:"flex",flexDirection:"column",gap:"0.75em"}));return ie(e).then(async n=>{const s=n.schemaHash,o=s===ve(bt),a=n.data?.title??"",i=n.schemaHash===ve(Jn),c=i?String(n.data.code||""):td(n.data);let u=localStorage.getItem("note_view_mode")==="overview";const l=X(te({fontFamily:"monospace",whiteSpace:"pre",marginTop:"1em",overflowX:"auto",paddingBottom:"0.5em"})),f=()=>{l.innerHTML="",u&&!i?ie(e).then(v=>{l.append(gr(Ls(kr(v.data))))}):l.append(Ls(c))},w=be(u?"json view":"overview",{onclick:()=>{u=!u,localStorage.setItem("note_view_mode",u?"overview":"json"),w.textContent=u?"json view":"overview",f()}});r.innerHTML="";const $=e.slice(0,8),p=nn(`${i?"Script":"Note"} #${$} ${a} `);if(n.schemaHash===ve(Ut)){const v=n.data,m=be("run local",{onclick:async()=>{const{canceled:y,parsed:S}=Ds(v,"local_fun_arg");if(!y)try{m.textContent="running...";const P=await Xo(e,S??{},{view:N=>ns(N,j=>{r.innerHTML="",r.append(j),history.pushState({},"",`/view/${e}`)})});Vs(P)}catch(P){Re(_e("ERROR"),de(P.message||"run failed"))}finally{m.textContent="run local"}}}),h=be("run remote",{onclick:async()=>{const{canceled:y,parsed:S}=Ds(v,"remote_fun_arg");if(!y)try{h.textContent="running...";const P=await Fo(e,S??{});Vs(P)}catch(P){Re(_e("ERROR"),de(P.message||"run failed"))}finally{h.textContent="run remote"}}});p.append(m,h)}f(),r.append(p,i?"":de("schema: ",rs(s)),i?"":X(te({marginBottom:"0.5em"}),w),l,X(te({display:"flex",gap:"0.75em",alignItems:"center",paddingBottom:"0.5em"}),It(`/edit?hash=${e}`,"edit"),It(`/deps/${e}`,"deps"),o?It(`/pipeline/${e}`,"pipeline"):"",be("copy",{onclick:v=>navigator.clipboard.writeText(c).then(()=>v.target.textContent="copied").catch(m=>Re(_e("ERROR"),de(m.message||"copy failed")))})))}),r},ld=({query:e,navigate:t,onRow:r})=>{const n="any";let s=null,o=new Map;const a=X(),i=X(te({display:"flex",gap:"0.5em",alignItems:"center",flexWrap:"wrap"}),be("any",{onclick:()=>l(n)}),Object.entries({function:Ut,pipeline:bt}).map(([v,m])=>be(v,{onclick:()=>l(ve(m))})),rd(v=>l(v.hash)));let c=n;const u=()=>Nr(v=>t(`/${v.hash}`)),l=v=>{c=v,w()},f=v=>{a.innerHTML="";const m=X(te({display:"flex",flexDirection:"column",gap:"0.5em"}));v.forEach(h=>{const y={hash:h[0],data:h[1]};r&&r(y),m.append(rs(y.hash))}),a.append(m)},w=async()=>{o.has(c)?f(o.get(c)):(a.innerHTML="",a.append(de("running...")));let m=null;try{const P=await e("select count from note_count");m=Number(P.rows[0][0])}catch{}if(m!==null&&m===s&&o.has(c))return;m!==s&&(o.clear(),s=m);const h=c===n?"select hash, data from note":`select hash, data from note where schemaHash = '${c}'`,y=await e(h),S=ju(y.rows,50);o.set(c,S),f(S)},$=be("\u{1F50D} Search Notes",{onclick:u,style:{padding:"0.25em 0.5em",border:"1px solid #ccc",borderRadius:"0.25em",background:"inherit",color:"inherit",cursor:"pointer"}});return{root:X(te({display:"flex",flexDirection:"column",gap:"0.75em"}),X(te({display:"flex",gap:"0.5em",flexWrap:"wrap"}),It("/edit?new=1",{style:{textDecoration:"none",color:"inherit",fontWeight:"bold",border:"1px solid #ccc",borderRadius:"0.25em",padding:"0.25em 0.5em"}},"+ Add Note"),$),i,a),runQuery:w}},ud=({query:e,onRow:t})=>{const r="dashboard_sql",n=localStorage.getItem(r),s=Ws(te({fontFamily:"monospace",padding:".5em"}),n||"select hash, data from note limit 50");s.rows=2,s.cols=100,s.onkeydown=l=>{(l.metaKey||l.ctrlKey)&&l.key==="Enter"&&(l.preventDefault(),i())},s.oninput=()=>{localStorage.setItem(r,s.value)};const o=X(),a=l=>{if(typeof l=="bigint")return l.toString();if(typeof l=="number"){const f=String(l);return f.includes("e")||f.includes("E")?l.toLocaleString("fullwide",{useGrouping:!1}):f}return String(l)},i=()=>{o.innerHTML="",o.append(de("running...")),e(s.value).then(l=>{o.innerHTML="";const f=ia(te({borderCollapse:"collapse"}),ls(l.names.map(w=>la(te({border:"1px solid #ccc",padding:".5em"}),w))),...l.rows.map(w=>{const $={};return l.names.forEach((p,v)=>{$[p]=w[v]}),t&&t($),ls(...w.map(p=>{let v=a(p).replace(/[\n\r]/g,"");return v=v.length>20?v.substring(0,20)+"...":v,ca(te({border:"1px solid #ccc",padding:".5em"}),v)}))}));o.append(f)})},c=X(te({display:"flex",alignItems:"center",gap:"0.5em"}),de(te({opacity:"0.6",margin:"0"}),"SQL console:"),be("run",{onclick:i,style:{fontSize:"0.85em",padding:"0.2em 0.5em"}}));return{root:X(te({display:"flex",flexDirection:"column",gap:"0.75em"}),nn("SQL"),c,s,o),runQuery:i}},qt=(e,t)=>(e.insertAdjacentHTML("beforeend",t),e.lastElementChild),Ht=(e,t)=>{if(t.x>1||t.y>1)return t;const{width:r,height:n}=e.getBoundingClientRect();return{x:t.x*r,y:t.y*n}},qs=(e,t,r,n={})=>{const{stroke:s="currentColor",strokeWidth:o=2,curvature:a=.4}=n,i=Ht(e,t),c=Ht(e,r),u=Math.max(10,Math.abs(c.x-i.x)*a);qt(e,`<path d="M ${i.x} ${i.y} C ${i.x+u} ${i.y} ${c.x-u} ${c.y} ${c.x} ${c.y}" fill="none" stroke="${s}" stroke-width="${o}"></path>`);const l=10,f=c.x-l,w=c.y-l*.5,$=c.x-l,p=c.y+l*.5;return qt(e,`<path d="M ${c.x} ${c.y} L ${f} ${w} M ${c.x} ${c.y} L ${$} ${p}" fill="none" stroke="${s}" stroke-width="${o}"></path>`)},dd=(e,t,r,n={})=>{const{stroke:s="currentColor",strokeWidth:o=2}=n,a=Ht(e,t),i=Ht(e,r);qt(e,`<path d="M ${a.x} ${a.y} L ${i.x} ${i.y}" fill="none" stroke="${s}" stroke-width="${o}"></path>`);const c=10,u=i.x-c*.5,l=i.y-c,f=i.x+c*.5,w=i.y-c;return qt(e,`<path d="M ${i.x} ${i.y} L ${u} ${l} M ${i.x} ${i.y} L ${f} ${w}" fill="none" stroke="${s}" stroke-width="${o}"></path>`)},Hs=(e,t,r)=>{const s=Ht(e,t),o=qt(e,`<g><text x="${s.x}" y="${s.y}" dominant-baseline="middle" text-anchor="middle" fill="var(--color)" font-size="14" cursor="pointer" font-family="sans-serif">${r}</text></g>`),a=o?.querySelector("text"),i=5,u=a.getBBox().height+i*2,l=s.x-220/2,f=s.y-u/2;return o.insertAdjacentHTML("afterbegin",`<rect x="${l}" y="${f}" width="${220}" height="${u}" rx="2" ry="2" fill="var(--background-color)" cursor="pointer" stroke="var(--color)" stroke-width="2"></rect>`),{node:o,rect:{x:l,y:f,width:220,height:u}}},fd=(e,t,r=10)=>{const n=[],s=[];e.forEach(a=>{const i=String(a[0]??""),c=a[1]||[];c.some(u=>u===t)&&n.push(i),i===t&&s.push(...c)});const o=a=>[...new Set(a)];return{currentHash:t,inputs:o(n).slice(0,r),outputs:o(s).slice(0,r)}},pd=({query:e,navigate:t})=>{const r=X(te({display:"flex",flexDirection:"column",gap:"0.75em"})),n=X(te({width:"100%",minHeight:"320px"})),s=document.createElementNS("http://www.w3.org/2000/svg","svg"),o=gr();return s.setAttribute("width","100%"),s.setAttribute("height","320"),n.append(s,o),r.append(nn("Dependencies"),n),{root:r,render:async i=>{if(s.innerHTML="",!i){Nr(N=>{t(`/deps/${N.hash}`)});return}const c=i,u=(await ie(i)).schemaHash,l=await e("select to, from from links"),f=fd(l.rows,c);f.inputs=f.inputs.filter(N=>N!==u);const w=[{ids:f.inputs,x:.2},{ids:[f.currentHash],x:.5},{ids:f.outputs,x:.8}],$=new Map;await Promise.all(w.flatMap(N=>N.ids.map(async j=>{const A=await Zr(j).then(V=>V.slice(0,30)).catch(()=>`#${j}`);$.set(j,A)})));const p=await Zr(u).then(N=>N.slice(0,15)).catch(()=>`#${u}`);$.set(u,p);const v=new Map;w.forEach(({ids:N,x:j})=>{const A=Math.max(N.length,1);N.forEach((V,U)=>{const W=A===1?.5:.2+.6*(U+.5)/A,Z=Hs(s,{x:j,y:W},$.get(V)||`#${V}`);Z.node.onclick=()=>{V===f.currentHash?t(`/${V}`):t(`/deps/${V}`)},v.set(V,Z.rect)})});const m=Hs(s,{x:.5,y:.1},$.get(u)||`#${u}`);m.node.onclick=()=>{t(`/deps/${u}`)};const h=m.rect,y=(N,j)=>({x:j==="left"?N.x:N.x+N.width,y:N.y+N.height/2}),S=(N,j)=>({x:N.x+N.width/2,y:j==="top"?N.y:N.y+N.height}),P=v.get(f.currentHash);P&&(f.inputs.forEach(N=>{const j=v.get(N);j&&qs(s,y(j,"right"),y(P,"left"))}),f.outputs.forEach(N=>{const j=v.get(N);j&&qs(s,y(P,"right"),y(j,"left"))}),h&&dd(s,S(h,"bottom"),S(P,"top"))),ie(f.currentHash).then(N=>o.innerHTML=kr(N.data))}}},Oe=e=>e.startsWith("#")?e:`#${e}`,cr=e=>e.startsWith("#")?e.slice(1):e,en=e=>typeof e=="string"&&e.startsWith("#")?ie(cr(e)).then(t=>en(t.data)):Promise.resolve(e),zr=64,xt=async(e,t)=>{let r=(await ie(cr(e))).data,n={value:"NOT FOUND:"+r.$};if(r.$=="input")n={pipelineNode:Oe(e),input:Oe(e),value:Oe(t)};else if(r.$=="logic"){const s=Object.entries(r.inputs),o=await Promise.all(s.map(async([i,c])=>{const[u,l]=await xt(c,t);return{name:i,stepHash:u,value:await en(l)}})),a=await Function(...o.map(i=>i.name),r.code)(...o.map(i=>i.value));n={pipelineNode:Oe(e),logic:Oe(e),inputs:Object.fromEntries(o.map(i=>[i.name,Oe(i.stepHash)])),value:Oe(await Ye({schemaHash:ve(Ee),data:a}))}}else{if(r.$=="llm_call")throw new Error("LLM CALLS NOT IMPLEMENTED");if(r.$=="loop"){const[s,o]=await xt(r.input,t);let a=String(o);if(!a.startsWith("#")){const u=await Ye({schemaHash:ve(Ee),data:o});a=Oe(u)}const i=[];let c=0;for(;c<zr;){c+=1;const[u,l]=await xt(r.condition,cr(a));if(i.push(Oe(u)),!await en(l))break;const[w,$]=await xt(r.body,cr(a));if(i.push(Oe(w)),a=String($),!a.startsWith("#")){const p=await Ye({schemaHash:ve(Ee),data:$});a=Oe(p)}}if(c>=zr)throw new Error(`loop exceeded max steps (${zr})`);n={pipelineNode:Oe(e),loop:Oe(e),input:Oe(s),steps:i,value:a}}}return console.log("RESULT",ue(n)),[await Ye(ve(Ee),n),n.value]},hd=async(e,t)=>{let[r,n]=await xt(e,t);return r},$e=e=>e.startsWith("#")?e.slice(1):e,md=e=>"inputs"in e?Object.values(e.inputs).map($e):"prompt"in e?[$e(e.prompt)]:"loop"in e?[$e(e.input),...e.steps.map($e)]:[],zs=e=>"inputs"in e?"logic":"prompt"in e?"llm_call":"loop"in e?"loop":"input",rr=e=>typeof e.pipelineNode=="string"&&e.pipelineNode.startsWith("#")?$e(e.pipelineNode):"logic"in e?$e(e.logic):"llm_call"in e?$e(e.llm_call):"loop"in e?$e(e.loop):"input"in e?$e(e.input):null,yd=e=>e.$==="logic"?Object.values(e.inputs||{}).map($e):e.$==="llm_call"?e.prompt?[$e(e.prompt)]:[]:e.$==="loop"?[e.input,e.condition,e.body].filter(t=>!!t).map($e):[],gd=e=>typeof e=="string"?e.startsWith("#")?`ref ${e.slice(1,9)}`:e.slice(0,16):Array.isArray(e)?`array(${e.length})`:e&&typeof e=="object"?`object(${Object.keys(e).length})`:String(e),Fs=e=>e?`#${$e(e).slice(0,8)}`:"",$d=e=>e==="logic"?"#2f80ed":e==="input"?"#27ae60":e==="llm_call"?"#d35400":e==="loop"?"#8e44ad":"var(--color)",vd=async e=>{const t=[],r=[],n=new Set,s=new Map,o=new Map,a=new Map,i=[],c=new Set,u=async m=>{const h=$e(m);if(n.has(h))return;n.add(h);const y=(await ie(h)).data;s.set(h,y);const S=zs(y),P=rr(y),N=P?Fs(P):"n/a";t.push({id:h,dom:{tag:"span",attrs:{},style:{},textContent:`${S} | ${gd(y.value)} | ${N}`,id:"",children:[]}});for(const j of md(y))await u(j),r.push([j,h])};await u(e);const l=new Map,f=m=>{const h=String(m);return l.has(h)||l.set(h,ie(m).then(y=>y.data)),l.get(h)},w=async(m,h=new Set)=>{if(typeof m=="string"&&m.startsWith("#")){const y=$e(m);if(!y||h.has(y))return m;h.add(y);try{const S=await f(y);return await w(S,h)}catch{return m}finally{h.delete(y)}}if(Array.isArray(m))return Promise.all(m.map(y=>w(y,h)));if(m&&typeof m=="object"){const y=await Promise.all(Object.entries(m).map(async([S,P])=>[S,await w(P,h)]));return Object.fromEntries(y)}return m};await Promise.all([...s.entries()].map(async([m,h])=>{try{o.set(m,await w(h.value))}catch{o.set(m,h.value)}}));const $=async m=>{const h=$e(m);if(c.has(h))return;c.add(h);const y=(await ie(h)).data;if(!(!y||typeof y!="object"||!("$"in y))){a.set(h,y);for(const S of yd(y))await $(S),i.push([S,h])}},p=[...new Set([...s.values()].map(rr).filter(m=>!!m))];await Promise.all(p.map(m=>$(m)));const v=[...a.entries()].map(([m,h])=>({id:m,dom:{tag:"span",attrs:{},style:{},textContent:h.title?`${h.$}: ${h.title}`:h.$,id:"",children:[]}}));return m=>{let h=null,y=null,S=null,P=null;const N={tag:"div",attrs:{},textContent:"",id:"",children:[],style:{width:"min(28rem, 42%)","max-height":"100%","overflow-y":"auto","background-color":"var(--background-color)","border-left":"1px solid var(--color)","padding-left":"1em","padding-right":"0.5em","padding-top":"0.25em"}},j=Qr({nodes:t,edges:r,boxW:50,boxH:12,onHighlightBox:B=>{h=B;const Y=B?s.get(B):null,J=Y?rr(Y):null;S=J,P&&P.setSelected(J,!1,!1),Z(),m.update(N)}});y=j.controls;const A=j.render(m),V=Qr({nodes:v,edges:i,boxW:50,boxH:12,onHighlightBox:B=>{S=B,m.update(N)}});P=V.controls;const U=V.render(m),W={tag:"div",attrs:{},textContent:"",id:"",style:{width:"100%",display:"flex",gap:"0.75em",position:"relative"},children:[{tag:"div",attrs:{},style:{width:"100%",display:"flex",gap:"0.75em"},textContent:"",id:"",children:[{tag:"div",attrs:{},style:{width:"50%",display:"flex","flex-direction":"column",gap:"0.4em"},textContent:"",id:"",children:[{tag:"div",attrs:{},style:{"font-weight":"600","font-size":"0.9em"},textContent:"Execution Trace",id:"",children:[]},A]},{tag:"div",attrs:{},style:{width:"50%",display:"flex","flex-direction":"column",gap:"0.4em"},textContent:"",id:"",children:[{tag:"div",attrs:{},style:{"font-weight":"600","font-size":"0.9em"},textContent:"Pipeline Graph",id:"",children:[]},U]}]},N]},Z=()=>{const B=h?s.get(h):null;if(!B){N.style.display="none",N.children=[];return}N.style.display="block";const Y=zs(B),J=rr(B),pe=o.get(h)??B.value,ce=typeof pe=="string"?pe:JSON.stringify(pe,null,2),fe={tag:"button",attrs:{},id:"",children:[],style:{cursor:"pointer","margin-bottom":"0.5em",border:"1px solid var(--color)","border-radius":"0.25em",padding:"0.05em 0.35em","background-color":"var(--background-color)",color:"var(--color)"},textContent:`#${h.slice(0,8)}`,onEvent:I=>{I.type==="click"&&(history.pushState({},"",`/${h}`),dispatchEvent(new PopStateEvent("popstate")))}},T={tag:"button",attrs:{},id:"",children:[],style:{cursor:J?"pointer":"default","margin-left":"0.35em",border:"1px solid var(--color)","border-radius":"0.25em",padding:"0.05em 0.35em","background-color":J&&S===J?"rgba(255, 153, 0, 0.16)":"var(--background-color)",color:"var(--color)"},textContent:J?`pipeline ${Fs(J)}`:"pipeline n/a",onEvent:I=>{I.type!=="click"||!J||(S=J,P?.setSelected(J,!1,!1),m.update(N))}},L={tag:"span",attrs:{},id:"",children:[],style:{display:"inline-block","font-size":"0.78em","font-weight":"600",color:"white","background-color":$d(Y),"border-radius":"0.9em",padding:"0.12em 0.45em","margin-right":"0.35em"},textContent:Y},x=kr(B),E=es(x).map(I=>{if(I.type==="text")return{tag:"span",attrs:{},style:{},textContent:I.value,id:"",children:[]};const _=I.value,d=$e(_),g=n.has(d);return{tag:"button",attrs:{},id:"",children:[],style:{cursor:"pointer",border:"1px solid var(--color)","border-radius":"0.25em",padding:"0.05em 0.35em",display:"inline-block",margin:"0.1em 0.15em","font-size":"0.95em","line-height":"1.3","font-family":"inherit","background-color":g&&h===d?"rgba(255, 153, 0, 0.16)":"var(--background-color)",color:"var(--color)"},textContent:`#${d.slice(0,8)}`,onEvent:O=>{if(O.type==="mousemove"){y?.setHighlight(g?d:null);return}if(O.type==="mouseup"){y?.setHighlight(null);return}if(O.type==="click"){if(g&&y){y.setSelected(d,!1,!0);return}history.pushState({},"",`/${d}`),dispatchEvent(new PopStateEvent("popstate"))}}}});N.children=[{tag:"div",attrs:{},id:"",textContent:"",style:{display:"flex","align-items":"center","margin-bottom":"0.5em"},children:[L,fe,T]},{tag:"pre",attrs:{},textContent:ce,id:"",children:[],style:{"white-space":"pre-wrap","font-size":"0.82em",margin:"0 0 0.55em 0",padding:"0.45em",border:"1px solid #ccc","border-radius":"0.25em","max-height":"8em","overflow-y":"auto"}},{tag:"pre",attrs:{},textContent:"",id:"",children:E,style:{"white-space":"pre-wrap","font-size":"0.85em",margin:"0",padding:"0.5em","overflow-y":"auto","max-height":"100%"},onEvent:I=>{I.type==="mousemove"&&I.target.tag!=="button"&&y?.setHighlight(null)}}]};return Z(),W}},ss=e=>e.$==="logic"?Object.values(e.inputs):e.$==="llm_call"?[e.prompt]:e.$==="loop"?[e.input,e.condition,e.body]:[],wd=e=>e.$==="logic"?Object.values(e.inputs).length:e.$==="llm_call"?1:e.$==="loop"?3:0,Yo=(e,t)=>{if(t.length!==wd(e))throw new Error("wrong number of sources");return e.$==="logic"?{...e,inputs:Object.fromEntries(t.map((r,n)=>[Object.keys(e.inputs)[n],r]))}:e.$==="llm_call"?{...e,prompt:t[0]}:e.$==="loop"?{...e,input:t[0],condition:t[1],body:t[2]}:e},_d=(e,t)=>Promise.all(ss(e).map(t)).then(r=>Yo(e,r));async function tn(e,t){if(typeof e=="string"){const s=e.slice(1),o=await ie(s),a=await tn(o.data,t),i=Le(ue(a));return t.has(i)||t.set(i,{noteHash:s,original:o.data}),a}if(!(typeof e=="object"&&"$"in e))throw new Error("not a graph");const r=await _d(e,s=>tn(s,t)),n=Le(ue(r));return t.has(n)||t.set(n,{original:e}),r}const Qo=ve(bt),bd=e=>!!e&&typeof e=="object"&&"$"in e,rn=async(e,t=new Map,r=new Map,n=new Map,s=new Set)=>{if(typeof e=="string"){if(!e.startsWith("#"))throw new Error("graph refs must start with #");const l=e.slice(1),f=r.get(l);if(f)return f;const w=n.get(l);if(w)return await w;if(s.has(l))throw new Error(`cyclic graph reference: #${l}`);const $=new Set(s);$.add(l);const p=(async()=>{const v=await ie(l),m=await rn(v.data,t,r,n,$);return r.set(l,m),m})();n.set(l,p);try{return await p}finally{n.delete(l)}}if(!bd(e))throw new Error("not a graph");const o=await Promise.all(ss(e).map(l=>rn(l,t,r,n,s))),a=Yo(e,o.map(l=>`#${l}`)),i=ue(a),c=t.get(i);if(c)return c;const u=await Ye(Qo,a);return t.set(i,u),u},Ed=(e,t)=>{const r=[],n=[],s=new Map,o=new Set,a=i=>{const c=Le(ue(i));if(o.has(c))return c;o.add(c);const u=i.title||"",l=t.get(c),f=l?.original??i,w=l?.noteHash??ve({schemaHash:Qo,data:f});return r.push({id:c,dom:{tag:"span",attrs:{},style:{},textContent:u?`${i.$}: ${u}`:i.$,id:"",children:[]}}),s.set(c,{noteHash:w,original:f}),ss(i).map(a).forEach($=>n.push([$,c])),c};return a(e),{nodes:r,edges:n,meta:s}},Sd=async e=>{const t=await rn(e),r=new Map,n=await tn(`#${t}`,r),{nodes:s,edges:o,meta:a}=Ed(n,r),i=new Map;return a.forEach((c,u)=>{const l=String(c.noteHash).toLowerCase();i.has(l)||i.set(l,u)}),c=>{let u=null,l=null;const f={tag:"div",attrs:{},style:{width:"min(28rem, 42%)","max-height":"100%","overflow-y":"auto","background-color":"var(--background-color)","border-left":"1px solid var(--color)","padding-left":"1em","padding-right":"0.5em","padding-top":"0.25em"},textContent:"",id:"",children:[]},w=Qr({nodes:s,edges:o,onHighlightBox:h=>{u=h,m(),c.update(f)}});l=w.controls;const $=w.render(c),v={tag:"div",attrs:{},style:{width:"100%",display:"flex",gap:"0.75em",position:"relative","flex-direction":"column"},textContent:"",id:"",children:[{tag:"div",attrs:{},style:{display:"flex",gap:"0.6em","align-items":"center"},textContent:"",id:"",children:[{tag:"button",attrs:{},style:{cursor:"pointer",border:"1px solid var(--color)","border-radius":"0.25em",padding:"0.2em 0.55em","background-color":"var(--background-color)",color:"var(--color)"},textContent:"run pipeline",id:"",children:[],onEvent:h=>{h.type==="click"&&hd(t,"0244a38ce53a7777dd5614eb7cdef9ea").then(y=>{history.pushState({},"",`/trace/${y}`),dispatchEvent(new PopStateEvent("popstate"))})}}]},{tag:"div",attrs:{},style:{width:"100%",display:"flex",gap:"0.75em",position:"relative"},textContent:"",id:"",children:[{tag:"div",attrs:{},style:{width:"100%"},textContent:"",id:"",children:[$]},f]}]},m=()=>{const h=u?a.get(u):null;if(!h){f.style.display="none",f.children=[];return}f.style.display="block";const y={tag:"button",attrs:{},style:{cursor:"pointer","margin-bottom":"0.5em",border:"1px solid var(--color)","border-radius":"0.25em",padding:"0.05em 0.35em","background-color":"var(--background-color)",color:"var(--color)"},textContent:`#${String(h.noteHash).slice(0,8)}`,id:"",children:[],onEvent:P=>{if(P.type==="mousemove"){u&&l?.setHighlight(u);return}if(P.type==="click"){history.pushState({},"",`/${h.noteHash}`),dispatchEvent(new PopStateEvent("popstate"));return}if(P.type==="mouseup"){l?.setHighlight(null);return}}},S=es(kr(h.original)).map(P=>{if(P.type==="text")return{tag:"span",attrs:{},style:{},textContent:P.value,id:"",children:[]};const N=P.value,j=i.get(N.toLowerCase())||null;return{tag:"button",attrs:{},style:{cursor:"pointer",border:"1px solid var(--color)","border-radius":"0.25em",padding:"0.05em 0.35em",display:"inline-block",margin:"0.1em 0.15em","font-size":"0.95em","line-height":"1.3","font-family":"inherit","background-color":j&&u===j?"rgba(255, 153, 0, 0.16)":"var(--background-color)",color:"var(--color)"},textContent:`#${N.slice(0,8)}`,id:"",children:[],onEvent:A=>{if(A.type==="mousemove"){l?.setHighlight(j);return}if(A.type==="mouseup"){l?.setHighlight(null);return}if(A.type==="click"){if(j&&l){l.setSelected(j,!1,!0);return}history.pushState({},"",`/${N}`),dispatchEvent(new PopStateEvent("popstate"))}}}});f.children=[y,{tag:"pre",attrs:{},style:{"white-space":"pre-wrap","font-size":"0.85em",margin:"0",padding:"0.5em","overflow-y":"auto","max-height":"100%"},textContent:"",id:"",children:S,onEvent:P=>{P.type==="mousemove"&&P.target.tag!=="button"&&l?.setHighlight(null)}}]};return m(),v}};let Zo=()=>{},Dt=null,xr=()=>{};const ea=document.body;let He=null;const ae=e=>Dt&&(Dt.innerHTML="",Dt.appendChild(e)),Kt=e=>(history.pushState({},"",e),xr());let lr=null;const kd=async()=>{if(!lr){const{createEditView:e}=await aa(()=>import("./edit.4272e4d1.js").then(t=>t.e),["assets/edit.4272e4d1.js","assets/edit.035ddbf2.css"]);lr=e({submit:Pd})}return lr},Pd=async e=>{try{const t=await Ye(e);Kt(`/${t}`)}catch(t){Re(_e("ERROR"),de(t.message||"failed to add note"))}},Od=e=>ae(cd(e)),jd=e=>{if(!e||typeof e!="object")return!1;const t=e;return typeof t.tag=="string"&&typeof t.textContent=="string"&&typeof t.id=="string"&&typeof t.style=="object"&&Array.isArray(t.children)},Nd=e=>{ae(X("running...")),Xo(e,{},{view:t=>ns(t,ae)}).then(t=>{t!==void 0&&(jd(t)?ae(Lt(()=>t)):ae(gr(typeof t=="string"?t:JSON.stringify(t,null,2))))}).catch(t=>{ae(X(_e("ERROR"),de(t.message||"view call failed")))})},xd=(e,t)=>{const r=e.replace(/^\/+/,""),n=new URLSearchParams(t);if(!r)return{kind:"dashboard"};if(r==="edit"){const s=n.get("hash");return{kind:"edit",hash:s||void 0,isNew:n.get("new")==="1"}}return r==="sql"?{kind:"sql"}:r.startsWith("view/")?{kind:"functionView",hash:r.slice(5)||void 0}:r==="deps"||r.startsWith("deps/")?{kind:"deps",hash:r.slice(5)||void 0}:r==="pipeline"||r.startsWith("pipeline/")?{kind:"pipeline",hash:r.slice(9)||void 0}:r==="trace"||r.startsWith("trace/")?{kind:"trace",hash:r.slice(6)||void 0}:{kind:"note",hash:r}},Id=e=>e.kind==="note"?e.hash:e.kind==="edit"||e.kind==="functionView"||e.kind==="deps"||e.kind==="pipeline"||e.kind==="trace"?e.hash??null:null,Rd=e=>e.kind==="dashboard"?"/":e.kind==="edit"?"/edit":e.kind==="sql"?"/sql":e.kind==="deps"?"/deps":e.kind==="pipeline"?"/pipeline":e.kind==="trace"?"/trace":e.kind==="functionView"?"/view":"/view-note",ta=e=>He?e==="/view-note"?`/${He}`:e==="/edit"?`/edit?hash=${He}`:e==="/deps"?`/deps/${He}`:e==="/pipeline"?`/pipeline/${He}`:e==="/trace"?`/trace/${He}`:e:e;xr=()=>{const e=xd(window.location.pathname,window.location.search),t=Id(e);if(t&&(He=t),ra.forEach(({base:r,el:n})=>{const s=ta(r);n.setAttribute("href",s),n.style.setProperty("opacity",r===Rd(e)?"1":"0.5")}),e.kind==="edit")lr||ae(X("loading editor...")),kd().then(r=>{if(ae(r.root),e.isNew&&localStorage.removeItem("edit_draft"),e.hash)ie(e.hash).then(n=>r.fill({schemaHash:n.schemaHash,text:ue(n.data)})).catch(n=>Re(_e("ERROR"),de(n.message)));else{const n=localStorage.getItem("edit_draft");try{r.fill(n?JSON.parse(n):{schemaHash:ve(Ee),text:"{}"})}catch{r.fill({schemaHash:ve(Ee),text:"{}"})}}e.isNew&&history.replaceState({},"","/edit")});else if(e.kind==="dashboard")ae(os.root),Zo();else if(e.kind==="sql")ae(Cd.root);else if(e.kind==="functionView")e.hash?Nd(e.hash):ae(X(_e("ERROR"),de("missing function hash")));else if(e.kind==="deps"){const r=e.hash||He||void 0;ae(Us.root),Us.render(r)}else if(e.kind==="pipeline"){const r=e.hash||He||void 0;ae(X("loading...")),(r?ie(r).then(s=>s.data):Promise.resolve(Wo.data)).then(s=>Sd(s)).then(s=>ae(Lt(s))).catch(s=>ae(X(_e("ERROR"),de(s.message))))}else if(e.kind==="trace"){const r=e.hash||He||void 0;if(!r){ae(X(_e("ERROR"),de("missing trace hash")));return}ae(X("loading...")),vd(r).then(n=>ae(Lt(n))).catch(n=>ae(X(_e("ERROR"),de(n.message))))}else Od(e.hash)};const Td=te({padding:"1.5em",margin:".5em",borderRadius:"1em",background:"var(--background-color)",color:"var(--color)",border:"1px solid #ccc"}),ra=[["Dashboard","/"],["View","/view-note"],["Edit","/edit"],["SQL","/sql"],["Deps","/deps"],["Pipeline","/pipeline"],["Trace","/trace"]].map(([e,t])=>{const r=sn(te({textDecoration:"none",color:"inherit",fontWeight:"bold"}),{href:t,onclick:n=>{const s=ta(t);if(n.metaKey||n.ctrlKey){r.setAttribute("href",s);return}n.preventDefault(),Kt(s)}},e);return{base:t,el:r}});ea.appendChild(X(te({display:"flex",flexDirection:"column",gap:"0.75em",padding:"1em"}),sn(te({textDecoration:"none",color:"inherit"}),_e("Json View"),{href:"/",onclick:e=>{e.preventDefault(),Kt("/")}}),X(te({display:"flex",gap:"1em"}),ra.map(e=>e.el))));const os=ld({query:Or,navigate:Kt}),Cd=ud({query:Or}),Us=pd({query:Or,navigate:Kt});Dt=X(Td);ea.appendChild(Dt);Zo=os.runQuery;ae(os.root);xr();window.addEventListener("popstate",xr);export{aa as _,te as a,be as b,at as c,X as d,Ko as e,Ut as f,Ee as g,ve as h,ur as i,Vs as j,Md as k,Re as l,de as m,Zr as n,sn as o,Ds as p,gr as q,rd as r,Jn as s,ue as t,ie as u,Ad as v,er as w,kr as x};
